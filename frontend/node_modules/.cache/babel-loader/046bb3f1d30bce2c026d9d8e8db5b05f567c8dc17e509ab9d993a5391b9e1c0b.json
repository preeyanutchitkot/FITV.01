{"ast":null,"code":"var _jsxFileName = \"C:\\\\Fit\\\\frontend\\\\src\\\\components\\\\KeypointOverlay.js\",\n  _s = $RefreshSig$();\nimport React, { useRef, useEffect, useState } from 'react';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst KeypointOverlay = ({\n  videoRef,\n  isPlaying,\n  onKeypointsDetected,\n  autoPlay = true,\n  loop = true,\n  videoFile = null\n}) => {\n  _s();\n  const canvasRef = useRef(null);\n  const internalVideoRef = useRef(null);\n  const [isInitialized, setIsInitialized] = useState(false);\n  const [pose, setPose] = useState(null);\n  const [videoUrl, setVideoUrl] = useState(null);\n  const [showVideo, setShowVideo] = useState(false);\n\n  // Use internal video ref if no external videoRef is provided\n  const activeVideoRef = videoRef || internalVideoRef;\n\n  // MediaPipe Pose connections (33 landmarks)\n  const POSE_CONNECTIONS = [\n  // Face\n  [0, 1], [1, 2], [2, 3], [3, 7], [0, 4], [4, 5], [5, 6], [6, 8],\n  // Arms\n  [9, 10], [11, 12], [11, 13], [13, 15], [15, 17], [15, 19], [15, 21], [17, 19], [12, 14], [14, 16], [16, 18], [16, 20], [16, 22], [18, 20],\n  // Body\n  [11, 23], [12, 24], [23, 24],\n  // Legs\n  [23, 25], [24, 26], [25, 27], [26, 28], [27, 29], [28, 30], [29, 31], [30, 32], [27, 31], [28, 32]];\n  useEffect(() => {\n    const initializeMediaPipe = async () => {\n      try {\n        // โหลด MediaPipe จาก CDN\n        if (!window.Pose) {\n          // โหลด scripts จาก CDN\n          await loadScript('https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js');\n          await loadScript('https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js');\n          await loadScript('https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js');\n          await loadScript('https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js');\n        }\n        const poseInstance = new window.Pose({\n          locateFile: file => {\n            return `https://cdn.jsdelivr.net/npm/@mediapipe/pose/${file}`;\n          }\n        });\n        poseInstance.setOptions({\n          modelComplexity: 1,\n          smoothLandmarks: true,\n          enableSegmentation: false,\n          smoothSegmentation: true,\n          minDetectionConfidence: 0.5,\n          minTrackingConfidence: 0.5\n        });\n        poseInstance.onResults(onResults);\n        setPose(poseInstance);\n        setIsInitialized(true);\n      } catch (error) {\n        console.error('Failed to load MediaPipe:', error);\n      }\n    };\n    initializeMediaPipe();\n  }, []);\n\n  // Cleanup effect\n  useEffect(() => {\n    return () => {\n      if (pose) {\n        pose.close();\n      }\n    };\n  }, [pose]);\n\n  // Helper function to load scripts\n  const loadScript = src => {\n    return new Promise((resolve, reject) => {\n      if (document.querySelector(`script[src=\"${src}\"]`)) {\n        resolve();\n        return;\n      }\n      const script = document.createElement('script');\n      script.src = src;\n      script.onload = resolve;\n      script.onerror = reject;\n      document.head.appendChild(script);\n    });\n  };\n\n  // Handle video file upload\n  useEffect(() => {\n    console.log('Video file effect triggered:', {\n      videoFile: !!videoFile,\n      fileName: videoFile === null || videoFile === void 0 ? void 0 : videoFile.name\n    });\n    if (videoFile) {\n      try {\n        // Create object URL for the uploaded file\n        const url = URL.createObjectURL(videoFile);\n        setVideoUrl(url);\n        setShowVideo(true);\n        console.log('Video URL created:', url);\n\n        // If we have a video element, set the source\n        if (activeVideoRef !== null && activeVideoRef !== void 0 && activeVideoRef.current) {\n          const video = activeVideoRef.current;\n          video.src = url;\n          video.load();\n\n          // Set video properties immediately\n          video.autoplay = autoPlay;\n          video.muted = true;\n          video.loop = loop;\n          console.log('Video properties set, starting load');\n        }\n\n        // Cleanup function for this effect\n        return () => {\n          console.log('Cleaning up video URL');\n          if (videoUrl) {\n            URL.revokeObjectURL(videoUrl);\n          }\n          URL.revokeObjectURL(url);\n        };\n      } catch (error) {\n        console.error('Error creating video URL:', error);\n        setShowVideo(false);\n      }\n    } else {\n      console.log('No video file, hiding video');\n      setShowVideo(false);\n      setVideoUrl(null);\n    }\n  }, [videoFile, autoPlay, loop]);\n\n  // Debug effect to log state changes\n  useEffect(() => {\n    console.log('State changed:', {\n      showVideo,\n      hasVideoFile: !!videoFile,\n      hasVideoRef: !!videoRef,\n      videoUrl: !!videoUrl\n    });\n  }, [showVideo, videoFile, videoRef, videoUrl]);\n  useEffect(() => {\n    if (!isInitialized || !pose || !(activeVideoRef !== null && activeVideoRef !== void 0 && activeVideoRef.current) || !canvasRef.current) return;\n    const video = activeVideoRef.current;\n    const canvas = canvasRef.current;\n    const processFrame = async () => {\n      if (video.paused || video.ended || !video.videoWidth || !video.videoHeight) return;\n      try {\n        // Match canvas size to video element's display size exactly\n        const rect = video.getBoundingClientRect();\n        if (canvas.width !== rect.width || canvas.height !== rect.height) {\n          canvas.width = rect.width;\n          canvas.height = rect.height;\n        }\n\n        // Send frame to MediaPipe\n        await pose.send({\n          image: video\n        });\n      } catch (error) {\n        console.error('Pose detection error:', error);\n      }\n\n      // Continue processing frames as long as video is playing\n      if (!video.paused && !video.ended) {\n        requestAnimationFrame(processFrame);\n      }\n    };\n\n    // Handle video events for auto-processing\n    const handleLoadedMetadata = () => {\n      console.log('Video metadata loaded:', video.videoWidth, 'x', video.videoHeight);\n      const rect = video.getBoundingClientRect();\n      canvas.width = rect.width;\n      canvas.height = rect.height;\n    };\n    const handleLoadedData = () => {\n      console.log('Video data loaded, starting playback');\n      // Auto-start processing when video data is loaded\n      if (autoPlay) {\n        video.play().then(() => {\n          console.log('Video playing automatically');\n          processFrame();\n        }).catch(error => {\n          console.log('Auto-play was prevented:', error);\n          processFrame();\n        });\n      } else {\n        processFrame();\n      }\n    };\n    const handleCanPlay = () => {\n      // Start processing as soon as video can play\n      if (autoPlay && video.paused) {\n        video.play().catch(error => {\n          console.log('Auto-play was prevented in canplay:', error);\n        });\n      }\n      processFrame();\n    };\n    const handlePlay = () => {\n      console.log('Video play event triggered');\n      processFrame();\n    };\n    const handleLoadStart = () => {\n      console.log('Video load start');\n      // Clear canvas when new video starts loading\n      const ctx = canvas.getContext('2d');\n      ctx.clearRect(0, 0, canvas.width, canvas.height);\n    };\n    const handleError = e => {\n      console.error('Video error:', e, video.error);\n    };\n\n    // Add event listeners\n    video.addEventListener('loadstart', handleLoadStart);\n    video.addEventListener('loadedmetadata', handleLoadedMetadata);\n    video.addEventListener('loadeddata', handleLoadedData);\n    video.addEventListener('canplay', handleCanPlay);\n    video.addEventListener('play', handlePlay);\n    video.addEventListener('error', handleError);\n\n    // Start processing immediately if video is already ready\n    if (video.readyState >= 2 && video.videoWidth && video.videoHeight) {\n      console.log('Video already ready, starting immediately');\n      const rect = video.getBoundingClientRect();\n      canvas.width = rect.width;\n      canvas.height = rect.height;\n      if (autoPlay && video.paused) {\n        video.play().catch(error => {\n          console.log('Auto-play was prevented on ready:', error);\n        });\n      }\n      processFrame();\n    }\n\n    // Cleanup function\n    return () => {\n      video.removeEventListener('loadstart', handleLoadStart);\n      video.removeEventListener('loadedmetadata', handleLoadedMetadata);\n      video.removeEventListener('loadeddata', handleLoadedData);\n      video.removeEventListener('canplay', handleCanPlay);\n      video.removeEventListener('play', handlePlay);\n      video.removeEventListener('error', handleError);\n    };\n  }, [isInitialized, pose, autoPlay, loop, videoUrl]);\n\n  // Watch for video source changes - only for external videoRef\n  useEffect(() => {\n    if (!(videoRef !== null && videoRef !== void 0 && videoRef.current)) return;\n    const video = videoRef.current;\n\n    // Observer to watch for src attribute changes\n    const observer = new MutationObserver(mutations => {\n      mutations.forEach(mutation => {\n        if (mutation.type === 'attributes' && mutation.attributeName === 'src') {\n          // Video source changed, start processing\n          if (video.src && video.readyState >= 1) {\n            if (autoPlay) {\n              video.play().catch(error => {\n                console.log('Auto-play was prevented:', error);\n              });\n            }\n          }\n        }\n      });\n    });\n    observer.observe(video, {\n      attributes: true,\n      attributeFilter: ['src']\n    });\n    return () => {\n      observer.disconnect();\n    };\n  }, [videoRef, autoPlay]);\n\n  // Additional effect to handle manual play/pause - use activeVideoRef\n  useEffect(() => {\n    if (!(activeVideoRef !== null && activeVideoRef !== void 0 && activeVideoRef.current) || !canvasRef.current) return;\n    const video = activeVideoRef.current;\n    const canvas = canvasRef.current;\n    if (!isPlaying) {\n      const ctx = canvas.getContext('2d');\n      ctx.clearRect(0, 0, canvas.width, canvas.height);\n    }\n  }, [isPlaying]);\n  const onResults = results => {\n    const canvas = canvasRef.current;\n    const video = activeVideoRef.current; // Fix: use activeVideoRef instead of videoRef\n    if (!canvas || !video || !results.poseLandmarks) return;\n    try {\n      drawPoseMediaPipe(results.poseLandmarks, canvas, video);\n      if (onKeypointsDetected) {\n        onKeypointsDetected(results.poseLandmarks);\n      }\n    } catch (error) {\n      console.error('Drawing error:', error);\n    }\n  };\n  const drawPoseMediaPipe = (landmarks, canvas, video) => {\n    const ctx = canvas.getContext('2d');\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n    // Check if video has valid dimensions\n    if (!video.videoWidth || !video.videoHeight) return;\n\n    // Get actual video dimensions and display dimensions\n    const videoRect = video.getBoundingClientRect();\n    const videoWidth = video.videoWidth;\n    const videoHeight = video.videoHeight;\n    const displayWidth = videoRect.width;\n    const displayHeight = videoRect.height;\n\n    // Prevent division by zero\n    if (displayWidth === 0 || displayHeight === 0) return;\n\n    // Calculate aspect ratios\n    const videoAspect = videoWidth / videoHeight;\n    const displayAspect = displayWidth / displayHeight;\n\n    // Calculate actual video display area within the video element\n    let actualVideoWidth,\n      actualVideoHeight,\n      offsetX = 0,\n      offsetY = 0;\n    if (videoAspect > displayAspect) {\n      // Video is wider - letterboxed top/bottom\n      actualVideoWidth = displayWidth;\n      actualVideoHeight = displayWidth / videoAspect;\n      offsetY = (displayHeight - actualVideoHeight) / 2;\n    } else {\n      // Video is taller - letterboxed left/right\n      actualVideoHeight = displayHeight;\n      actualVideoWidth = displayHeight * videoAspect;\n      offsetX = (displayWidth - actualVideoWidth) / 2;\n    }\n\n    // MediaPipe landmarks are normalized (0-1), scale to actual video area\n    const scaleX = actualVideoWidth;\n    const scaleY = actualVideoHeight;\n\n    // Draw skeleton connections\n    POSE_CONNECTIONS.forEach(([i, j]) => {\n      const kp1 = landmarks[i];\n      const kp2 = landmarks[j];\n      if (kp1 && kp2 && kp1.visibility > 0.5 && kp2.visibility > 0.5) {\n        ctx.beginPath();\n        ctx.moveTo(kp1.x * scaleX + offsetX, kp1.y * scaleY + offsetY);\n        ctx.lineTo(kp2.x * scaleX + offsetX, kp2.y * scaleY + offsetY);\n        ctx.strokeStyle = '#00FF00';\n        ctx.lineWidth = 2;\n        ctx.stroke();\n      }\n    });\n\n    // Draw keypoints with different colors\n    landmarks.forEach((landmark, index) => {\n      if (landmark && landmark.visibility > 0.5) {\n        ctx.beginPath();\n        ctx.arc(landmark.x * scaleX + offsetX, landmark.y * scaleY + offsetY, 3, 0, 2 * Math.PI);\n\n        // Different colors for different body parts\n        if (index <= 10) {\n          ctx.fillStyle = '#FF6B6B'; // Face and upper body\n        } else if (index <= 16) {\n          ctx.fillStyle = '#4ECDC4'; // Arms\n        } else if (index <= 22) {\n          ctx.fillStyle = '#45B7D1'; // Hands\n        } else {\n          ctx.fillStyle = '#96CEB4'; // Legs and body\n        }\n        ctx.fill();\n\n        // Add white border for better visibility\n        ctx.beginPath();\n        ctx.arc(landmark.x * scaleX + offsetX, landmark.y * scaleY + offsetY, 3, 0, 2 * Math.PI);\n        ctx.strokeStyle = '#FFFFFF';\n        ctx.lineWidth = 1;\n        ctx.stroke();\n      }\n    });\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      position: 'relative',\n      width: '100%',\n      height: '100%'\n    },\n    children: [process.env.NODE_ENV === 'development' && /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        position: 'absolute',\n        top: 0,\n        left: 0,\n        background: 'rgba(0,0,0,0.7)',\n        color: 'white',\n        padding: '5px',\n        fontSize: '10px',\n        zIndex: 20\n      },\n      children: [\"Debug: showVideo=\", showVideo.toString(), \", hasFile=\", (!!videoFile).toString(), \", hasVideoRef=\", (!!videoRef).toString()]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 425,\n      columnNumber: 9\n    }, this), !videoRef && videoFile && /*#__PURE__*/_jsxDEV(\"video\", {\n      ref: internalVideoRef,\n      src: videoUrl,\n      style: {\n        width: '100%',\n        height: 'auto',\n        display: 'block',\n        backgroundColor: '#000',\n        minHeight: '300px'\n      },\n      controls: true,\n      autoPlay: autoPlay,\n      muted: true,\n      loop: loop,\n      onLoadedData: () => console.log('Internal video loaded successfully'),\n      onLoadedMetadata: () => console.log('Video metadata loaded'),\n      onCanPlay: () => console.log('Video can play'),\n      onPlay: () => console.log('Internal video playing'),\n      onError: e => {\n        console.error('Internal video error:', e);\n        console.error('Video element error details:', e.target.error);\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 441,\n      columnNumber: 9\n    }, this), !videoRef && !videoFile && /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        width: '100%',\n        height: '300px',\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n        backgroundColor: '#f5f5f5',\n        color: '#666',\n        border: '2px dashed #ddd',\n        borderRadius: '8px',\n        fontSize: '16px'\n      },\n      children: \"Preview area - Select a video to preview\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 468,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"canvas\", {\n      ref: canvasRef,\n      style: {\n        position: 'absolute',\n        top: 0,\n        left: 0,\n        width: '100%',\n        height: '100%',\n        pointerEvents: 'none',\n        zIndex: 10\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 484,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 422,\n    columnNumber: 5\n  }, this);\n};\n_s(KeypointOverlay, \"axeDOlDzwRBpGl6vicGkxkWSUGw=\");\n_c = KeypointOverlay;\nexport default KeypointOverlay;\nvar _c;\n$RefreshReg$(_c, \"KeypointOverlay\");","map":{"version":3,"names":["React","useRef","useEffect","useState","jsxDEV","_jsxDEV","KeypointOverlay","videoRef","isPlaying","onKeypointsDetected","autoPlay","loop","videoFile","_s","canvasRef","internalVideoRef","isInitialized","setIsInitialized","pose","setPose","videoUrl","setVideoUrl","showVideo","setShowVideo","activeVideoRef","POSE_CONNECTIONS","initializeMediaPipe","window","Pose","loadScript","poseInstance","locateFile","file","setOptions","modelComplexity","smoothLandmarks","enableSegmentation","smoothSegmentation","minDetectionConfidence","minTrackingConfidence","onResults","error","console","close","src","Promise","resolve","reject","document","querySelector","script","createElement","onload","onerror","head","appendChild","log","fileName","name","url","URL","createObjectURL","current","video","load","autoplay","muted","revokeObjectURL","hasVideoFile","hasVideoRef","canvas","processFrame","paused","ended","videoWidth","videoHeight","rect","getBoundingClientRect","width","height","send","image","requestAnimationFrame","handleLoadedMetadata","handleLoadedData","play","then","catch","handleCanPlay","handlePlay","handleLoadStart","ctx","getContext","clearRect","handleError","e","addEventListener","readyState","removeEventListener","observer","MutationObserver","mutations","forEach","mutation","type","attributeName","observe","attributes","attributeFilter","disconnect","results","poseLandmarks","drawPoseMediaPipe","landmarks","videoRect","displayWidth","displayHeight","videoAspect","displayAspect","actualVideoWidth","actualVideoHeight","offsetX","offsetY","scaleX","scaleY","i","j","kp1","kp2","visibility","beginPath","moveTo","x","y","lineTo","strokeStyle","lineWidth","stroke","landmark","index","arc","Math","PI","fillStyle","fill","style","position","children","process","env","NODE_ENV","top","left","background","color","padding","fontSize","zIndex","toString","_jsxFileName","lineNumber","columnNumber","ref","display","backgroundColor","minHeight","controls","onLoadedData","onLoadedMetadata","onCanPlay","onPlay","onError","target","alignItems","justifyContent","border","borderRadius","pointerEvents","_c","$RefreshReg$"],"sources":["C:/Fit/frontend/src/components/KeypointOverlay.js"],"sourcesContent":["import React, { useRef, useEffect, useState } from 'react';\r\n\r\nconst KeypointOverlay = ({ videoRef, isPlaying, onKeypointsDetected, autoPlay = true, loop = true, videoFile = null }) => {\r\n  const canvasRef = useRef(null);\r\n  const internalVideoRef = useRef(null);\r\n  const [isInitialized, setIsInitialized] = useState(false);\r\n  const [pose, setPose] = useState(null);\r\n  const [videoUrl, setVideoUrl] = useState(null);\r\n  const [showVideo, setShowVideo] = useState(false);\r\n\r\n  // Use internal video ref if no external videoRef is provided\r\n  const activeVideoRef = videoRef || internalVideoRef;\r\n\r\n  // MediaPipe Pose connections (33 landmarks)\r\n  const POSE_CONNECTIONS = [\r\n    // Face\r\n    [0, 1], [1, 2], [2, 3], [3, 7], [0, 4], [4, 5], [5, 6], [6, 8],\r\n    // Arms\r\n    [9, 10], [11, 12], [11, 13], [13, 15], [15, 17], [15, 19], [15, 21], [17, 19],\r\n    [12, 14], [14, 16], [16, 18], [16, 20], [16, 22], [18, 20],\r\n    // Body\r\n    [11, 23], [12, 24], [23, 24],\r\n    // Legs\r\n    [23, 25], [24, 26], [25, 27], [26, 28], [27, 29], [28, 30], [29, 31], [30, 32], [27, 31], [28, 32]\r\n  ];\r\n\r\n  useEffect(() => {\r\n    const initializeMediaPipe = async () => {\r\n      try {\r\n        // โหลด MediaPipe จาก CDN\r\n        if (!window.Pose) {\r\n          // โหลด scripts จาก CDN\r\n          await loadScript('https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js');\r\n          await loadScript('https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js');\r\n          await loadScript('https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js');\r\n          await loadScript('https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js');\r\n        }\r\n\r\n        const poseInstance = new window.Pose({\r\n          locateFile: (file) => {\r\n            return `https://cdn.jsdelivr.net/npm/@mediapipe/pose/${file}`;\r\n          }\r\n        });\r\n\r\n        poseInstance.setOptions({\r\n          modelComplexity: 1,\r\n          smoothLandmarks: true,\r\n          enableSegmentation: false,\r\n          smoothSegmentation: true,\r\n          minDetectionConfidence: 0.5,\r\n          minTrackingConfidence: 0.5\r\n        });\r\n\r\n        poseInstance.onResults(onResults);\r\n        setPose(poseInstance);\r\n        setIsInitialized(true);\r\n      } catch (error) {\r\n        console.error('Failed to load MediaPipe:', error);\r\n      }\r\n    };\r\n\r\n    initializeMediaPipe();\r\n  }, []);\r\n\r\n  // Cleanup effect\r\n  useEffect(() => {\r\n    return () => {\r\n      if (pose) {\r\n        pose.close();\r\n      }\r\n    };\r\n  }, [pose]);\r\n\r\n  // Helper function to load scripts\r\n  const loadScript = (src) => {\r\n    return new Promise((resolve, reject) => {\r\n      if (document.querySelector(`script[src=\"${src}\"]`)) {\r\n        resolve();\r\n        return;\r\n      }\r\n      const script = document.createElement('script');\r\n      script.src = src;\r\n      script.onload = resolve;\r\n      script.onerror = reject;\r\n      document.head.appendChild(script);\r\n    });\r\n  };\r\n\r\n  // Handle video file upload\r\n  useEffect(() => {\r\n    console.log('Video file effect triggered:', { videoFile: !!videoFile, fileName: videoFile?.name });\r\n    \r\n    if (videoFile) {\r\n      try {\r\n        // Create object URL for the uploaded file\r\n        const url = URL.createObjectURL(videoFile);\r\n        setVideoUrl(url);\r\n        setShowVideo(true);\r\n        \r\n        console.log('Video URL created:', url);\r\n        \r\n        // If we have a video element, set the source\r\n        if (activeVideoRef?.current) {\r\n          const video = activeVideoRef.current;\r\n          video.src = url;\r\n          video.load();\r\n          \r\n          // Set video properties immediately\r\n          video.autoplay = autoPlay;\r\n          video.muted = true;\r\n          video.loop = loop;\r\n          \r\n          console.log('Video properties set, starting load');\r\n        }\r\n        \r\n        // Cleanup function for this effect\r\n        return () => {\r\n          console.log('Cleaning up video URL');\r\n          if (videoUrl) {\r\n            URL.revokeObjectURL(videoUrl);\r\n          }\r\n          URL.revokeObjectURL(url);\r\n        };\r\n      } catch (error) {\r\n        console.error('Error creating video URL:', error);\r\n        setShowVideo(false);\r\n      }\r\n    } else {\r\n      console.log('No video file, hiding video');\r\n      setShowVideo(false);\r\n      setVideoUrl(null);\r\n    }\r\n  }, [videoFile, autoPlay, loop]);\r\n\r\n  // Debug effect to log state changes\r\n  useEffect(() => {\r\n    console.log('State changed:', { \r\n      showVideo, \r\n      hasVideoFile: !!videoFile, \r\n      hasVideoRef: !!videoRef,\r\n      videoUrl: !!videoUrl \r\n    });\r\n  }, [showVideo, videoFile, videoRef, videoUrl]);\r\n\r\n  useEffect(() => {\r\n    if (!isInitialized || !pose || !activeVideoRef?.current || !canvasRef.current) return;\r\n\r\n    const video = activeVideoRef.current;\r\n    const canvas = canvasRef.current;\r\n    \r\n    const processFrame = async () => {\r\n      if (video.paused || video.ended || !video.videoWidth || !video.videoHeight) return;\r\n      \r\n      try {\r\n        // Match canvas size to video element's display size exactly\r\n        const rect = video.getBoundingClientRect();\r\n        if (canvas.width !== rect.width || canvas.height !== rect.height) {\r\n          canvas.width = rect.width;\r\n          canvas.height = rect.height;\r\n        }\r\n        \r\n        // Send frame to MediaPipe\r\n        await pose.send({ image: video });\r\n      } catch (error) {\r\n        console.error('Pose detection error:', error);\r\n      }\r\n\r\n      // Continue processing frames as long as video is playing\r\n      if (!video.paused && !video.ended) {\r\n        requestAnimationFrame(processFrame);\r\n      }\r\n    };\r\n\r\n    // Handle video events for auto-processing\r\n    const handleLoadedMetadata = () => {\r\n      console.log('Video metadata loaded:', video.videoWidth, 'x', video.videoHeight);\r\n      const rect = video.getBoundingClientRect();\r\n      canvas.width = rect.width;\r\n      canvas.height = rect.height;\r\n    };\r\n\r\n    const handleLoadedData = () => {\r\n      console.log('Video data loaded, starting playback');\r\n      // Auto-start processing when video data is loaded\r\n      if (autoPlay) {\r\n        video.play().then(() => {\r\n          console.log('Video playing automatically');\r\n          processFrame();\r\n        }).catch(error => {\r\n          console.log('Auto-play was prevented:', error);\r\n          processFrame();\r\n        });\r\n      } else {\r\n        processFrame();\r\n      }\r\n    };\r\n\r\n    const handleCanPlay = () => {\r\n      // Start processing as soon as video can play\r\n      if (autoPlay && video.paused) {\r\n        video.play().catch(error => {\r\n          console.log('Auto-play was prevented in canplay:', error);\r\n        });\r\n      }\r\n      processFrame();\r\n    };\r\n\r\n    const handlePlay = () => {\r\n      console.log('Video play event triggered');\r\n      processFrame();\r\n    };\r\n\r\n    const handleLoadStart = () => {\r\n      console.log('Video load start');\r\n      // Clear canvas when new video starts loading\r\n      const ctx = canvas.getContext('2d');\r\n      ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n    };\r\n\r\n    const handleError = (e) => {\r\n      console.error('Video error:', e, video.error);\r\n    };\r\n\r\n    // Add event listeners\r\n    video.addEventListener('loadstart', handleLoadStart);\r\n    video.addEventListener('loadedmetadata', handleLoadedMetadata);\r\n    video.addEventListener('loadeddata', handleLoadedData);\r\n    video.addEventListener('canplay', handleCanPlay);\r\n    video.addEventListener('play', handlePlay);\r\n    video.addEventListener('error', handleError);\r\n\r\n    // Start processing immediately if video is already ready\r\n    if (video.readyState >= 2 && video.videoWidth && video.videoHeight) {\r\n      console.log('Video already ready, starting immediately');\r\n      const rect = video.getBoundingClientRect();\r\n      canvas.width = rect.width;\r\n      canvas.height = rect.height;\r\n      \r\n      if (autoPlay && video.paused) {\r\n        video.play().catch(error => {\r\n          console.log('Auto-play was prevented on ready:', error);\r\n        });\r\n      }\r\n      processFrame();\r\n    }\r\n\r\n    // Cleanup function\r\n    return () => {\r\n      video.removeEventListener('loadstart', handleLoadStart);\r\n      video.removeEventListener('loadedmetadata', handleLoadedMetadata);\r\n      video.removeEventListener('loadeddata', handleLoadedData);\r\n      video.removeEventListener('canplay', handleCanPlay);\r\n      video.removeEventListener('play', handlePlay);\r\n      video.removeEventListener('error', handleError);\r\n    };\r\n  }, [isInitialized, pose, autoPlay, loop, videoUrl]);\r\n\r\n  // Watch for video source changes - only for external videoRef\r\n  useEffect(() => {\r\n    if (!videoRef?.current) return;\r\n    \r\n    const video = videoRef.current;\r\n    \r\n    // Observer to watch for src attribute changes\r\n    const observer = new MutationObserver((mutations) => {\r\n      mutations.forEach((mutation) => {\r\n        if (mutation.type === 'attributes' && mutation.attributeName === 'src') {\r\n          // Video source changed, start processing\r\n          if (video.src && video.readyState >= 1) {\r\n            if (autoPlay) {\r\n              video.play().catch(error => {\r\n                console.log('Auto-play was prevented:', error);\r\n              });\r\n            }\r\n          }\r\n        }\r\n      });\r\n    });\r\n\r\n    observer.observe(video, {\r\n      attributes: true,\r\n      attributeFilter: ['src']\r\n    });\r\n\r\n    return () => {\r\n      observer.disconnect();\r\n    };\r\n  }, [videoRef, autoPlay]);\r\n\r\n  // Additional effect to handle manual play/pause - use activeVideoRef\r\n  useEffect(() => {\r\n    if (!activeVideoRef?.current || !canvasRef.current) return;\r\n\r\n    const video = activeVideoRef.current;\r\n    const canvas = canvasRef.current;\r\n\r\n    if (!isPlaying) {\r\n      const ctx = canvas.getContext('2d');\r\n      ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n    }\r\n  }, [isPlaying]);\r\n\r\n  const onResults = (results) => {\r\n    const canvas = canvasRef.current;\r\n    const video = activeVideoRef.current; // Fix: use activeVideoRef instead of videoRef\r\n    if (!canvas || !video || !results.poseLandmarks) return;\r\n\r\n    try {\r\n      drawPoseMediaPipe(results.poseLandmarks, canvas, video);\r\n      \r\n      if (onKeypointsDetected) {\r\n        onKeypointsDetected(results.poseLandmarks);\r\n      }\r\n    } catch (error) {\r\n      console.error('Drawing error:', error);\r\n    }\r\n  };\r\n\r\n  const drawPoseMediaPipe = (landmarks, canvas, video) => {\r\n    const ctx = canvas.getContext('2d');\r\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n\r\n    // Check if video has valid dimensions\r\n    if (!video.videoWidth || !video.videoHeight) return;\r\n\r\n    // Get actual video dimensions and display dimensions\r\n    const videoRect = video.getBoundingClientRect();\r\n    const videoWidth = video.videoWidth;\r\n    const videoHeight = video.videoHeight;\r\n    const displayWidth = videoRect.width;\r\n    const displayHeight = videoRect.height;\r\n\r\n    // Prevent division by zero\r\n    if (displayWidth === 0 || displayHeight === 0) return;\r\n\r\n    // Calculate aspect ratios\r\n    const videoAspect = videoWidth / videoHeight;\r\n    const displayAspect = displayWidth / displayHeight;\r\n\r\n    // Calculate actual video display area within the video element\r\n    let actualVideoWidth, actualVideoHeight, offsetX = 0, offsetY = 0;\r\n\r\n    if (videoAspect > displayAspect) {\r\n      // Video is wider - letterboxed top/bottom\r\n      actualVideoWidth = displayWidth;\r\n      actualVideoHeight = displayWidth / videoAspect;\r\n      offsetY = (displayHeight - actualVideoHeight) / 2;\r\n    } else {\r\n      // Video is taller - letterboxed left/right\r\n      actualVideoHeight = displayHeight;\r\n      actualVideoWidth = displayHeight * videoAspect;\r\n      offsetX = (displayWidth - actualVideoWidth) / 2;\r\n    }\r\n\r\n    // MediaPipe landmarks are normalized (0-1), scale to actual video area\r\n    const scaleX = actualVideoWidth;\r\n    const scaleY = actualVideoHeight;\r\n\r\n    // Draw skeleton connections\r\n    POSE_CONNECTIONS.forEach(([i, j]) => {\r\n      const kp1 = landmarks[i];\r\n      const kp2 = landmarks[j];\r\n      \r\n      if (kp1 && kp2 && kp1.visibility > 0.5 && kp2.visibility > 0.5) {\r\n        ctx.beginPath();\r\n        ctx.moveTo(\r\n          kp1.x * scaleX + offsetX, \r\n          kp1.y * scaleY + offsetY\r\n        );\r\n        ctx.lineTo(\r\n          kp2.x * scaleX + offsetX, \r\n          kp2.y * scaleY + offsetY\r\n        );\r\n        ctx.strokeStyle = '#00FF00';\r\n        ctx.lineWidth = 2;\r\n        ctx.stroke();\r\n      }\r\n    });\r\n\r\n    // Draw keypoints with different colors\r\n    landmarks.forEach((landmark, index) => {\r\n      if (landmark && landmark.visibility > 0.5) {\r\n        ctx.beginPath();\r\n        ctx.arc(\r\n          landmark.x * scaleX + offsetX,\r\n          landmark.y * scaleY + offsetY,\r\n          3,\r\n          0,\r\n          2 * Math.PI\r\n        );\r\n        \r\n        // Different colors for different body parts\r\n        if (index <= 10) {\r\n          ctx.fillStyle = '#FF6B6B'; // Face and upper body\r\n        } else if (index <= 16) {\r\n          ctx.fillStyle = '#4ECDC4'; // Arms\r\n        } else if (index <= 22) {\r\n          ctx.fillStyle = '#45B7D1'; // Hands\r\n        } else {\r\n          ctx.fillStyle = '#96CEB4'; // Legs and body\r\n        }\r\n        \r\n        ctx.fill();\r\n        \r\n        // Add white border for better visibility\r\n        ctx.beginPath();\r\n        ctx.arc(\r\n          landmark.x * scaleX + offsetX,\r\n          landmark.y * scaleY + offsetY,\r\n          3,\r\n          0,\r\n          2 * Math.PI\r\n        );\r\n        ctx.strokeStyle = '#FFFFFF';\r\n        ctx.lineWidth = 1;\r\n        ctx.stroke();\r\n      }\r\n    });\r\n  };\r\n\r\n  return (\r\n    <div style={{ position: 'relative', width: '100%', height: '100%' }}>\r\n      {/* Debug info */}\r\n      {process.env.NODE_ENV === 'development' && (\r\n        <div style={{ \r\n          position: 'absolute', \r\n          top: 0, \r\n          left: 0, \r\n          background: 'rgba(0,0,0,0.7)', \r\n          color: 'white', \r\n          padding: '5px', \r\n          fontSize: '10px',\r\n          zIndex: 20\r\n        }}>\r\n          Debug: showVideo={showVideo.toString()}, hasFile={(!!videoFile).toString()}, hasVideoRef={(!!videoRef).toString()}\r\n        </div>\r\n      )}\r\n      \r\n      {/* Show video element when we have a video file and no external videoRef */}\r\n      {!videoRef && videoFile && (\r\n        <video\r\n          ref={internalVideoRef}\r\n          src={videoUrl}\r\n          style={{\r\n            width: '100%',\r\n            height: 'auto',\r\n            display: 'block',\r\n            backgroundColor: '#000',\r\n            minHeight: '300px'\r\n          }}\r\n          controls\r\n          autoPlay={autoPlay}\r\n          muted\r\n          loop={loop}\r\n          onLoadedData={() => console.log('Internal video loaded successfully')}\r\n          onLoadedMetadata={() => console.log('Video metadata loaded')}\r\n          onCanPlay={() => console.log('Video can play')}\r\n          onPlay={() => console.log('Internal video playing')}\r\n          onError={(e) => {\r\n            console.error('Internal video error:', e);\r\n            console.error('Video element error details:', e.target.error);\r\n          }}\r\n        />\r\n      )}\r\n      \r\n      {/* Show placeholder when no video is selected */}\r\n      {!videoRef && !videoFile && (\r\n        <div style={{\r\n          width: '100%',\r\n          height: '300px',\r\n          display: 'flex',\r\n          alignItems: 'center',\r\n          justifyContent: 'center',\r\n          backgroundColor: '#f5f5f5',\r\n          color: '#666',\r\n          border: '2px dashed #ddd',\r\n          borderRadius: '8px',\r\n          fontSize: '16px'\r\n        }}>\r\n          Preview area - Select a video to preview\r\n        </div>\r\n      )}\r\n      \r\n      <canvas\r\n        ref={canvasRef}\r\n        style={{\r\n          position: 'absolute',\r\n          top: 0,\r\n          left: 0,\r\n          width: '100%',\r\n          height: '100%',\r\n          pointerEvents: 'none',\r\n          zIndex: 10\r\n        }}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default KeypointOverlay;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}