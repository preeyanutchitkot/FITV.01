{"ast":null,"code":"var _jsxFileName = \"C:\\\\Fit\\\\frontend\\\\src\\\\components\\\\KeypointOverlay.js\",\n  _s = $RefreshSig$();\nimport React, { useRef, useEffect, useState } from 'react';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst KeypointOverlay = ({\n  videoRef,\n  isPlaying,\n  onKeypointsDetected\n}) => {\n  _s();\n  const canvasRef = useRef(null);\n  const [isInitialized, setIsInitialized] = useState(false);\n  const [poseNet, setPoseNet] = useState(null);\n\n  // PoseNet skeleton connections (ใช้ TensorFlow.js แทน MediaPipe)\n  const POSE_CONNECTIONS = [\n  // หัวและคอ\n  [0, 1], [0, 2], [1, 3], [2, 4],\n  // แขน\n  [5, 6], [5, 7], [7, 9], [6, 8], [8, 10],\n  // ลำตัว\n  [5, 11], [6, 12], [11, 12],\n  // ขา\n  [11, 13], [12, 14], [13, 15], [14, 16]];\n  useEffect(() => {\n    const initializePoseNet = async () => {\n      try {\n        // ใช้ TensorFlow.js PoseNet แทน MediaPipe\n        const tf = await import('@tensorflow/tfjs');\n        const posenet = await import('@tensorflow-models/posenet');\n        const net = await posenet.load({\n          architecture: 'MobileNetV1',\n          outputStride: 16,\n          inputResolution: {\n            width: 640,\n            height: 480\n          },\n          multiplier: 0.75\n        });\n        setPoseNet(net);\n        setIsInitialized(true);\n      } catch (error) {\n        console.error('Failed to load PoseNet:', error);\n      }\n    };\n    initializePoseNet();\n  }, []);\n  useEffect(() => {\n    if (!isInitialized || !poseNet || !(videoRef !== null && videoRef !== void 0 && videoRef.current) || !canvasRef.current) return;\n    const video = videoRef.current;\n    const canvas = canvasRef.current;\n    const processFrame = async () => {\n      if (video.paused || video.ended || !isPlaying) return;\n      try {\n        // Match canvas size to video display size\n        const rect = video.getBoundingClientRect();\n        canvas.width = rect.width;\n        canvas.height = rect.height;\n\n        // Estimate pose\n        const pose = await poseNet.estimateSinglePose(video, {\n          flipHorizontal: false\n        });\n        if (pose && pose.score > 0.3) {\n          drawPose(pose, canvas, video);\n          if (onKeypointsDetected) {\n            onKeypointsDetected(pose.keypoints);\n          }\n        }\n      } catch (error) {\n        console.error('Pose detection error:', error);\n      }\n      if (isPlaying && !video.paused && !video.ended) {\n        requestAnimationFrame(processFrame);\n      }\n    };\n    if (isPlaying) {\n      if (video.readyState >= 2) {\n        processFrame();\n      } else {\n        video.addEventListener('loadeddata', processFrame, {\n          once: true\n        });\n      }\n    }\n\n    // Clean up canvas when not playing\n    if (!isPlaying) {\n      const ctx = canvas.getContext('2d');\n      ctx.clearRect(0, 0, canvas.width, canvas.height);\n    }\n  }, [isPlaying, isInitialized, poseNet]);\n  const drawPose = (pose, canvas, video) => {\n    const ctx = canvas.getContext('2d');\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n    // Calculate scaling factors\n    const videoRect = video.getBoundingClientRect();\n    const scaleX = videoRect.width / video.videoWidth;\n    const scaleY = videoRect.height / video.videoHeight;\n\n    // Draw skeleton connections\n    POSE_CONNECTIONS.forEach(([i, j]) => {\n      const kp1 = pose.keypoints[i];\n      const kp2 = pose.keypoints[j];\n      if (kp1.score > 0.2 && kp2.score > 0.2) {\n        ctx.beginPath();\n        ctx.moveTo(kp1.position.x * scaleX, kp1.position.y * scaleY);\n        ctx.lineTo(kp2.position.x * scaleX, kp2.position.y * scaleY);\n        ctx.strokeStyle = '#00FF00';\n        ctx.lineWidth = 3;\n        ctx.stroke();\n      }\n    });\n\n    // Draw keypoints\n    pose.keypoints.forEach(keypoint => {\n      if (keypoint.score > 0.2) {\n        ctx.beginPath();\n        ctx.arc(keypoint.position.x * scaleX, keypoint.position.y * scaleY, 4, 0, 2 * Math.PI);\n        ctx.fillStyle = '#FF0000';\n        ctx.fill();\n      }\n    });\n  };\n  return /*#__PURE__*/_jsxDEV(\"canvas\", {\n    ref: canvasRef,\n    style: {\n      position: 'absolute',\n      top: 0,\n      left: 0,\n      width: '100%',\n      height: '100%',\n      pointerEvents: 'none',\n      zIndex: 10\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 137,\n    columnNumber: 5\n  }, this);\n};\n_s(KeypointOverlay, \"WNeCpfJhTT+wqfw6Jepch6JQl+Y=\");\n_c = KeypointOverlay;\nexport default KeypointOverlay;\nvar _c;\n$RefreshReg$(_c, \"KeypointOverlay\");","map":{"version":3,"names":["React","useRef","useEffect","useState","jsxDEV","_jsxDEV","KeypointOverlay","videoRef","isPlaying","onKeypointsDetected","_s","canvasRef","isInitialized","setIsInitialized","poseNet","setPoseNet","POSE_CONNECTIONS","initializePoseNet","tf","posenet","net","load","architecture","outputStride","inputResolution","width","height","multiplier","error","console","current","video","canvas","processFrame","paused","ended","rect","getBoundingClientRect","pose","estimateSinglePose","flipHorizontal","score","drawPose","keypoints","requestAnimationFrame","readyState","addEventListener","once","ctx","getContext","clearRect","videoRect","scaleX","videoWidth","scaleY","videoHeight","forEach","i","j","kp1","kp2","beginPath","moveTo","position","x","y","lineTo","strokeStyle","lineWidth","stroke","keypoint","arc","Math","PI","fillStyle","fill","ref","style","top","left","pointerEvents","zIndex","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["C:/Fit/frontend/src/components/KeypointOverlay.js"],"sourcesContent":["import React, { useRef, useEffect, useState } from 'react';\r\n\r\nconst KeypointOverlay = ({ videoRef, isPlaying, onKeypointsDetected }) => {\r\n  const canvasRef = useRef(null);\r\n  const [isInitialized, setIsInitialized] = useState(false);\r\n  const [poseNet, setPoseNet] = useState(null);\r\n\r\n  // PoseNet skeleton connections (ใช้ TensorFlow.js แทน MediaPipe)\r\n  const POSE_CONNECTIONS = [\r\n    // หัวและคอ\r\n    [0, 1], [0, 2], [1, 3], [2, 4],\r\n    // แขน\r\n    [5, 6], [5, 7], [7, 9], [6, 8], [8, 10],\r\n    // ลำตัว\r\n    [5, 11], [6, 12], [11, 12],\r\n    // ขา\r\n    [11, 13], [12, 14], [13, 15], [14, 16]\r\n  ];\r\n\r\n  useEffect(() => {\r\n    const initializePoseNet = async () => {\r\n      try {\r\n        // ใช้ TensorFlow.js PoseNet แทน MediaPipe\r\n        const tf = await import('@tensorflow/tfjs');\r\n        const posenet = await import('@tensorflow-models/posenet');\r\n        \r\n        const net = await posenet.load({\r\n          architecture: 'MobileNetV1',\r\n          outputStride: 16,\r\n          inputResolution: { width: 640, height: 480 },\r\n          multiplier: 0.75\r\n        });\r\n        \r\n        setPoseNet(net);\r\n        setIsInitialized(true);\r\n      } catch (error) {\r\n        console.error('Failed to load PoseNet:', error);\r\n      }\r\n    };\r\n\r\n    initializePoseNet();\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (!isInitialized || !poseNet || !videoRef?.current || !canvasRef.current) return;\r\n\r\n    const video = videoRef.current;\r\n    const canvas = canvasRef.current;\r\n    \r\n    const processFrame = async () => {\r\n      if (video.paused || video.ended || !isPlaying) return;\r\n      \r\n      try {\r\n        // Match canvas size to video display size\r\n        const rect = video.getBoundingClientRect();\r\n        canvas.width = rect.width;\r\n        canvas.height = rect.height;\r\n        \r\n        // Estimate pose\r\n        const pose = await poseNet.estimateSinglePose(video, {\r\n          flipHorizontal: false\r\n        });\r\n\r\n        if (pose && pose.score > 0.3) {\r\n          drawPose(pose, canvas, video);\r\n          \r\n          if (onKeypointsDetected) {\r\n            onKeypointsDetected(pose.keypoints);\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.error('Pose detection error:', error);\r\n      }\r\n\r\n      if (isPlaying && !video.paused && !video.ended) {\r\n        requestAnimationFrame(processFrame);\r\n      }\r\n    };\r\n\r\n    if (isPlaying) {\r\n      if (video.readyState >= 2) {\r\n        processFrame();\r\n      } else {\r\n        video.addEventListener('loadeddata', processFrame, { once: true });\r\n      }\r\n    }\r\n\r\n    // Clean up canvas when not playing\r\n    if (!isPlaying) {\r\n      const ctx = canvas.getContext('2d');\r\n      ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n    }\r\n  }, [isPlaying, isInitialized, poseNet]);\r\n\r\n  const drawPose = (pose, canvas, video) => {\r\n    const ctx = canvas.getContext('2d');\r\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n\r\n    // Calculate scaling factors\r\n    const videoRect = video.getBoundingClientRect();\r\n    const scaleX = videoRect.width / video.videoWidth;\r\n    const scaleY = videoRect.height / video.videoHeight;\r\n\r\n    // Draw skeleton connections\r\n    POSE_CONNECTIONS.forEach(([i, j]) => {\r\n      const kp1 = pose.keypoints[i];\r\n      const kp2 = pose.keypoints[j];\r\n      \r\n      if (kp1.score > 0.2 && kp2.score > 0.2) {\r\n        ctx.beginPath();\r\n        ctx.moveTo(kp1.position.x * scaleX, kp1.position.y * scaleY);\r\n        ctx.lineTo(kp2.position.x * scaleX, kp2.position.y * scaleY);\r\n        ctx.strokeStyle = '#00FF00';\r\n        ctx.lineWidth = 3;\r\n        ctx.stroke();\r\n      }\r\n    });\r\n\r\n    // Draw keypoints\r\n    pose.keypoints.forEach((keypoint) => {\r\n      if (keypoint.score > 0.2) {\r\n        ctx.beginPath();\r\n        ctx.arc(\r\n          keypoint.position.x * scaleX,\r\n          keypoint.position.y * scaleY,\r\n          4,\r\n          0,\r\n          2 * Math.PI\r\n        );\r\n        ctx.fillStyle = '#FF0000';\r\n        ctx.fill();\r\n      }\r\n    });\r\n  };\r\n\r\n  return (\r\n    <canvas\r\n      ref={canvasRef}\r\n      style={{\r\n        position: 'absolute',\r\n        top: 0,\r\n        left: 0,\r\n        width: '100%',\r\n        height: '100%',\r\n        pointerEvents: 'none',\r\n        zIndex: 10\r\n      }}\r\n    />\r\n  );\r\n};\r\n\r\nexport default KeypointOverlay;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}