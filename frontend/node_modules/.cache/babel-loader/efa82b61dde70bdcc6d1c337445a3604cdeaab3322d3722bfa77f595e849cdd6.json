{"ast":null,"code":"// KeypointsProcessor.js - Service à¸ªà¸³à¸«à¸£à¸±à¸šà¸›à¸£à¸°à¸¡à¸§à¸¥à¸œà¸¥ keypoints à¸«à¸¥à¸±à¸‡ upload video\n\nclass KeypointsProcessor {\n  constructor(baseURL = 'http://localhost:8000') {\n    this.baseURL = baseURL;\n  }\n\n  // à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™à¸à¸²à¸£à¸›à¸£à¸°à¸¡à¸§à¸¥à¸œà¸¥ keypoints à¸ªà¸³à¸«à¸£à¸±à¸šà¸§à¸´à¸”à¸µà¹‚à¸­à¸—à¸µà¹ˆ upload à¹ƒà¸«à¸¡à¹ˆ\n  async processVideoKeypoints(videoId, onProgress = null) {\n    try {\n      console.log(`ðŸš€ Starting keypoints processing for video ${videoId}`);\n\n      // 1. à¸”à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ segments à¸‚à¸­à¸‡à¸§à¸´à¸”à¸µà¹‚à¸­\n      const segments = await this.getVideoSegments(videoId);\n      if (!segments || segments.segments.length === 0) {\n        throw new Error('No segments found for this video');\n      }\n      console.log(`ðŸ“Š Found ${segments.segments.length} segments to process`);\n      let processedCount = 0;\n      const results = [];\n\n      // 2. à¸›à¸£à¸°à¸¡à¸§à¸¥à¸œà¸¥ keypoints à¹à¸•à¹ˆà¸¥à¸° segment\n      for (const segment of segments.segments) {\n        try {\n          if (onProgress) {\n            onProgress({\n              current: processedCount + 1,\n              total: segments.segments.length,\n              status: `Processing segment ${segment.segment_id}...`,\n              segmentId: segment.segment_id\n            });\n          }\n\n          // à¹€à¸£à¸µà¸¢à¸ backend script à¹€à¸žà¸·à¹ˆà¸­ extract keypoints\n          const result = await this.extractSegmentKeypoints(videoId, segment.segment_id);\n          results.push({\n            segmentId: segment.segment_id,\n            success: true,\n            keypointsFile: result.keypoints_file,\n            framesCount: result.frames_count || 0\n          });\n          processedCount++;\n          console.log(`âœ… Segment ${segment.segment_id} processed successfully`);\n        } catch (error) {\n          console.error(`âŒ Error processing segment ${segment.segment_id}:`, error);\n          results.push({\n            segmentId: segment.segment_id,\n            success: false,\n            error: error.message\n          });\n        }\n      }\n\n      // 3. à¸ªà¸£à¸¸à¸›à¸œà¸¥à¸à¸²à¸£à¸›à¸£à¸°à¸¡à¸§à¸¥à¸œà¸¥\n      const successCount = results.filter(r => r.success).length;\n      const failCount = results.filter(r => !r.success).length;\n      if (onProgress) {\n        onProgress({\n          current: segments.segments.length,\n          total: segments.segments.length,\n          status: `Completed! ${successCount} success, ${failCount} failed`,\n          completed: true\n        });\n      }\n      return {\n        success: true,\n        videoId: videoId,\n        totalSegments: segments.segments.length,\n        processedSuccessfully: successCount,\n        processedWithErrors: failCount,\n        results: results\n      };\n    } catch (error) {\n      console.error('âŒ Error processing video keypoints:', error);\n      throw error;\n    }\n  }\n\n  // à¸”à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ segments à¸‚à¸­à¸‡à¸§à¸´à¸”à¸µà¹‚à¸­\n  async getVideoSegments(videoId) {\n    const response = await fetch(`${this.baseURL}/keypoints/videos/${videoId}/segments`);\n    if (!response.ok) {\n      throw new Error(`Failed to get video segments: ${response.status}`);\n    }\n    return await response.json();\n  }\n\n  // Extract keypoints à¸ªà¸³à¸«à¸£à¸±à¸š segment à¹€à¸‰à¸žà¸²à¸°\n  async extractSegmentKeypoints(videoId, segmentId) {\n    const response = await fetch(`${this.baseURL}/keypoints/extract-segment`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        video_id: videoId,\n        segment_id: segmentId\n      })\n    });\n    if (!response.ok) {\n      const errorData = await response.json().catch(() => ({}));\n      throw new Error(errorData.detail || `HTTP ${response.status}`);\n    }\n    return await response.json();\n  }\n\n  // à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸ªà¸–à¸²à¸™à¸° keypoints à¸‚à¸­à¸‡à¸§à¸´à¸”à¸µà¹‚à¸­\n  async checkKeypointsStatus(videoId) {\n    try {\n      const segments = await this.getVideoSegments(videoId);\n      const status = {\n        totalSegments: segments.segments.length,\n        withKeypoints: segments.segments.filter(s => s.has_keypoints).length,\n        withoutKeypoints: segments.segments.filter(s => !s.has_keypoints).length,\n        segments: segments.segments.map(s => ({\n          segmentId: s.segment_id,\n          exerciseId: s.exercise_id,\n          startTime: s.start_time,\n          endTime: s.end_time,\n          hasKeypoints: s.has_keypoints,\n          keypointsFile: s.keypoints_file\n        }))\n      };\n      return status;\n    } catch (error) {\n      console.error('Error checking keypoints status:', error);\n      throw error;\n    }\n  }\n\n  // à¸¥à¸š keypoints à¸‚à¸­à¸‡ segment\n  async deleteSegmentKeypoints(videoId, segmentId) {\n    const response = await fetch(`${this.baseURL}/keypoints/videos/${videoId}/segments/${segmentId}/keypoints`, {\n      method: 'DELETE'\n    });\n    if (!response.ok) {\n      throw new Error(`Failed to delete keypoints: ${response.status}`);\n    }\n    return await response.json();\n  }\n}\nexport default KeypointsProcessor;","map":{"version":3,"names":["KeypointsProcessor","constructor","baseURL","processVideoKeypoints","videoId","onProgress","console","log","segments","getVideoSegments","length","Error","processedCount","results","segment","current","total","status","segment_id","segmentId","result","extractSegmentKeypoints","push","success","keypointsFile","keypoints_file","framesCount","frames_count","error","message","successCount","filter","r","failCount","completed","totalSegments","processedSuccessfully","processedWithErrors","response","fetch","ok","json","method","headers","body","JSON","stringify","video_id","errorData","catch","detail","checkKeypointsStatus","withKeypoints","s","has_keypoints","withoutKeypoints","map","exerciseId","exercise_id","startTime","start_time","endTime","end_time","hasKeypoints","deleteSegmentKeypoints"],"sources":["C:/Fit/frontend/src/services/KeypointsProcessor.js"],"sourcesContent":["// KeypointsProcessor.js - Service à¸ªà¸³à¸«à¸£à¸±à¸šà¸›à¸£à¸°à¸¡à¸§à¸¥à¸œà¸¥ keypoints à¸«à¸¥à¸±à¸‡ upload video\r\n\r\nclass KeypointsProcessor {\r\n    constructor(baseURL = 'http://localhost:8000') {\r\n        this.baseURL = baseURL;\r\n    }\r\n\r\n    // à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™à¸à¸²à¸£à¸›à¸£à¸°à¸¡à¸§à¸¥à¸œà¸¥ keypoints à¸ªà¸³à¸«à¸£à¸±à¸šà¸§à¸´à¸”à¸µà¹‚à¸­à¸—à¸µà¹ˆ upload à¹ƒà¸«à¸¡à¹ˆ\r\n    async processVideoKeypoints(videoId, onProgress = null) {\r\n        try {\r\n            console.log(`ðŸš€ Starting keypoints processing for video ${videoId}`);\r\n            \r\n            // 1. à¸”à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ segments à¸‚à¸­à¸‡à¸§à¸´à¸”à¸µà¹‚à¸­\r\n            const segments = await this.getVideoSegments(videoId);\r\n            \r\n            if (!segments || segments.segments.length === 0) {\r\n                throw new Error('No segments found for this video');\r\n            }\r\n\r\n            console.log(`ðŸ“Š Found ${segments.segments.length} segments to process`);\r\n\r\n            let processedCount = 0;\r\n            const results = [];\r\n\r\n            // 2. à¸›à¸£à¸°à¸¡à¸§à¸¥à¸œà¸¥ keypoints à¹à¸•à¹ˆà¸¥à¸° segment\r\n            for (const segment of segments.segments) {\r\n                try {\r\n                    if (onProgress) {\r\n                        onProgress({\r\n                            current: processedCount + 1,\r\n                            total: segments.segments.length,\r\n                            status: `Processing segment ${segment.segment_id}...`,\r\n                            segmentId: segment.segment_id\r\n                        });\r\n                    }\r\n\r\n                    // à¹€à¸£à¸µà¸¢à¸ backend script à¹€à¸žà¸·à¹ˆà¸­ extract keypoints\r\n                    const result = await this.extractSegmentKeypoints(videoId, segment.segment_id);\r\n                    \r\n                    results.push({\r\n                        segmentId: segment.segment_id,\r\n                        success: true,\r\n                        keypointsFile: result.keypoints_file,\r\n                        framesCount: result.frames_count || 0\r\n                    });\r\n\r\n                    processedCount++;\r\n                    \r\n                    console.log(`âœ… Segment ${segment.segment_id} processed successfully`);\r\n\r\n                } catch (error) {\r\n                    console.error(`âŒ Error processing segment ${segment.segment_id}:`, error);\r\n                    \r\n                    results.push({\r\n                        segmentId: segment.segment_id,\r\n                        success: false,\r\n                        error: error.message\r\n                    });\r\n                }\r\n            }\r\n\r\n            // 3. à¸ªà¸£à¸¸à¸›à¸œà¸¥à¸à¸²à¸£à¸›à¸£à¸°à¸¡à¸§à¸¥à¸œà¸¥\r\n            const successCount = results.filter(r => r.success).length;\r\n            const failCount = results.filter(r => !r.success).length;\r\n\r\n            if (onProgress) {\r\n                onProgress({\r\n                    current: segments.segments.length,\r\n                    total: segments.segments.length,\r\n                    status: `Completed! ${successCount} success, ${failCount} failed`,\r\n                    completed: true\r\n                });\r\n            }\r\n\r\n            return {\r\n                success: true,\r\n                videoId: videoId,\r\n                totalSegments: segments.segments.length,\r\n                processedSuccessfully: successCount,\r\n                processedWithErrors: failCount,\r\n                results: results\r\n            };\r\n\r\n        } catch (error) {\r\n            console.error('âŒ Error processing video keypoints:', error);\r\n            throw error;\r\n        }\r\n    }\r\n\r\n    // à¸”à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ segments à¸‚à¸­à¸‡à¸§à¸´à¸”à¸µà¹‚à¸­\r\n    async getVideoSegments(videoId) {\r\n        const response = await fetch(`${this.baseURL}/keypoints/videos/${videoId}/segments`);\r\n        \r\n        if (!response.ok) {\r\n            throw new Error(`Failed to get video segments: ${response.status}`);\r\n        }\r\n        \r\n        return await response.json();\r\n    }\r\n\r\n    // Extract keypoints à¸ªà¸³à¸«à¸£à¸±à¸š segment à¹€à¸‰à¸žà¸²à¸°\r\n    async extractSegmentKeypoints(videoId, segmentId) {\r\n        const response = await fetch(`${this.baseURL}/keypoints/extract-segment`, {\r\n            method: 'POST',\r\n            headers: {\r\n                'Content-Type': 'application/json',\r\n            },\r\n            body: JSON.stringify({\r\n                video_id: videoId,\r\n                segment_id: segmentId\r\n            })\r\n        });\r\n\r\n        if (!response.ok) {\r\n            const errorData = await response.json().catch(() => ({}));\r\n            throw new Error(errorData.detail || `HTTP ${response.status}`);\r\n        }\r\n\r\n        return await response.json();\r\n    }\r\n\r\n    // à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸ªà¸–à¸²à¸™à¸° keypoints à¸‚à¸­à¸‡à¸§à¸´à¸”à¸µà¹‚à¸­\r\n    async checkKeypointsStatus(videoId) {\r\n        try {\r\n            const segments = await this.getVideoSegments(videoId);\r\n            \r\n            const status = {\r\n                totalSegments: segments.segments.length,\r\n                withKeypoints: segments.segments.filter(s => s.has_keypoints).length,\r\n                withoutKeypoints: segments.segments.filter(s => !s.has_keypoints).length,\r\n                segments: segments.segments.map(s => ({\r\n                    segmentId: s.segment_id,\r\n                    exerciseId: s.exercise_id,\r\n                    startTime: s.start_time,\r\n                    endTime: s.end_time,\r\n                    hasKeypoints: s.has_keypoints,\r\n                    keypointsFile: s.keypoints_file\r\n                }))\r\n            };\r\n\r\n            return status;\r\n\r\n        } catch (error) {\r\n            console.error('Error checking keypoints status:', error);\r\n            throw error;\r\n        }\r\n    }\r\n\r\n    // à¸¥à¸š keypoints à¸‚à¸­à¸‡ segment\r\n    async deleteSegmentKeypoints(videoId, segmentId) {\r\n        const response = await fetch(`${this.baseURL}/keypoints/videos/${videoId}/segments/${segmentId}/keypoints`, {\r\n            method: 'DELETE'\r\n        });\r\n\r\n        if (!response.ok) {\r\n            throw new Error(`Failed to delete keypoints: ${response.status}`);\r\n        }\r\n\r\n        return await response.json();\r\n    }\r\n}\r\n\r\nexport default KeypointsProcessor;"],"mappings":"AAAA;;AAEA,MAAMA,kBAAkB,CAAC;EACrBC,WAAWA,CAACC,OAAO,GAAG,uBAAuB,EAAE;IAC3C,IAAI,CAACA,OAAO,GAAGA,OAAO;EAC1B;;EAEA;EACA,MAAMC,qBAAqBA,CAACC,OAAO,EAAEC,UAAU,GAAG,IAAI,EAAE;IACpD,IAAI;MACAC,OAAO,CAACC,GAAG,CAAC,8CAA8CH,OAAO,EAAE,CAAC;;MAEpE;MACA,MAAMI,QAAQ,GAAG,MAAM,IAAI,CAACC,gBAAgB,CAACL,OAAO,CAAC;MAErD,IAAI,CAACI,QAAQ,IAAIA,QAAQ,CAACA,QAAQ,CAACE,MAAM,KAAK,CAAC,EAAE;QAC7C,MAAM,IAAIC,KAAK,CAAC,kCAAkC,CAAC;MACvD;MAEAL,OAAO,CAACC,GAAG,CAAC,YAAYC,QAAQ,CAACA,QAAQ,CAACE,MAAM,sBAAsB,CAAC;MAEvE,IAAIE,cAAc,GAAG,CAAC;MACtB,MAAMC,OAAO,GAAG,EAAE;;MAElB;MACA,KAAK,MAAMC,OAAO,IAAIN,QAAQ,CAACA,QAAQ,EAAE;QACrC,IAAI;UACA,IAAIH,UAAU,EAAE;YACZA,UAAU,CAAC;cACPU,OAAO,EAAEH,cAAc,GAAG,CAAC;cAC3BI,KAAK,EAAER,QAAQ,CAACA,QAAQ,CAACE,MAAM;cAC/BO,MAAM,EAAE,sBAAsBH,OAAO,CAACI,UAAU,KAAK;cACrDC,SAAS,EAAEL,OAAO,CAACI;YACvB,CAAC,CAAC;UACN;;UAEA;UACA,MAAME,MAAM,GAAG,MAAM,IAAI,CAACC,uBAAuB,CAACjB,OAAO,EAAEU,OAAO,CAACI,UAAU,CAAC;UAE9EL,OAAO,CAACS,IAAI,CAAC;YACTH,SAAS,EAAEL,OAAO,CAACI,UAAU;YAC7BK,OAAO,EAAE,IAAI;YACbC,aAAa,EAAEJ,MAAM,CAACK,cAAc;YACpCC,WAAW,EAAEN,MAAM,CAACO,YAAY,IAAI;UACxC,CAAC,CAAC;UAEFf,cAAc,EAAE;UAEhBN,OAAO,CAACC,GAAG,CAAC,aAAaO,OAAO,CAACI,UAAU,yBAAyB,CAAC;QAEzE,CAAC,CAAC,OAAOU,KAAK,EAAE;UACZtB,OAAO,CAACsB,KAAK,CAAC,8BAA8Bd,OAAO,CAACI,UAAU,GAAG,EAAEU,KAAK,CAAC;UAEzEf,OAAO,CAACS,IAAI,CAAC;YACTH,SAAS,EAAEL,OAAO,CAACI,UAAU;YAC7BK,OAAO,EAAE,KAAK;YACdK,KAAK,EAAEA,KAAK,CAACC;UACjB,CAAC,CAAC;QACN;MACJ;;MAEA;MACA,MAAMC,YAAY,GAAGjB,OAAO,CAACkB,MAAM,CAACC,CAAC,IAAIA,CAAC,CAACT,OAAO,CAAC,CAACb,MAAM;MAC1D,MAAMuB,SAAS,GAAGpB,OAAO,CAACkB,MAAM,CAACC,CAAC,IAAI,CAACA,CAAC,CAACT,OAAO,CAAC,CAACb,MAAM;MAExD,IAAIL,UAAU,EAAE;QACZA,UAAU,CAAC;UACPU,OAAO,EAAEP,QAAQ,CAACA,QAAQ,CAACE,MAAM;UACjCM,KAAK,EAAER,QAAQ,CAACA,QAAQ,CAACE,MAAM;UAC/BO,MAAM,EAAE,cAAca,YAAY,aAAaG,SAAS,SAAS;UACjEC,SAAS,EAAE;QACf,CAAC,CAAC;MACN;MAEA,OAAO;QACHX,OAAO,EAAE,IAAI;QACbnB,OAAO,EAAEA,OAAO;QAChB+B,aAAa,EAAE3B,QAAQ,CAACA,QAAQ,CAACE,MAAM;QACvC0B,qBAAqB,EAAEN,YAAY;QACnCO,mBAAmB,EAAEJ,SAAS;QAC9BpB,OAAO,EAAEA;MACb,CAAC;IAEL,CAAC,CAAC,OAAOe,KAAK,EAAE;MACZtB,OAAO,CAACsB,KAAK,CAAC,qCAAqC,EAAEA,KAAK,CAAC;MAC3D,MAAMA,KAAK;IACf;EACJ;;EAEA;EACA,MAAMnB,gBAAgBA,CAACL,OAAO,EAAE;IAC5B,MAAMkC,QAAQ,GAAG,MAAMC,KAAK,CAAC,GAAG,IAAI,CAACrC,OAAO,qBAAqBE,OAAO,WAAW,CAAC;IAEpF,IAAI,CAACkC,QAAQ,CAACE,EAAE,EAAE;MACd,MAAM,IAAI7B,KAAK,CAAC,iCAAiC2B,QAAQ,CAACrB,MAAM,EAAE,CAAC;IACvE;IAEA,OAAO,MAAMqB,QAAQ,CAACG,IAAI,CAAC,CAAC;EAChC;;EAEA;EACA,MAAMpB,uBAAuBA,CAACjB,OAAO,EAAEe,SAAS,EAAE;IAC9C,MAAMmB,QAAQ,GAAG,MAAMC,KAAK,CAAC,GAAG,IAAI,CAACrC,OAAO,4BAA4B,EAAE;MACtEwC,MAAM,EAAE,MAAM;MACdC,OAAO,EAAE;QACL,cAAc,EAAE;MACpB,CAAC;MACDC,IAAI,EAAEC,IAAI,CAACC,SAAS,CAAC;QACjBC,QAAQ,EAAE3C,OAAO;QACjBc,UAAU,EAAEC;MAChB,CAAC;IACL,CAAC,CAAC;IAEF,IAAI,CAACmB,QAAQ,CAACE,EAAE,EAAE;MACd,MAAMQ,SAAS,GAAG,MAAMV,QAAQ,CAACG,IAAI,CAAC,CAAC,CAACQ,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;MACzD,MAAM,IAAItC,KAAK,CAACqC,SAAS,CAACE,MAAM,IAAI,QAAQZ,QAAQ,CAACrB,MAAM,EAAE,CAAC;IAClE;IAEA,OAAO,MAAMqB,QAAQ,CAACG,IAAI,CAAC,CAAC;EAChC;;EAEA;EACA,MAAMU,oBAAoBA,CAAC/C,OAAO,EAAE;IAChC,IAAI;MACA,MAAMI,QAAQ,GAAG,MAAM,IAAI,CAACC,gBAAgB,CAACL,OAAO,CAAC;MAErD,MAAMa,MAAM,GAAG;QACXkB,aAAa,EAAE3B,QAAQ,CAACA,QAAQ,CAACE,MAAM;QACvC0C,aAAa,EAAE5C,QAAQ,CAACA,QAAQ,CAACuB,MAAM,CAACsB,CAAC,IAAIA,CAAC,CAACC,aAAa,CAAC,CAAC5C,MAAM;QACpE6C,gBAAgB,EAAE/C,QAAQ,CAACA,QAAQ,CAACuB,MAAM,CAACsB,CAAC,IAAI,CAACA,CAAC,CAACC,aAAa,CAAC,CAAC5C,MAAM;QACxEF,QAAQ,EAAEA,QAAQ,CAACA,QAAQ,CAACgD,GAAG,CAACH,CAAC,KAAK;UAClClC,SAAS,EAAEkC,CAAC,CAACnC,UAAU;UACvBuC,UAAU,EAAEJ,CAAC,CAACK,WAAW;UACzBC,SAAS,EAAEN,CAAC,CAACO,UAAU;UACvBC,OAAO,EAAER,CAAC,CAACS,QAAQ;UACnBC,YAAY,EAAEV,CAAC,CAACC,aAAa;UAC7B9B,aAAa,EAAE6B,CAAC,CAAC5B;QACrB,CAAC,CAAC;MACN,CAAC;MAED,OAAOR,MAAM;IAEjB,CAAC,CAAC,OAAOW,KAAK,EAAE;MACZtB,OAAO,CAACsB,KAAK,CAAC,kCAAkC,EAAEA,KAAK,CAAC;MACxD,MAAMA,KAAK;IACf;EACJ;;EAEA;EACA,MAAMoC,sBAAsBA,CAAC5D,OAAO,EAAEe,SAAS,EAAE;IAC7C,MAAMmB,QAAQ,GAAG,MAAMC,KAAK,CAAC,GAAG,IAAI,CAACrC,OAAO,qBAAqBE,OAAO,aAAae,SAAS,YAAY,EAAE;MACxGuB,MAAM,EAAE;IACZ,CAAC,CAAC;IAEF,IAAI,CAACJ,QAAQ,CAACE,EAAE,EAAE;MACd,MAAM,IAAI7B,KAAK,CAAC,+BAA+B2B,QAAQ,CAACrB,MAAM,EAAE,CAAC;IACrE;IAEA,OAAO,MAAMqB,QAAQ,CAACG,IAAI,CAAC,CAAC;EAChC;AACJ;AAEA,eAAezC,kBAAkB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}