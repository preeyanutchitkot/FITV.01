{"ast":null,"code":"// VideoSegmentService.js - Service สำหรับจัดการ video segments\n\nclass VideoSegmentService {\n  constructor(baseURL = 'http://localhost:8000') {\n    this.baseURL = baseURL;\n  }\n\n  // สร้าง segment ใหม่ (จะ trigger keypoints extraction อัตโนมัติ)\n  async createSegment(videoId, segmentData) {\n    try {\n      const token = localStorage.getItem(\"token\");\n      const response = await fetch(`${this.baseURL}/videos/${videoId}/segments`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`\n        },\n        body: JSON.stringify({\n          exercise_id: segmentData.exerciseId,\n          start_time: segmentData.startTime,\n          end_time: segmentData.endTime\n        })\n      });\n      if (!response.ok) {\n        const errorData = await response.json().catch(() => ({}));\n        throw new Error(errorData.detail || `HTTP ${response.status}`);\n      }\n      const result = await response.json();\n      console.log('✅ Segment created successfully:', result);\n      return result;\n    } catch (error) {\n      console.error('❌ Error creating segment:', error);\n      throw error;\n    }\n  }\n\n  // ดึงรายการ segments ทั้งหมดของ video\n  async getVideoSegments(videoId) {\n    try {\n      const response = await fetch(`${this.baseURL}/videos/${videoId}/segments`);\n      if (!response.ok) {\n        throw new Error(`HTTP ${response.status}`);\n      }\n      return await response.json();\n    } catch (error) {\n      console.error('Error getting video segments:', error);\n      throw error;\n    }\n  }\n\n  // ลบ segment\n  async deleteSegment(videoId, segmentId) {\n    try {\n      const token = localStorage.getItem(\"token\");\n      const response = await fetch(`${this.baseURL}/videos/${videoId}/segments/${segmentId}`, {\n        method: 'DELETE',\n        headers: {\n          'Authorization': `Bearer ${token}`\n        }\n      });\n      if (!response.ok) {\n        throw new Error(`HTTP ${response.status}`);\n      }\n      return await response.json();\n    } catch (error) {\n      console.error('Error deleting segment:', error);\n      throw error;\n    }\n  }\n\n  // ตรวจสอบสถานะ keypoints ของ segment - DISABLED\n  async getKeypointsStatus(videoId, segmentId) {\n    // Keypoints extraction disabled - return mock data\n    return {\n      has_keypoints: false,\n      processing: false,\n      frames_count: 0,\n      keypoints_file: null\n    };\n  }\n\n  // Poll สถานะ keypoints จนกว่าจะเสร็จ\n  async waitForKeypointsCompletion(videoId, segmentId, onProgress = null, maxAttempts = 30) {\n    let attempts = 0;\n    while (attempts < maxAttempts) {\n      try {\n        const status = await this.getKeypointsStatus(videoId, segmentId);\n        if (onProgress) {\n          onProgress({\n            segmentId: segmentId,\n            hasKeypoints: status.has_keypoints,\n            processing: status.processing,\n            framesCount: status.frames_count,\n            attempt: attempts + 1,\n            maxAttempts: maxAttempts\n          });\n        }\n\n        // ถ้าประมวลผลเสร็จแล้ว\n        if (status.has_keypoints && !status.processing) {\n          console.log(`✅ Keypoints ready for segment ${segmentId}`);\n          return status;\n        }\n\n        // ถ้ายังไม่เสร็จ รอ 2 วินาทีแล้วลองใหม่\n        await new Promise(resolve => setTimeout(resolve, 2000));\n        attempts++;\n      } catch (error) {\n        console.error(`Error checking keypoints status (attempt ${attempts + 1}):`, error);\n        attempts++;\n        await new Promise(resolve => setTimeout(resolve, 2000));\n      }\n    }\n    throw new Error(`Keypoints processing timeout for segment ${segmentId}`);\n  }\n\n  // Batch create segments (สร้างหลาย segments พร้อมกัน)\n  async createMultipleSegments(videoId, segmentsData) {\n    const results = [];\n    for (const segmentData of segmentsData) {\n      try {\n        const result = await this.createSegment(videoId, segmentData);\n        results.push({\n          success: true,\n          segmentData: segmentData,\n          result: result\n        });\n      } catch (error) {\n        console.error(`❌ Failed to create segment:`, error);\n        results.push({\n          success: false,\n          segmentData: segmentData,\n          error: error.message\n        });\n      }\n    }\n    return {\n      total: segmentsData.length,\n      successful: results.filter(r => r.success).length,\n      failed: results.filter(r => !r.success).length,\n      results: results\n    };\n  }\n}\nexport default VideoSegmentService;","map":{"version":3,"names":["VideoSegmentService","constructor","baseURL","createSegment","videoId","segmentData","token","localStorage","getItem","response","fetch","method","headers","body","JSON","stringify","exercise_id","exerciseId","start_time","startTime","end_time","endTime","ok","errorData","json","catch","Error","detail","status","result","console","log","error","getVideoSegments","deleteSegment","segmentId","getKeypointsStatus","has_keypoints","processing","frames_count","keypoints_file","waitForKeypointsCompletion","onProgress","maxAttempts","attempts","hasKeypoints","framesCount","attempt","Promise","resolve","setTimeout","createMultipleSegments","segmentsData","results","push","success","message","total","length","successful","filter","r","failed"],"sources":["E:/BackupFit/frontend/src/services/VideoSegmentService.js"],"sourcesContent":["// VideoSegmentService.js - Service สำหรับจัดการ video segments\r\n\r\nclass VideoSegmentService {\r\n    constructor(baseURL = 'http://localhost:8000') {\r\n        this.baseURL = baseURL;\r\n    }\r\n\r\n    // สร้าง segment ใหม่ (จะ trigger keypoints extraction อัตโนมัติ)\r\n    async createSegment(videoId, segmentData) {\r\n        try {\r\n            const token = localStorage.getItem(\"token\");\r\n            const response = await fetch(\r\n                `${this.baseURL}/videos/${videoId}/segments`,\r\n                {\r\n                    method: 'POST',\r\n                    headers: {\r\n                        'Content-Type': 'application/json',\r\n                        'Authorization': `Bearer ${token}`\r\n                    },\r\n                    body: JSON.stringify({\r\n                        exercise_id: segmentData.exerciseId,\r\n                        start_time: segmentData.startTime,\r\n                        end_time: segmentData.endTime\r\n                    })\r\n                }\r\n            );\r\n\r\n            if (!response.ok) {\r\n                const errorData = await response.json().catch(() => ({}));\r\n                throw new Error(errorData.detail || `HTTP ${response.status}`);\r\n            }\r\n\r\n            const result = await response.json();\r\n            console.log('✅ Segment created successfully:', result);\r\n            return result;\r\n\r\n        } catch (error) {\r\n            console.error('❌ Error creating segment:', error);\r\n            throw error;\r\n        }\r\n    }\r\n\r\n    // ดึงรายการ segments ทั้งหมดของ video\r\n    async getVideoSegments(videoId) {\r\n        try {\r\n            const response = await fetch(\r\n                `${this.baseURL}/videos/${videoId}/segments`\r\n            );\r\n\r\n            if (!response.ok) {\r\n                throw new Error(`HTTP ${response.status}`);\r\n            }\r\n\r\n            return await response.json();\r\n\r\n        } catch (error) {\r\n            console.error('Error getting video segments:', error);\r\n            throw error;\r\n        }\r\n    }\r\n\r\n    // ลบ segment\r\n    async deleteSegment(videoId, segmentId) {\r\n        try {\r\n            const token = localStorage.getItem(\"token\");\r\n            const response = await fetch(\r\n                `${this.baseURL}/videos/${videoId}/segments/${segmentId}`,\r\n                {\r\n                    method: 'DELETE',\r\n                    headers: {\r\n                        'Authorization': `Bearer ${token}`\r\n                    }\r\n                }\r\n            );\r\n\r\n            if (!response.ok) {\r\n                throw new Error(`HTTP ${response.status}`);\r\n            }\r\n\r\n            return await response.json();\r\n\r\n        } catch (error) {\r\n            console.error('Error deleting segment:', error);\r\n            throw error;\r\n        }\r\n    }\r\n\r\n    // ตรวจสอบสถานะ keypoints ของ segment - DISABLED\r\n    async getKeypointsStatus(videoId, segmentId) {\r\n        // Keypoints extraction disabled - return mock data\r\n        return {\r\n            has_keypoints: false,\r\n            processing: false,\r\n            frames_count: 0,\r\n            keypoints_file: null\r\n        };\r\n    }\r\n\r\n    // Poll สถานะ keypoints จนกว่าจะเสร็จ\r\n    async waitForKeypointsCompletion(videoId, segmentId, onProgress = null, maxAttempts = 30) {\r\n        let attempts = 0;\r\n        \r\n        while (attempts < maxAttempts) {\r\n            try {\r\n                const status = await this.getKeypointsStatus(videoId, segmentId);\r\n                \r\n                if (onProgress) {\r\n                    onProgress({\r\n                        segmentId: segmentId,\r\n                        hasKeypoints: status.has_keypoints,\r\n                        processing: status.processing,\r\n                        framesCount: status.frames_count,\r\n                        attempt: attempts + 1,\r\n                        maxAttempts: maxAttempts\r\n                    });\r\n                }\r\n\r\n                // ถ้าประมวลผลเสร็จแล้ว\r\n                if (status.has_keypoints && !status.processing) {\r\n                    console.log(`✅ Keypoints ready for segment ${segmentId}`);\r\n                    return status;\r\n                }\r\n\r\n                // ถ้ายังไม่เสร็จ รอ 2 วินาทีแล้วลองใหม่\r\n                await new Promise(resolve => setTimeout(resolve, 2000));\r\n                attempts++;\r\n\r\n            } catch (error) {\r\n                console.error(`Error checking keypoints status (attempt ${attempts + 1}):`, error);\r\n                attempts++;\r\n                await new Promise(resolve => setTimeout(resolve, 2000));\r\n            }\r\n        }\r\n\r\n        throw new Error(`Keypoints processing timeout for segment ${segmentId}`);\r\n    }\r\n\r\n\r\n\r\n    // Batch create segments (สร้างหลาย segments พร้อมกัน)\r\n    async createMultipleSegments(videoId, segmentsData) {\r\n        const results = [];\r\n\r\n        for (const segmentData of segmentsData) {\r\n            try {\r\n                const result = await this.createSegment(videoId, segmentData);\r\n\r\n                results.push({\r\n                    success: true,\r\n                    segmentData: segmentData,\r\n                    result: result\r\n                });\r\n\r\n            } catch (error) {\r\n                console.error(`❌ Failed to create segment:`, error);\r\n                results.push({\r\n                    success: false,\r\n                    segmentData: segmentData,\r\n                    error: error.message\r\n                });\r\n            }\r\n        }\r\n\r\n        return {\r\n            total: segmentsData.length,\r\n            successful: results.filter(r => r.success).length,\r\n            failed: results.filter(r => !r.success).length,\r\n            results: results\r\n        };\r\n    }\r\n}\r\n\r\nexport default VideoSegmentService;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}