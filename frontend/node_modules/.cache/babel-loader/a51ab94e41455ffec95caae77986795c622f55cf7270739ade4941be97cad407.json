{"ast":null,"code":"/**\r\n * üéØ Advanced Multi-Directional Pose Comparator\r\n * ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏ó‡πà‡∏≤‡∏ó‡∏≤‡∏á‡πÅ‡∏ö‡∏ö 8 ‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡∏°‡∏∏‡∏°‡∏Ç‡πâ‡∏≠‡∏ï‡πà‡∏≠‡πÅ‡∏ó‡∏ô‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏à‡∏∏‡∏î\r\n * \r\n * Concept: \r\n * - ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏°‡∏∏‡∏°‡∏Ç‡πâ‡∏≠‡∏ï‡πà‡∏≠‡∏´‡∏•‡∏±‡∏Å‡∏à‡∏≤‡∏Å keypoints (Joint Angles)\r\n * - ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô 8 ‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á (Front, Back, Left, Right, ‡πÅ‡∏•‡∏∞ 4 ‡πÄ‡∏â‡∏µ‡∏¢‡∏á)\r\n * - ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö trainee ‡∏Å‡∏±‡∏ö trainer ‡πÅ‡∏ö‡∏ö real-time\r\n */\n\nexport class MultiDirectionalPoseComparator {\n  constructor() {\n    this.MIN_VISIBILITY = 0.7;\n    this.MIN_MOVEMENT_THRESHOLD = 0.05; // ‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥‡∏ó‡∏µ‡πà‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢\n\n    // ‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ó‡πà‡∏≤\n    this.EXERCISE_WEIGHTS = {\n      'squat': {\n        legs: 0.6,\n        // ‡πÄ‡∏ô‡πâ‡∏ô‡∏Ç‡∏≤ 60%\n        torso: 0.3,\n        // ‡∏•‡∏≥‡∏ï‡∏±‡∏ß 30%\n        arms: 0.1 // ‡πÅ‡∏Ç‡∏ô 10%\n      },\n      'push_up': {\n        arms: 0.5,\n        // ‡πÄ‡∏ô‡πâ‡∏ô‡πÅ‡∏Ç‡∏ô 50%\n        torso: 0.4,\n        // ‡∏•‡∏≥‡∏ï‡∏±‡∏ß 40% \n        legs: 0.1 // ‡∏Ç‡∏≤ 10%\n      },\n      'plank': {\n        torso: 0.6,\n        // ‡πÄ‡∏ô‡πâ‡∏ô‡∏•‡∏≥‡∏ï‡∏±‡∏ß 60%\n        arms: 0.3,\n        // ‡πÅ‡∏Ç‡∏ô 30%\n        legs: 0.1 // ‡∏Ç‡∏≤ 10%\n      },\n      'default': {\n        arms: 0.33,\n        // ‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô‡∏´‡∏°‡∏î\n        legs: 0.33,\n        torso: 0.34\n      }\n    };\n\n    // MediaPipe Pose landmark indices\n    this.LANDMARKS = {\n      // Upper body key points\n      LEFT_SHOULDER: 11,\n      RIGHT_SHOULDER: 12,\n      LEFT_ELBOW: 13,\n      RIGHT_ELBOW: 14,\n      LEFT_WRIST: 15,\n      RIGHT_WRIST: 16,\n      LEFT_HIP: 23,\n      RIGHT_HIP: 24,\n      LEFT_KNEE: 25,\n      RIGHT_KNEE: 26,\n      LEFT_ANKLE: 27,\n      RIGHT_ANKLE: 28,\n      NOSE: 0,\n      LEFT_EAR: 7,\n      RIGHT_EAR: 8\n    };\n\n    // Joint angle definitions - ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏°‡∏∏‡∏°‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢ 3 ‡∏à‡∏∏‡∏î [‡∏à‡∏∏‡∏î‡πÅ‡∏£‡∏Å, ‡∏à‡∏∏‡∏î‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á, ‡∏à‡∏∏‡∏î‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢]\n    this.JOINT_ANGLES = {\n      // ‡πÅ‡∏Ç‡∏ô‡∏ã‡πâ‡∏≤‡∏¢\n      LEFT_ARM_ANGLE: [this.LANDMARKS.LEFT_SHOULDER, this.LANDMARKS.LEFT_ELBOW, this.LANDMARKS.LEFT_WRIST],\n      // ‡πÅ‡∏Ç‡∏ô‡∏Ç‡∏ß‡∏≤  \n      RIGHT_ARM_ANGLE: [this.LANDMARKS.RIGHT_SHOULDER, this.LANDMARKS.RIGHT_ELBOW, this.LANDMARKS.RIGHT_WRIST],\n      // ‡∏Ç‡∏≤‡∏ã‡πâ‡∏≤‡∏¢\n      LEFT_LEG_ANGLE: [this.LANDMARKS.LEFT_HIP, this.LANDMARKS.LEFT_KNEE, this.LANDMARKS.LEFT_ANKLE],\n      // ‡∏Ç‡∏≤‡∏Ç‡∏ß‡∏≤\n      RIGHT_LEG_ANGLE: [this.LANDMARKS.RIGHT_HIP, this.LANDMARKS.RIGHT_KNEE, this.LANDMARKS.RIGHT_ANKLE],\n      // ‡∏•‡∏≥‡∏ï‡∏±‡∏ß‡∏ã‡πâ‡∏≤‡∏¢\n      LEFT_TORSO_ANGLE: [this.LANDMARKS.LEFT_SHOULDER, this.LANDMARKS.LEFT_HIP, this.LANDMARKS.LEFT_KNEE],\n      // ‡∏•‡∏≥‡∏ï‡∏±‡∏ß‡∏Ç‡∏ß‡∏≤\n      RIGHT_TORSO_ANGLE: [this.LANDMARKS.RIGHT_SHOULDER, this.LANDMARKS.RIGHT_HIP, this.LANDMARKS.RIGHT_KNEE],\n      // ‡πÑ‡∏´‡∏•‡πà (shoulder alignment)\n      SHOULDER_ANGLE: [this.LANDMARKS.LEFT_SHOULDER, this.LANDMARKS.NOSE, this.LANDMARKS.RIGHT_SHOULDER],\n      // ‡∏™‡∏∞‡πÇ‡∏û‡∏Å (hip alignment)  \n      HIP_ANGLE: [this.LANDMARKS.LEFT_HIP, this.LANDMARKS.NOSE, this.LANDMARKS.RIGHT_HIP]\n    };\n\n    // 8 ‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á‡∏´‡∏•‡∏±‡∏Å (degrees)\n    this.DIRECTIONS = {\n      FRONT: 0,\n      // ‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏£‡∏á\n      FRONT_RIGHT: 45,\n      // ‡πÄ‡∏â‡∏µ‡∏¢‡∏á‡∏Ç‡∏ß‡∏≤‡∏´‡∏ô‡πâ‡∏≤\n      RIGHT: 90,\n      // ‡∏Ç‡πâ‡∏≤‡∏á‡∏Ç‡∏ß‡∏≤\n      BACK_RIGHT: 135,\n      // ‡πÄ‡∏â‡∏µ‡∏¢‡∏á‡∏Ç‡∏ß‡∏≤‡∏´‡∏•‡∏±‡∏á\n      BACK: 180,\n      // ‡∏´‡∏•‡∏±‡∏á\n      BACK_LEFT: 225,\n      // ‡πÄ‡∏â‡∏µ‡∏¢‡∏á‡∏ã‡πâ‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á\n      LEFT: 270,\n      // ‡∏Ç‡πâ‡∏≤‡∏á‡∏ã‡πâ‡∏≤‡∏¢\n      FRONT_LEFT: 315 // ‡πÄ‡∏â‡∏µ‡∏¢‡∏á‡∏ã‡πâ‡∏≤‡∏¢‡∏´‡∏ô‡πâ‡∏≤\n    };\n\n    // ‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏ï‡πà‡∏≠\n    this.JOINT_WEIGHTS = {\n      LEFT_ARM_ANGLE: 1.5,\n      RIGHT_ARM_ANGLE: 1.5,\n      LEFT_LEG_ANGLE: 2.0,\n      RIGHT_LEG_ANGLE: 2.0,\n      LEFT_TORSO_ANGLE: 2.5,\n      RIGHT_TORSO_ANGLE: 2.5,\n      SHOULDER_ANGLE: 1.8,\n      HIP_ANGLE: 1.8\n    };\n\n    // Minimum visibility threshold\n    this.MIN_VISIBILITY = 0.6;\n  }\n\n  /**\r\n   * üéØ Main comparison function - Smart exercise-aware pose matching\r\n   * @param {Array} trainerPose - Trainer's keypoints\r\n   * @param {Array} traineePose - Trainee's keypoints (real-time)\r\n   * @param {Object} options - Options for comparison mode\r\n   * @returns {Object} - Comparison result with accuracy and detailed analysis\r\n   */\n  compareMultiDirectional(trainerPose, traineePose, options = {}) {\n    if (!this.isValidPose(trainerPose) || !this.isValidPose(traineePose)) {\n      return this.getErrorResult(\"Invalid pose data\");\n    }\n    const {\n      mode = 'auto',\n      exerciseStarted = false\n    } = options;\n\n    // 1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà\n    const isExercising = this.isActiveExercise(trainerPose, traineePose);\n\n    // Pre-exercise mode: ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏ó‡πà‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏ï‡πâ‡∏ô‡πÅ‡∏°‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢\n    if (!exerciseStarted || !isExercising && mode === 'pre-exercise') {\n      return this.comparePreExercisePose(trainerPose, traineePose);\n    }\n\n    // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß = ‡∏û‡∏±‡∏Å‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢\n    if (exerciseStarted && !isExercising) {\n      return {\n        accuracy: 0,\n        confidence: 30,\n        feedback: \"‡∏û‡∏±‡∏Å‡πÅ‡∏õ‡∏õ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ó‡∏≥‡∏ó‡πà‡∏≤‡∏ï‡πà‡∏≠‡πÑ‡∏õ\",\n        jointComparisons: {},\n        trainerDirection: \"UNKNOWN\",\n        traineeDirection: \"UNKNOWN\",\n        bodyPartScores: {\n          arms: 0,\n          legs: 0,\n          torso: 0\n        },\n        recommendations: [\"‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏≥‡∏ó‡πà‡∏≤‡∏ï‡πà‡∏≠‡πÑ‡∏õ\"],\n        exerciseActive: false,\n        mode: 'resting'\n      };\n    }\n\n    // 2. ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢\n    const exerciseType = this.detectExerciseType(trainerPose, traineePose);\n\n    // 3. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏°‡∏∏‡∏°‡∏Ç‡πâ‡∏≠‡∏ï‡πà‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡∏≠‡∏á trainer ‡πÅ‡∏•‡∏∞ trainee\n    const trainerAngles = this.calculateAllJointAngles(trainerPose);\n    const traineeAngles = this.calculateAllJointAngles(traineePose);\n\n    // 4. ‡∏£‡∏∞‡∏ö‡∏∏‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏ô (‡πÉ‡∏ä‡πâ shoulder orientation)\n    const trainerDirection = this.detectBodyDirection(trainerPose);\n    const traineeDirection = this.detectBodyDirection(traineePose);\n\n    // 5. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πà‡∏≤‡∏á‡∏°‡∏∏‡∏°‡∏Ç‡πâ‡∏≠‡∏ï‡πà‡∏≠‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ï‡∏±‡∏ß\n    const angleComparisons = this.compareJointAngles(trainerAngles, traineeAngles);\n\n    // 6. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÅ‡∏¢‡∏Å‡∏™‡πà‡∏ß‡∏ô‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏¢\n    const bodyPartScores = this.calculateBodyPartScores(angleComparisons);\n\n    // 7. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì accuracy ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ó‡πà‡∏≤\n    const weightedAccuracy = this.calculateWeightedAccuracy(bodyPartScores, exerciseType);\n\n    // 8. ‡∏™‡∏£‡πâ‡∏≤‡∏á feedback ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥\n    const feedback = this.generateExerciseSpecificFeedback(weightedAccuracy, exerciseType, bodyPartScores);\n    return {\n      accuracy: Math.round(weightedAccuracy),\n      confidence: this.calculateConfidence(trainerAngles, traineeAngles),\n      feedback,\n      jointComparisons: angleComparisons,\n      trainerDirection,\n      traineeDirection,\n      bodyPartScores,\n      recommendations: this.generateRecommendations(angleComparisons),\n      exerciseType: exerciseType,\n      exerciseActive: true,\n      exerciseWeights: this.EXERCISE_WEIGHTS[exerciseType]\n    };\n  }\n\n  /**\r\n   * üìê ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏°‡∏∏‡∏°‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏™‡∏≤‡∏°‡∏à‡∏∏‡∏î (P1-P2-P3) ‡πÇ‡∏î‡∏¢ P2 ‡πÄ‡∏õ‡πá‡∏ô‡∏à‡∏∏‡∏î‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á\r\n   */\n  calculateAngle(p1, p2, p3) {\n    if (!p1 || !p2 || !p3) return null;\n\n    // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏ß‡∏Å‡πÄ‡∏ï‡∏≠‡∏£‡πå\n    const v1 = {\n      x: p1.x - p2.x,\n      y: p1.y - p2.y\n    };\n    const v2 = {\n      x: p3.x - p2.x,\n      y: p3.y - p2.y\n    };\n\n    // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏°‡∏∏‡∏°‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ dot product ‡πÅ‡∏•‡∏∞ cross product\n    const dot = v1.x * v2.x + v1.y * v2.y;\n    const cross = v1.x * v2.y - v1.y * v2.x;\n    let angle = Math.atan2(cross, dot) * (180 / Math.PI);\n\n    // ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô positive angle (0-360)\n    if (angle < 0) angle += 360;\n    return angle;\n  }\n\n  /**\r\n   * üîç ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏°‡∏∏‡∏°‡∏Ç‡πâ‡∏≠‡∏ï‡πà‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î\r\n   */\n  calculateAllJointAngles(pose) {\n    const angles = {};\n    Object.entries(this.JOINT_ANGLES).forEach(([jointName, [p1Idx, p2Idx, p3Idx]]) => {\n      const p1 = pose[p1Idx];\n      const p2 = pose[p2Idx];\n      const p3 = pose[p3Idx];\n\n      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏à‡∏∏‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≤‡∏°‡∏°‡∏≠‡∏á‡πÄ‡∏´‡πá‡∏ô‡πÑ‡∏î‡πâ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô\n      if (this.arePointsVisible([p1, p2, p3])) {\n        angles[jointName] = this.calculateAngle(p1, p2, p3);\n      } else {\n        angles[jointName] = null; // ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÑ‡∏î‡πâ\n      }\n    });\n    return angles;\n  }\n\n  /**\r\n   * üß≠ ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏Å (‡πÉ‡∏ä‡πâ‡πÑ‡∏´‡∏•‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏•‡∏±‡∏Å)\r\n   */\n  detectBodyDirection(pose) {\n    const leftShoulder = pose[this.LANDMARKS.LEFT_SHOULDER];\n    const rightShoulder = pose[this.LANDMARKS.RIGHT_SHOULDER];\n    const nose = pose[this.LANDMARKS.NOSE];\n    if (!this.arePointsVisible([leftShoulder, rightShoulder, nose])) {\n      return 'UNKNOWN';\n    }\n\n    // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏°‡∏∏‡∏°‡πÑ‡∏´‡∏•‡πà‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô\n    const shoulderAngle = Math.atan2(rightShoulder.y - leftShoulder.y, rightShoulder.x - leftShoulder.x) * (180 / Math.PI);\n\n    // ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô positive angle\n    let normalizedAngle = shoulderAngle < 0 ? shoulderAngle + 360 : shoulderAngle;\n\n    // ‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏Å‡∏±‡∏ö‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î\n    let closestDirection = 'FRONT';\n    let minDifference = Infinity;\n    Object.entries(this.DIRECTIONS).forEach(([direction, angle]) => {\n      const difference = Math.min(Math.abs(normalizedAngle - angle), Math.abs(normalizedAngle - angle + 360), Math.abs(normalizedAngle - angle - 360));\n      if (difference < minDifference) {\n        minDifference = difference;\n        closestDirection = direction;\n      }\n    });\n    return closestDirection;\n  }\n\n  /**\r\n   * ‚öñÔ∏è ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏°‡∏∏‡∏°‡∏Ç‡πâ‡∏≠‡∏ï‡πà‡∏≠‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á trainer ‡πÅ‡∏•‡∏∞ trainee\r\n   */\n  compareJointAngles(trainerAngles, traineeAngles) {\n    const comparisons = {};\n    Object.keys(this.JOINT_ANGLES).forEach(jointName => {\n      const trainerAngle = trainerAngles[jointName];\n      const traineeAngle = traineeAngles[jointName];\n      if (trainerAngle !== null && traineeAngle !== null) {\n        // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πà‡∏≤‡∏á‡∏°‡∏∏‡∏° (‡∏´‡∏≤‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏ô‡πâ‡∏≠‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÉ‡∏ô 360 ‡∏≠‡∏á‡∏®‡∏≤)\n        let angleDiff = Math.abs(trainerAngle - traineeAngle);\n        angleDiff = Math.min(angleDiff, 360 - angleDiff);\n\n        // ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥ (‡∏¢‡∏¥‡πà‡∏á‡∏ï‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ = ‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡∏°‡∏≤‡∏Å)\n        const accuracy = Math.max(0, 100 - angleDiff * 1.2); // 1.2 ‡πÄ‡∏õ‡πá‡∏ô sensitivity factor\n\n        comparisons[jointName] = {\n          trainerAngle: Math.round(trainerAngle),\n          traineeAngle: Math.round(traineeAngle),\n          angleDifference: Math.round(angleDiff),\n          accuracy: Math.round(accuracy),\n          weight: this.JOINT_WEIGHTS[jointName] || 1.0\n        };\n      } else {\n        comparisons[jointName] = {\n          trainerAngle: trainerAngle,\n          traineeAngle: traineeAngle,\n          angleDifference: null,\n          accuracy: 0,\n          weight: this.JOINT_WEIGHTS[jointName] || 1.0,\n          error: 'Points not visible'\n        };\n      }\n    });\n    return comparisons;\n  }\n\n  /**\r\n   * üìä ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì accuracy ‡πÇ‡∏î‡∏¢‡∏£‡∏ß‡∏°‡πÅ‡∏ö‡∏ö‡∏°‡∏µ‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å\r\n   */\n  calculateWeightedAccuracy(angleComparisons) {\n    let totalWeightedScore = 0;\n    let totalWeight = 0;\n    Object.values(angleComparisons).forEach(comparison => {\n      if (comparison.accuracy > 0) {\n        totalWeightedScore += comparison.accuracy * comparison.weight;\n        totalWeight += comparison.weight;\n      }\n    });\n    return totalWeight > 0 ? totalWeightedScore / totalWeight : 0;\n  }\n\n  /**\r\n   * üí¨ ‡∏™‡∏£‡πâ‡∏≤‡∏á feedback ‡∏ï‡∏≤‡∏°‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á\r\n   */\n  generateDirectionalFeedback(accuracy, angleComparisons, trainerDirection, traineeDirection) {\n    if (accuracy >= 90) {\n      return \"üéâ ‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°! ‡∏ó‡πà‡∏≤‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡∏°‡∏≤‡∏Å\";\n    } else if (accuracy >= 80) {\n      return \"üëç ‡∏î‡∏µ‡∏°‡∏≤‡∏Å! ‡πÄ‡∏Å‡∏∑‡∏≠‡∏ö‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡πÅ‡∏•‡πâ‡∏ß\";\n    } else if (accuracy >= 70) {\n      return \"‚ö° ‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á‡πÅ‡∏•‡πâ‡∏ß ‡∏õ‡∏£‡∏±‡∏ö‡∏ó‡πà‡∏≤‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢\";\n    } else if (accuracy >= 60) {\n      // ‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏ï‡πà‡∏≠‡∏ó‡∏µ‡πà‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡∏ô‡πâ‡∏≠‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î\n      const worstJoint = this.findWorstJoint(angleComparisons);\n      return `‚ö†Ô∏è ‡∏õ‡∏£‡∏±‡∏ö${this.getJointNameThai(worstJoint)}‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô`;\n    } else if (accuracy >= 40) {\n      return `üîÑ ‡∏•‡∏≠‡∏á‡∏´‡∏±‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÑ‡∏õ‡∏ó‡∏≤‡∏á${this.getDirectionThai(trainerDirection)}‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÇ‡∏Ñ‡πâ‡∏ä`;\n    } else {\n      return \"üéØ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà - ‡∏î‡∏π‡∏ó‡πà‡∏≤‡∏Ç‡∏≠‡∏á‡πÇ‡∏Ñ‡πâ‡∏ä‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î\";\n    }\n  }\n\n  /**\r\n   * üîç ‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏ï‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡∏ô‡πâ‡∏≠‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î\r\n   */\n  findWorstJoint(angleComparisons) {\n    let worstJoint = null;\n    let lowestAccuracy = 100;\n    Object.entries(angleComparisons).forEach(([jointName, comparison]) => {\n      if (comparison.accuracy < lowestAccuracy) {\n        lowestAccuracy = comparison.accuracy;\n        worstJoint = jointName;\n      }\n    });\n    return worstJoint;\n  }\n\n  /**\r\n   * üèãÔ∏è ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏¢\r\n   */\n  calculateBodyPartScores(angleComparisons) {\n    const bodyParts = {\n      '‡πÅ‡∏Ç‡∏ô‡∏ã‡πâ‡∏≤‡∏¢': ['LEFT_ARM_ANGLE'],\n      '‡πÅ‡∏Ç‡∏ô‡∏Ç‡∏ß‡∏≤': ['RIGHT_ARM_ANGLE'],\n      '‡∏Ç‡∏≤‡∏ã‡πâ‡∏≤‡∏¢': ['LEFT_LEG_ANGLE'],\n      '‡∏Ç‡∏≤‡∏Ç‡∏ß‡∏≤': ['RIGHT_LEG_ANGLE'],\n      '‡∏•‡∏≥‡∏ï‡∏±‡∏ß': ['LEFT_TORSO_ANGLE', 'RIGHT_TORSO_ANGLE'],\n      '‡∏ó‡πà‡∏≤‡∏ó‡∏≤‡∏á': ['SHOULDER_ANGLE', 'HIP_ANGLE']\n    };\n    const scores = {};\n    Object.entries(bodyParts).forEach(([bodyPart, joints]) => {\n      let totalScore = 0;\n      let count = 0;\n      joints.forEach(joint => {\n        if (angleComparisons[joint] && angleComparisons[joint].accuracy > 0) {\n          totalScore += angleComparisons[joint].accuracy;\n          count++;\n        }\n      });\n      scores[bodyPart] = count > 0 ? totalScore / count : 0;\n    });\n    return scores;\n  }\n\n  /**\r\n   * üí° ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏â‡∏û‡∏≤‡∏∞\r\n   */\n  generateRecommendations(angleComparisons) {\n    const recommendations = [];\n    Object.entries(angleComparisons).forEach(([jointName, comparison]) => {\n      if (comparison.accuracy < 70 && comparison.accuracy > 0) {\n        const suggestion = this.getJointSpecificSuggestion(jointName, comparison);\n        if (suggestion) {\n          recommendations.push({\n            bodyPart: this.getJointNameThai(jointName),\n            issue: `${this.getJointNameThai(jointName)}‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏ä`,\n            suggestion: suggestion,\n            accuracy: comparison.accuracy\n          });\n        }\n      }\n    });\n\n    // Sort by accuracy (lowest first)\n    return recommendations.sort((a, b) => a.accuracy - b.accuracy).slice(0, 3);\n  }\n\n  /**\r\n   * üéØ ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏ï‡πà‡∏≠\r\n   */\n  getJointSpecificSuggestion(jointName, comparison) {\n    const suggestions = {\n      'LEFT_ARM_ANGLE': '‡∏õ‡∏£‡∏±‡∏ö‡∏°‡∏∏‡∏°‡πÅ‡∏Ç‡∏ô‡∏ã‡πâ‡∏≤‡∏¢‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏ä',\n      'RIGHT_ARM_ANGLE': '‡∏õ‡∏£‡∏±‡∏ö‡∏°‡∏∏‡∏°‡πÅ‡∏Ç‡∏ô‡∏Ç‡∏ß‡∏≤‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏ä',\n      'LEFT_LEG_ANGLE': '‡∏õ‡∏£‡∏±‡∏ö‡∏°‡∏∏‡∏°‡∏Ç‡∏≤‡∏ã‡πâ‡∏≤‡∏¢‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏ä',\n      'RIGHT_LEG_ANGLE': '‡∏õ‡∏£‡∏±‡∏ö‡∏°‡∏∏‡∏°‡∏Ç‡∏≤‡∏Ç‡∏ß‡∏≤‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏ä',\n      'LEFT_TORSO_ANGLE': '‡∏õ‡∏£‡∏±‡∏ö‡∏ó‡πà‡∏≤‡∏•‡∏≥‡∏ï‡∏±‡∏ß‡∏ã‡πâ‡∏≤‡∏¢‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏ä',\n      'RIGHT_TORSO_ANGLE': '‡∏õ‡∏£‡∏±‡∏ö‡∏ó‡πà‡∏≤‡∏•‡∏≥‡∏ï‡∏±‡∏ß‡∏Ç‡∏ß‡∏≤‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏ä',\n      'SHOULDER_ANGLE': '‡∏õ‡∏£‡∏±‡∏ö‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÑ‡∏´‡∏•‡πà‡πÉ‡∏´‡πâ‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô',\n      'HIP_ANGLE': '‡∏õ‡∏£‡∏±‡∏ö‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏™‡∏∞‡πÇ‡∏û‡∏Å‡πÉ‡∏´‡πâ‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô'\n    };\n    return suggestions[jointName] || '‡∏õ‡∏£‡∏±‡∏ö‡∏ó‡πà‡∏≤‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏ä';\n  }\n\n  /**\r\n   * üáπüá≠ ‡πÅ‡∏õ‡∏•‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡πâ‡∏≠‡∏ï‡πà‡∏≠‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢\r\n   */\n  getJointNameThai(jointName) {\n    const names = {\n      'LEFT_ARM_ANGLE': '‡πÅ‡∏Ç‡∏ô‡∏ã‡πâ‡∏≤‡∏¢',\n      'RIGHT_ARM_ANGLE': '‡πÅ‡∏Ç‡∏ô‡∏Ç‡∏ß‡∏≤',\n      'LEFT_LEG_ANGLE': '‡∏Ç‡∏≤‡∏ã‡πâ‡∏≤‡∏¢',\n      'RIGHT_LEG_ANGLE': '‡∏Ç‡∏≤‡∏Ç‡∏ß‡∏≤',\n      'LEFT_TORSO_ANGLE': '‡∏•‡∏≥‡∏ï‡∏±‡∏ß‡∏ã‡πâ‡∏≤‡∏¢',\n      'RIGHT_TORSO_ANGLE': '‡∏•‡∏≥‡∏ï‡∏±‡∏ß‡∏Ç‡∏ß‡∏≤',\n      'SHOULDER_ANGLE': '‡πÑ‡∏´‡∏•‡πà',\n      'HIP_ANGLE': '‡∏™‡∏∞‡πÇ‡∏û‡∏Å'\n    };\n    return names[jointName] || '‡∏ó‡πà‡∏≤‡∏ó‡∏≤‡∏á';\n  }\n\n  /**\r\n   * üß≠ ‡πÅ‡∏õ‡∏•‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢\r\n   */\n  getDirectionThai(direction) {\n    const directions = {\n      'FRONT': '‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏£‡∏á',\n      'FRONT_RIGHT': '‡πÄ‡∏â‡∏µ‡∏¢‡∏á‡∏Ç‡∏ß‡∏≤‡∏´‡∏ô‡πâ‡∏≤',\n      'RIGHT': '‡∏Ç‡πâ‡∏≤‡∏á‡∏Ç‡∏ß‡∏≤',\n      'BACK_RIGHT': '‡πÄ‡∏â‡∏µ‡∏¢‡∏á‡∏Ç‡∏ß‡∏≤‡∏´‡∏•‡∏±‡∏á',\n      'BACK': '‡∏´‡∏•‡∏±‡∏á',\n      'BACK_LEFT': '‡πÄ‡∏â‡∏µ‡∏¢‡∏á‡∏ã‡πâ‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á',\n      'LEFT': '‡∏Ç‡πâ‡∏≤‡∏á‡∏ã‡πâ‡∏≤‡∏¢',\n      'FRONT_LEFT': '‡πÄ‡∏â‡∏µ‡∏¢‡∏á‡∏ã‡πâ‡∏≤‡∏¢‡∏´‡∏ô‡πâ‡∏≤'\n    };\n    return directions[direction] || '‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏£‡∏á';\n  }\n\n  /**\r\n   * üìè ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì confidence level\r\n   */\n  calculateConfidence(trainerAngles, traineeAngles) {\n    let validAngles = 0;\n    let totalAngles = 0;\n    Object.keys(this.JOINT_ANGLES).forEach(jointName => {\n      totalAngles++;\n      if (trainerAngles[jointName] !== null && traineeAngles[jointName] !== null) {\n        validAngles++;\n      }\n    });\n    return Math.round(validAngles / totalAngles * 100);\n  }\n\n  /**\r\n   * ‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á pose data\r\n   */\n  isValidPose(pose) {\n    return pose && Array.isArray(pose) && pose.length >= 33 && pose.some(point => (point === null || point === void 0 ? void 0 : point.visibility) > this.MIN_VISIBILITY);\n  }\n\n  /**\r\n   * üëÅÔ∏è ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏à‡∏∏‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏°‡∏≠‡∏á‡πÄ‡∏´‡πá‡∏ô‡πÑ‡∏î‡πâ\r\n   */\n  arePointsVisible(points) {\n    return points.every(point => point && typeof point.visibility === 'number' && point.visibility > this.MIN_VISIBILITY);\n  }\n\n  /**\r\n   * ‚ùå ‡∏™‡∏£‡πâ‡∏≤‡∏á error result\r\n   */\n  getErrorResult(message) {\n    return {\n      accuracy: 0,\n      confidence: 0,\n      feedback: message,\n      jointComparisons: {},\n      trainerDirection: 'UNKNOWN',\n      traineeDirection: 'UNKNOWN',\n      bodyPartScores: {},\n      recommendations: []\n    };\n  }\n\n  /**\r\n   * üé® ‡∏™‡∏µ accuracy ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö UI\r\n   */\n  getAccuracyColor(accuracy) {\n    if (accuracy >= 85) return '#22c55e'; // Green\n    if (accuracy >= 70) return '#eab308'; // Yellow\n    if (accuracy >= 50) return '#f97316'; // Orange\n    return '#ef4444'; // Red\n  }\n\n  // ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏ß‡πà‡∏≤‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà\n  isActiveExercise(trainerPose, traineePose) {\n    if (!trainerPose || !traineePose) return false;\n\n    // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß‡∏Ç‡∏≠‡∏á trainer (‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏ö‡∏≠‡∏Å‡∏ß‡πà‡∏≤‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà)\n    const trainerMovement = this.calculateMovementIntensity(trainerPose);\n\n    // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß‡∏Ç‡∏≠‡∏á trainee\n    const traineeMovement = this.calculateMovementIntensity(traineePose);\n\n    // ‡∏ñ‡πâ‡∏≤ trainer ‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß‡∏°‡∏≤‡∏Å ‡πÅ‡∏™‡∏î‡∏á‡∏ß‡πà‡∏≤‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢\n    const isTrainerActive = trainerMovement > this.MIN_MOVEMENT_THRESHOLD;\n\n    // ‡∏ñ‡πâ‡∏≤ trainee ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏ó‡∏≥‡∏ï‡∏≤‡∏° (‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß) \n    const isTraineeActive = traineeMovement > this.MIN_MOVEMENT_THRESHOLD * 0.5;\n    return isTrainerActive || isTraineeActive;\n  }\n\n  // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏°‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß\n  calculateMovementIntensity(pose) {\n    const keyJoints = ['LEFT_SHOULDER', 'RIGHT_SHOULDER', 'LEFT_HIP', 'RIGHT_HIP', 'LEFT_KNEE', 'RIGHT_KNEE'];\n    let totalMovement = 0;\n    let validJoints = 0;\n    for (const joint of keyJoints) {\n      const jointIndex = this.LANDMARKS[joint];\n      if (pose[jointIndex] && pose[jointIndex].visibility > this.MIN_VISIBILITY) {\n        // ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏õ‡∏£‡∏õ‡∏£‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏ö‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß\n        const centerDistance = Math.sqrt(Math.pow(pose[jointIndex].x - 0.5, 2) + Math.pow(pose[jointIndex].y - 0.5, 2));\n        totalMovement += centerDistance;\n        validJoints++;\n      }\n    }\n    return validJoints > 0 ? totalMovement / validJoints : 0;\n  }\n\n  // ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢\n  detectExerciseType(trainerPose, traineePose) {\n    if (!trainerPose) return 'default';\n    const leftHip = trainerPose[this.LANDMARKS.LEFT_HIP];\n    const rightHip = trainerPose[this.LANDMARKS.RIGHT_HIP];\n    const leftKnee = trainerPose[this.LANDMARKS.LEFT_KNEE];\n    const rightKnee = trainerPose[this.LANDMARKS.RIGHT_KNEE];\n    const leftShoulder = trainerPose[this.LANDMARKS.LEFT_SHOULDER];\n    const rightShoulder = trainerPose[this.LANDMARKS.RIGHT_SHOULDER];\n    if (!leftHip || !rightHip || !leftKnee || !rightKnee) return 'default';\n    const hipY = (leftHip.y + rightHip.y) / 2;\n    const kneeY = (leftKnee.y + rightKnee.y) / 2;\n    const shoulderY = leftShoulder && rightShoulder ? (leftShoulder.y + rightShoulder.y) / 2 : 0.3;\n\n    // ‡∏ñ‡πâ‡∏≤‡∏™‡∏∞‡πÇ‡∏û‡∏Å‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏Ç‡πà‡∏≤‡∏°‡∏≤‡∏Å = squat\n    if (hipY > kneeY + 0.1) {\n      return 'squat';\n    }\n\n    // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏´‡∏•‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ï‡πà‡∏≥‡∏°‡∏≤‡∏Å = push_up ‡∏´‡∏£‡∏∑‡∏≠ plank\n    if (shoulderY > 0.6) {\n      const leftElbow = trainerPose[this.LANDMARKS.LEFT_ELBOW];\n      const rightElbow = trainerPose[this.LANDMARKS.RIGHT_ELBOW];\n      if (leftElbow && rightElbow) {\n        const elbowMovement = Math.abs(leftElbow.y - shoulderY) + Math.abs(rightElbow.y - shoulderY);\n        return elbowMovement > 0.1 ? 'push_up' : 'plank';\n      }\n    }\n    return 'default';\n  }\n\n  // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÅ‡∏ö‡∏ö‡∏ñ‡πà‡∏ß‡∏á‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ó‡πà‡∏≤\n  calculateWeightedAccuracy(bodyPartScores, exerciseType) {\n    const weights = this.EXERCISE_WEIGHTS[exerciseType] || this.EXERCISE_WEIGHTS['default'];\n    const weightedScore = bodyPartScores.arms * weights.arms + bodyPartScores.legs * weights.legs + bodyPartScores.torso * weights.torso;\n    return Math.round(weightedScore);\n  }\n\n  // ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏ó‡πà‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏ï‡πâ‡∏ô (Pre-exercise comparison)\n  comparePreExercisePose(trainerPose, traineePose) {\n    // ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ó‡πà‡∏≤‡∏à‡∏≤‡∏Å trainer\n    const exerciseType = this.detectExerciseType(trainerPose, traineePose);\n\n    // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏°‡∏∏‡∏°‡∏Ç‡πâ‡∏≠‡∏ï‡πà‡∏≠\n    const trainerAngles = this.calculateAllJointAngles(trainerPose);\n    const traineeAngles = this.calculateAllJointAngles(traineePose);\n\n    // ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏°‡∏∏‡∏°‡∏Ç‡πâ‡∏≠‡∏ï‡πà‡∏≠\n    const angleComparisons = this.compareJointAngles(trainerAngles, traineeAngles);\n\n    // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÅ‡∏¢‡∏Å‡∏™‡πà‡∏ß‡∏ô\n    const bodyPartScores = this.calculateBodyPartScores(angleComparisons);\n\n    // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ñ‡πà‡∏ß‡∏á‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡πÅ‡∏ö‡∏ö Pre-exercise (‡πÄ‡∏ô‡πâ‡∏ô‡∏ó‡πà‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏ï‡πâ‡∏ô)\n    const preExerciseAccuracy = this.calculatePreExerciseAccuracy(bodyPartScores, exerciseType, trainerPose, traineePose);\n\n    // ‡∏™‡∏£‡πâ‡∏≤‡∏á feedback ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏ó‡πà‡∏≤\n    const feedback = this.generatePreExerciseFeedback(preExerciseAccuracy, exerciseType, bodyPartScores);\n    return {\n      accuracy: Math.round(preExerciseAccuracy),\n      confidence: 85,\n      // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à‡∏™‡∏π‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏ó‡πà‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏ï‡πâ‡∏ô\n      feedback,\n      jointComparisons: angleComparisons,\n      trainerDirection: this.detectBodyDirection(trainerPose),\n      traineeDirection: this.detectBodyDirection(traineePose),\n      bodyPartScores,\n      recommendations: this.generatePreExerciseRecommendations(bodyPartScores, exerciseType),\n      exerciseType,\n      exerciseActive: false,\n      mode: 'pre-exercise'\n    };\n  }\n\n  // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡πà‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏ï‡πâ‡∏ô\n  calculatePreExerciseAccuracy(bodyPartScores, exerciseType, trainerPose, traineePose) {\n    // ‡πÄ‡∏ô‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á\n    const startingPositionWeights = {\n      'squat': {\n        legs: 0.4,\n        torso: 0.5,\n        arms: 0.1\n      },\n      // ‡πÄ‡∏ô‡πâ‡∏ô‡∏•‡∏≥‡∏ï‡∏±‡∏ß‡∏ï‡∏£‡∏á‡πÅ‡∏•‡∏∞‡∏Ç‡∏≤‡∏û‡∏£‡πâ‡∏≠‡∏°\n      'push_up': {\n        arms: 0.6,\n        torso: 0.3,\n        legs: 0.1\n      },\n      // ‡πÄ‡∏ô‡πâ‡∏ô‡πÅ‡∏Ç‡∏ô‡πÅ‡∏•‡∏∞‡∏•‡∏≥‡∏ï‡∏±‡∏ß‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏™‡πâ‡∏ô‡∏ï‡∏£‡∏á\n      'plank': {\n        torso: 0.7,\n        arms: 0.2,\n        legs: 0.1\n      },\n      // ‡πÄ‡∏ô‡πâ‡∏ô‡∏•‡∏≥‡∏ï‡∏±‡∏ß‡∏ï‡∏£‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏•‡∏±‡∏Å\n      'default': {\n        arms: 0.33,\n        legs: 0.33,\n        torso: 0.34\n      }\n    };\n    const weights = startingPositionWeights[exerciseType] || startingPositionWeights['default'];\n\n    // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ñ‡πà‡∏ß‡∏á‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å\n    const weightedScore = bodyPartScores.arms * weights.arms + bodyPartScores.legs * weights.legs + bodyPartScores.torso * weights.torso;\n\n    // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏ö‡∏ô‡∏±‡∏™‡∏ñ‡πâ‡∏≤‡∏ó‡πà‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏ï‡πâ‡∏ô‡∏î‡∏µ (‡πÉ‡∏´‡πâ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏à)\n    const bonus = weightedScore > 70 ? 5 : 0;\n    return Math.min(100, weightedScore + bonus);\n  }\n\n  // ‡∏™‡∏£‡πâ‡∏≤‡∏á feedback ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏ó‡πà‡∏≤\n  generatePreExerciseFeedback(accuracy, exerciseType, bodyPartScores) {\n    if (accuracy >= 80) {\n      return `‡∏ó‡πà‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏ï‡πâ‡∏ô‡∏î‡∏µ‡∏°‡∏≤‡∏Å! ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏°${exerciseType}`;\n    } else if (accuracy >= 60) {\n      return `‡∏ó‡πà‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏ï‡πâ‡∏ô‡πÉ‡∏Å‡∏•‡πâ‡∏ñ‡∏π‡∏Å‡πÅ‡∏•‡πâ‡∏ß ‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢`;\n    } else {\n      const feedbackMap = {\n        'squat': '‡∏ï‡∏±‡πâ‡∏á‡∏ó‡πà‡∏≤: ‡πÄ‡∏ó‡πâ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏•‡πà ‡∏´‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏á',\n        'push_up': '‡∏ï‡∏±‡πâ‡∏á‡∏ó‡πà‡∏≤: ‡πÅ‡∏Ç‡∏ô‡∏ï‡∏±‡πâ‡∏á‡∏â‡∏≤‡∏Å ‡∏•‡∏≥‡∏ï‡∏±‡∏ß‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏™‡πâ‡∏ô‡∏ï‡∏£‡∏á',\n        'plank': '‡∏ï‡∏±‡πâ‡∏á‡∏ó‡πà‡∏≤: ‡πÅ‡∏Ç‡∏ô‡∏ï‡∏±‡πâ‡∏á‡∏â‡∏≤‡∏Å ‡∏•‡∏≥‡∏ï‡∏±‡∏ß‡∏ï‡∏£‡∏á‡πÑ‡∏°‡πà‡πÇ‡∏Å‡πà‡∏á',\n        'default': '‡∏õ‡∏£‡∏±‡∏ö‡∏ó‡πà‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏ï‡πâ‡∏ô‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Ñ‡∏•‡∏¥‡∏õ'\n      };\n      return feedbackMap[exerciseType] || feedbackMap['default'];\n    }\n  }\n\n  // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏ó‡πà‡∏≤\n  generatePreExerciseRecommendations(bodyPartScores, exerciseType) {\n    const recommendations = [];\n    const recommendationMap = {\n      'squat': {\n        lowTorso: '‡∏¢‡∏∑‡∏ô‡∏ï‡∏£‡∏á ‡πÄ‡∏Å‡πá‡∏ö‡∏≠‡∏Å‡∏≠‡∏≠‡∏Å ‡∏´‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏á',\n        lowLegs: '‡πÄ‡∏ó‡πâ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏•‡πà ‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏ó‡∏µ‡πà‡∏™‡πâ‡∏ô‡πÄ‡∏ó‡πâ‡∏≤',\n        lowArms: '‡πÅ‡∏Ç‡∏ô‡∏¢‡∏∑‡πà‡∏ô‡πÑ‡∏õ‡∏Ç‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏°‡∏î‡∏∏‡∏•'\n      },\n      'push_up': {\n        lowArms: '‡∏°‡∏∑‡∏≠‡∏ß‡∏≤‡∏á‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏•‡πà ‡πÅ‡∏Ç‡∏ô‡∏ï‡∏±‡πâ‡∏á‡∏â‡∏≤‡∏Å‡∏Å‡∏±‡∏ö‡∏û‡∏∑‡πâ‡∏ô',\n        lowTorso: '‡∏•‡∏≥‡∏ï‡∏±‡∏ß‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏™‡πâ‡∏ô‡∏ï‡∏£‡∏á‡∏à‡∏≤‡∏Å‡∏´‡∏±‡∏ß‡∏ñ‡∏∂‡∏á‡πÄ‡∏ó‡πâ‡∏≤',\n        lowLegs: '‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡∏≤‡πÉ‡∏´‡πâ‡∏ï‡∏∂‡∏á ‡πÄ‡∏ó‡πâ‡∏≤‡∏ä‡∏¥‡∏î‡∏Å‡∏±‡∏ô'\n      },\n      'plank': {\n        lowTorso: '‡∏•‡∏≥‡∏ï‡∏±‡∏ß‡∏ï‡∏£‡∏á ‡πÑ‡∏°‡πà‡πÇ‡∏Å‡πà‡∏á‡∏´‡∏•‡∏±‡∏á ‡πÑ‡∏°‡πà‡∏¢‡∏Å‡∏Å‡πâ‡∏ô‡∏™‡∏π‡∏á',\n        lowArms: '‡∏Ç‡πâ‡∏≠‡∏®‡∏≠‡∏Å‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ï‡πâ‡πÑ‡∏´‡∏•‡πà ‡πÅ‡∏Ç‡∏ô‡πÅ‡∏ô‡πà‡∏ô',\n        lowLegs: '‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡∏≤‡∏ï‡∏∂‡∏á ‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏ó‡∏µ‡πà‡∏õ‡∏•‡∏≤‡∏¢‡πÄ‡∏ó‡πâ‡∏≤'\n      }\n    };\n    const exerciseRecs = recommendationMap[exerciseType];\n    if (exerciseRecs) {\n      if (bodyPartScores.torso < 70) recommendations.push(exerciseRecs.lowTorso);\n      if (bodyPartScores.arms < 70) recommendations.push(exerciseRecs.lowArms);\n      if (bodyPartScores.legs < 70) recommendations.push(exerciseRecs.lowLegs);\n    }\n    if (recommendations.length === 0) {\n      recommendations.push('‡∏ó‡πà‡∏≤‡∏î‡∏µ‡πÅ‡∏•‡πâ‡∏ß ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢!');\n    }\n    return recommendations;\n  }\n\n  // ‡∏™‡∏£‡πâ‡∏≤‡∏á feedback ‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢\n  generateExerciseSpecificFeedback(accuracy, exerciseType, bodyPartScores) {\n    const weights = this.EXERCISE_WEIGHTS[exerciseType] || this.EXERCISE_WEIGHTS['default'];\n    if (accuracy >= 80) {\n      return `‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°! ‡∏ó‡πà‡∏≤${exerciseType}‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á`;\n    } else if (accuracy >= 60) {\n      var _feedbackMap$exercise;\n      // ‡∏´‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î\n      let worstPart = 'arms';\n      let worstScore = bodyPartScores.arms * weights.arms;\n      if (bodyPartScores.legs * weights.legs < worstScore) {\n        worstPart = 'legs';\n        worstScore = bodyPartScores.legs * weights.legs;\n      }\n      if (bodyPartScores.torso * weights.torso < worstScore) {\n        worstPart = 'torso';\n      }\n      const feedbackMap = {\n        'squat': {\n          'legs': '‡∏õ‡∏£‡∏±‡∏ö‡∏ó‡πà‡∏≤‡∏Ç‡∏≤: ‡πÄ‡∏Ç‡πà‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏ô‡∏õ‡∏•‡∏≤‡∏¢‡πÄ‡∏ó‡πâ‡∏≤',\n          'torso': '‡∏õ‡∏£‡∏±‡∏ö‡∏•‡∏≥‡∏ï‡∏±‡∏ß: ‡πÄ‡∏Å‡πá‡∏ö‡∏´‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏á ‡∏≠‡∏Å‡∏≠‡∏≠‡∏Å',\n          'arms': '‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏Ç‡∏ô: ‡∏¢‡∏∑‡πà‡∏ô‡πÅ‡∏Ç‡∏ô‡πÑ‡∏õ‡∏Ç‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ‡∏™‡∏°‡∏î‡∏∏‡∏•'\n        },\n        'push_up': {\n          'arms': '‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏Ç‡∏ô: ‡∏Ç‡πâ‡∏≠‡∏®‡∏≠‡∏Å‡πÉ‡∏Å‡∏•‡πâ‡∏•‡∏≥‡∏ï‡∏±‡∏ß ‡∏•‡∏á‡πÉ‡∏´‡πâ‡∏ï‡πà‡∏≥',\n          'torso': '‡∏õ‡∏£‡∏±‡∏ö‡∏•‡∏≥‡∏ï‡∏±‡∏ß: ‡πÄ‡∏Å‡πá‡∏ö‡∏´‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏á ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏™‡πâ‡∏ô‡∏ï‡∏£‡∏á',\n          'legs': '‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏≤: ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡∏≤‡πÉ‡∏´‡πâ‡∏ï‡∏∂‡∏á'\n        },\n        'plank': {\n          'torso': '‡∏õ‡∏£‡∏±‡∏ö‡∏•‡∏≥‡∏ï‡∏±‡∏ß: ‡πÄ‡∏Å‡πá‡∏ö‡∏´‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏á ‡∏≠‡∏¢‡πà‡∏≤‡πÇ‡∏Å‡πà‡∏á‡∏´‡∏•‡∏±‡∏á',\n          'arms': '‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏Ç‡∏ô: ‡πÅ‡∏Ç‡∏ô‡∏ï‡∏±‡πâ‡∏á‡∏â‡∏≤‡∏Å‡∏Å‡∏±‡∏ö‡∏û‡∏∑‡πâ‡∏ô',\n          'legs': '‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏≤: ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡∏≤‡πÅ‡∏•‡∏∞‡∏™‡∏∞‡πÇ‡∏û‡∏Å‡πÉ‡∏ô‡πÅ‡∏ô‡∏ß‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô'\n        },\n        'default': {\n          'arms': '‡∏õ‡∏£‡∏±‡∏ö‡∏ó‡πà‡∏≤‡πÅ‡∏Ç‡∏ô‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Ñ‡∏•‡∏¥‡∏õ',\n          'legs': '‡∏õ‡∏£‡∏±‡∏ö‡∏ó‡πà‡∏≤‡∏Ç‡∏≤‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Ñ‡∏•‡∏¥‡∏õ',\n          'torso': '‡∏õ‡∏£‡∏±‡∏ö‡∏ó‡πà‡∏≤‡∏•‡∏≥‡∏ï‡∏±‡∏ß‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Ñ‡∏•‡∏¥‡∏õ'\n        }\n      };\n      return ((_feedbackMap$exercise = feedbackMap[exerciseType]) === null || _feedbackMap$exercise === void 0 ? void 0 : _feedbackMap$exercise[worstPart]) || '‡∏õ‡∏£‡∏±‡∏ö‡∏ó‡πà‡∏≤‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Ñ‡∏•‡∏¥‡∏õ‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô';\n    } else {\n      return `‡∏ó‡πà‡∏≤${exerciseType}‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á - ‡∏î‡∏π‡∏Ñ‡∏•‡∏¥‡∏õ‡πÅ‡∏•‡∏∞‡∏ó‡∏≥‡∏ï‡∏≤‡∏°`;\n    }\n  }\n}\n\n// Export singleton instance\nexport const multiDirectionalPoseComparator = new MultiDirectionalPoseComparator();\nexport default MultiDirectionalPoseComparator;","map":{"version":3,"names":["MultiDirectionalPoseComparator","constructor","MIN_VISIBILITY","MIN_MOVEMENT_THRESHOLD","EXERCISE_WEIGHTS","legs","torso","arms","LANDMARKS","LEFT_SHOULDER","RIGHT_SHOULDER","LEFT_ELBOW","RIGHT_ELBOW","LEFT_WRIST","RIGHT_WRIST","LEFT_HIP","RIGHT_HIP","LEFT_KNEE","RIGHT_KNEE","LEFT_ANKLE","RIGHT_ANKLE","NOSE","LEFT_EAR","RIGHT_EAR","JOINT_ANGLES","LEFT_ARM_ANGLE","RIGHT_ARM_ANGLE","LEFT_LEG_ANGLE","RIGHT_LEG_ANGLE","LEFT_TORSO_ANGLE","RIGHT_TORSO_ANGLE","SHOULDER_ANGLE","HIP_ANGLE","DIRECTIONS","FRONT","FRONT_RIGHT","RIGHT","BACK_RIGHT","BACK","BACK_LEFT","LEFT","FRONT_LEFT","JOINT_WEIGHTS","compareMultiDirectional","trainerPose","traineePose","options","isValidPose","getErrorResult","mode","exerciseStarted","isExercising","isActiveExercise","comparePreExercisePose","accuracy","confidence","feedback","jointComparisons","trainerDirection","traineeDirection","bodyPartScores","recommendations","exerciseActive","exerciseType","detectExerciseType","trainerAngles","calculateAllJointAngles","traineeAngles","detectBodyDirection","angleComparisons","compareJointAngles","calculateBodyPartScores","weightedAccuracy","calculateWeightedAccuracy","generateExerciseSpecificFeedback","Math","round","calculateConfidence","generateRecommendations","exerciseWeights","calculateAngle","p1","p2","p3","v1","x","y","v2","dot","cross","angle","atan2","PI","pose","angles","Object","entries","forEach","jointName","p1Idx","p2Idx","p3Idx","arePointsVisible","leftShoulder","rightShoulder","nose","shoulderAngle","normalizedAngle","closestDirection","minDifference","Infinity","direction","difference","min","abs","comparisons","keys","trainerAngle","traineeAngle","angleDiff","max","angleDifference","weight","error","totalWeightedScore","totalWeight","values","comparison","generateDirectionalFeedback","worstJoint","findWorstJoint","getJointNameThai","getDirectionThai","lowestAccuracy","bodyParts","scores","bodyPart","joints","totalScore","count","joint","suggestion","getJointSpecificSuggestion","push","issue","sort","a","b","slice","suggestions","names","directions","validAngles","totalAngles","Array","isArray","length","some","point","visibility","points","every","message","getAccuracyColor","trainerMovement","calculateMovementIntensity","traineeMovement","isTrainerActive","isTraineeActive","keyJoints","totalMovement","validJoints","jointIndex","centerDistance","sqrt","pow","leftHip","rightHip","leftKnee","rightKnee","hipY","kneeY","shoulderY","leftElbow","rightElbow","elbowMovement","weights","weightedScore","preExerciseAccuracy","calculatePreExerciseAccuracy","generatePreExerciseFeedback","generatePreExerciseRecommendations","startingPositionWeights","bonus","feedbackMap","recommendationMap","lowTorso","lowLegs","lowArms","exerciseRecs","_feedbackMap$exercise","worstPart","worstScore","multiDirectionalPoseComparator"],"sources":["E:/BackupFit/frontend/src/utils/MultiDirectionalPoseComparator.js"],"sourcesContent":["/**\r\n * üéØ Advanced Multi-Directional Pose Comparator\r\n * ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏ó‡πà‡∏≤‡∏ó‡∏≤‡∏á‡πÅ‡∏ö‡∏ö 8 ‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡∏°‡∏∏‡∏°‡∏Ç‡πâ‡∏≠‡∏ï‡πà‡∏≠‡πÅ‡∏ó‡∏ô‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏à‡∏∏‡∏î\r\n * \r\n * Concept: \r\n * - ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏°‡∏∏‡∏°‡∏Ç‡πâ‡∏≠‡∏ï‡πà‡∏≠‡∏´‡∏•‡∏±‡∏Å‡∏à‡∏≤‡∏Å keypoints (Joint Angles)\r\n * - ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô 8 ‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á (Front, Back, Left, Right, ‡πÅ‡∏•‡∏∞ 4 ‡πÄ‡∏â‡∏µ‡∏¢‡∏á)\r\n * - ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö trainee ‡∏Å‡∏±‡∏ö trainer ‡πÅ‡∏ö‡∏ö real-time\r\n */\r\n\r\nexport class MultiDirectionalPoseComparator {\r\n  constructor() {\r\n    this.MIN_VISIBILITY = 0.7;\r\n    this.MIN_MOVEMENT_THRESHOLD = 0.05; // ‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥‡∏ó‡∏µ‡πà‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢\r\n    \r\n    // ‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ó‡πà‡∏≤\r\n    this.EXERCISE_WEIGHTS = {\r\n      'squat': {\r\n        legs: 0.6,    // ‡πÄ‡∏ô‡πâ‡∏ô‡∏Ç‡∏≤ 60%\r\n        torso: 0.3,   // ‡∏•‡∏≥‡∏ï‡∏±‡∏ß 30%\r\n        arms: 0.1     // ‡πÅ‡∏Ç‡∏ô 10%\r\n      },\r\n      'push_up': {\r\n        arms: 0.5,    // ‡πÄ‡∏ô‡πâ‡∏ô‡πÅ‡∏Ç‡∏ô 50%\r\n        torso: 0.4,   // ‡∏•‡∏≥‡∏ï‡∏±‡∏ß 40% \r\n        legs: 0.1     // ‡∏Ç‡∏≤ 10%\r\n      },\r\n      'plank': {\r\n        torso: 0.6,   // ‡πÄ‡∏ô‡πâ‡∏ô‡∏•‡∏≥‡∏ï‡∏±‡∏ß 60%\r\n        arms: 0.3,    // ‡πÅ‡∏Ç‡∏ô 30%\r\n        legs: 0.1     // ‡∏Ç‡∏≤ 10%\r\n      },\r\n      'default': {\r\n        arms: 0.33,   // ‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô‡∏´‡∏°‡∏î\r\n        legs: 0.33,\r\n        torso: 0.34\r\n      }\r\n    };\r\n\r\n    // MediaPipe Pose landmark indices\r\n    this.LANDMARKS = {\r\n      // Upper body key points\r\n      LEFT_SHOULDER: 11, RIGHT_SHOULDER: 12,\r\n      LEFT_ELBOW: 13, RIGHT_ELBOW: 14,\r\n      LEFT_WRIST: 15, RIGHT_WRIST: 16,\r\n      LEFT_HIP: 23, RIGHT_HIP: 24,\r\n      LEFT_KNEE: 25, RIGHT_KNEE: 26,\r\n      LEFT_ANKLE: 27, RIGHT_ANKLE: 28,\r\n      NOSE: 0,\r\n      LEFT_EAR: 7, RIGHT_EAR: 8\r\n    };\r\n\r\n    // Joint angle definitions - ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏°‡∏∏‡∏°‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢ 3 ‡∏à‡∏∏‡∏î [‡∏à‡∏∏‡∏î‡πÅ‡∏£‡∏Å, ‡∏à‡∏∏‡∏î‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á, ‡∏à‡∏∏‡∏î‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢]\r\n    this.JOINT_ANGLES = {\r\n      // ‡πÅ‡∏Ç‡∏ô‡∏ã‡πâ‡∏≤‡∏¢\r\n      LEFT_ARM_ANGLE: [this.LANDMARKS.LEFT_SHOULDER, this.LANDMARKS.LEFT_ELBOW, this.LANDMARKS.LEFT_WRIST],\r\n      // ‡πÅ‡∏Ç‡∏ô‡∏Ç‡∏ß‡∏≤  \r\n      RIGHT_ARM_ANGLE: [this.LANDMARKS.RIGHT_SHOULDER, this.LANDMARKS.RIGHT_ELBOW, this.LANDMARKS.RIGHT_WRIST],\r\n      // ‡∏Ç‡∏≤‡∏ã‡πâ‡∏≤‡∏¢\r\n      LEFT_LEG_ANGLE: [this.LANDMARKS.LEFT_HIP, this.LANDMARKS.LEFT_KNEE, this.LANDMARKS.LEFT_ANKLE],\r\n      // ‡∏Ç‡∏≤‡∏Ç‡∏ß‡∏≤\r\n      RIGHT_LEG_ANGLE: [this.LANDMARKS.RIGHT_HIP, this.LANDMARKS.RIGHT_KNEE, this.LANDMARKS.RIGHT_ANKLE],\r\n      // ‡∏•‡∏≥‡∏ï‡∏±‡∏ß‡∏ã‡πâ‡∏≤‡∏¢\r\n      LEFT_TORSO_ANGLE: [this.LANDMARKS.LEFT_SHOULDER, this.LANDMARKS.LEFT_HIP, this.LANDMARKS.LEFT_KNEE],\r\n      // ‡∏•‡∏≥‡∏ï‡∏±‡∏ß‡∏Ç‡∏ß‡∏≤\r\n      RIGHT_TORSO_ANGLE: [this.LANDMARKS.RIGHT_SHOULDER, this.LANDMARKS.RIGHT_HIP, this.LANDMARKS.RIGHT_KNEE],\r\n      // ‡πÑ‡∏´‡∏•‡πà (shoulder alignment)\r\n      SHOULDER_ANGLE: [this.LANDMARKS.LEFT_SHOULDER, this.LANDMARKS.NOSE, this.LANDMARKS.RIGHT_SHOULDER],\r\n      // ‡∏™‡∏∞‡πÇ‡∏û‡∏Å (hip alignment)  \r\n      HIP_ANGLE: [this.LANDMARKS.LEFT_HIP, this.LANDMARKS.NOSE, this.LANDMARKS.RIGHT_HIP]\r\n    };\r\n\r\n    // 8 ‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á‡∏´‡∏•‡∏±‡∏Å (degrees)\r\n    this.DIRECTIONS = {\r\n      FRONT: 0,           // ‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏£‡∏á\r\n      FRONT_RIGHT: 45,    // ‡πÄ‡∏â‡∏µ‡∏¢‡∏á‡∏Ç‡∏ß‡∏≤‡∏´‡∏ô‡πâ‡∏≤\r\n      RIGHT: 90,          // ‡∏Ç‡πâ‡∏≤‡∏á‡∏Ç‡∏ß‡∏≤\r\n      BACK_RIGHT: 135,    // ‡πÄ‡∏â‡∏µ‡∏¢‡∏á‡∏Ç‡∏ß‡∏≤‡∏´‡∏•‡∏±‡∏á\r\n      BACK: 180,          // ‡∏´‡∏•‡∏±‡∏á\r\n      BACK_LEFT: 225,     // ‡πÄ‡∏â‡∏µ‡∏¢‡∏á‡∏ã‡πâ‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á\r\n      LEFT: 270,          // ‡∏Ç‡πâ‡∏≤‡∏á‡∏ã‡πâ‡∏≤‡∏¢\r\n      FRONT_LEFT: 315     // ‡πÄ‡∏â‡∏µ‡∏¢‡∏á‡∏ã‡πâ‡∏≤‡∏¢‡∏´‡∏ô‡πâ‡∏≤\r\n    };\r\n\r\n    // ‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏ï‡πà‡∏≠\r\n    this.JOINT_WEIGHTS = {\r\n      LEFT_ARM_ANGLE: 1.5,\r\n      RIGHT_ARM_ANGLE: 1.5,\r\n      LEFT_LEG_ANGLE: 2.0,\r\n      RIGHT_LEG_ANGLE: 2.0,\r\n      LEFT_TORSO_ANGLE: 2.5,\r\n      RIGHT_TORSO_ANGLE: 2.5,\r\n      SHOULDER_ANGLE: 1.8,\r\n      HIP_ANGLE: 1.8\r\n    };\r\n\r\n    // Minimum visibility threshold\r\n    this.MIN_VISIBILITY = 0.6;\r\n  }\r\n\r\n  /**\r\n   * üéØ Main comparison function - Smart exercise-aware pose matching\r\n   * @param {Array} trainerPose - Trainer's keypoints\r\n   * @param {Array} traineePose - Trainee's keypoints (real-time)\r\n   * @param {Object} options - Options for comparison mode\r\n   * @returns {Object} - Comparison result with accuracy and detailed analysis\r\n   */\r\n  compareMultiDirectional(trainerPose, traineePose, options = {}) {\r\n    if (!this.isValidPose(trainerPose) || !this.isValidPose(traineePose)) {\r\n      return this.getErrorResult(\"Invalid pose data\");\r\n    }\r\n\r\n    const { mode = 'auto', exerciseStarted = false } = options;\r\n\r\n    // 1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà\r\n    const isExercising = this.isActiveExercise(trainerPose, traineePose);\r\n    \r\n    // Pre-exercise mode: ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏ó‡πà‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏ï‡πâ‡∏ô‡πÅ‡∏°‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢\r\n    if (!exerciseStarted || (!isExercising && mode === 'pre-exercise')) {\r\n      return this.comparePreExercisePose(trainerPose, traineePose);\r\n    }\r\n\r\n    // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß = ‡∏û‡∏±‡∏Å‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢\r\n    if (exerciseStarted && !isExercising) {\r\n      return {\r\n        accuracy: 0,\r\n        confidence: 30,\r\n        feedback: \"‡∏û‡∏±‡∏Å‡πÅ‡∏õ‡∏õ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ó‡∏≥‡∏ó‡πà‡∏≤‡∏ï‡πà‡∏≠‡πÑ‡∏õ\",\r\n        jointComparisons: {},\r\n        trainerDirection: \"UNKNOWN\",\r\n        traineeDirection: \"UNKNOWN\",\r\n        bodyPartScores: { arms: 0, legs: 0, torso: 0 },\r\n        recommendations: [\"‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏≥‡∏ó‡πà‡∏≤‡∏ï‡πà‡∏≠‡πÑ‡∏õ\"],\r\n        exerciseActive: false,\r\n        mode: 'resting'\r\n      };\r\n    }\r\n\r\n    // 2. ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢\r\n    const exerciseType = this.detectExerciseType(trainerPose, traineePose);\r\n\r\n    // 3. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏°‡∏∏‡∏°‡∏Ç‡πâ‡∏≠‡∏ï‡πà‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡∏≠‡∏á trainer ‡πÅ‡∏•‡∏∞ trainee\r\n    const trainerAngles = this.calculateAllJointAngles(trainerPose);\r\n    const traineeAngles = this.calculateAllJointAngles(traineePose);\r\n\r\n    // 4. ‡∏£‡∏∞‡∏ö‡∏∏‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏ô (‡πÉ‡∏ä‡πâ shoulder orientation)\r\n    const trainerDirection = this.detectBodyDirection(trainerPose);\r\n    const traineeDirection = this.detectBodyDirection(traineePose);\r\n\r\n    // 5. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πà‡∏≤‡∏á‡∏°‡∏∏‡∏°‡∏Ç‡πâ‡∏≠‡∏ï‡πà‡∏≠‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ï‡∏±‡∏ß\r\n    const angleComparisons = this.compareJointAngles(trainerAngles, traineeAngles);\r\n\r\n    // 6. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÅ‡∏¢‡∏Å‡∏™‡πà‡∏ß‡∏ô‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏¢\r\n    const bodyPartScores = this.calculateBodyPartScores(angleComparisons);\r\n    \r\n    // 7. ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì accuracy ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ó‡πà‡∏≤\r\n    const weightedAccuracy = this.calculateWeightedAccuracy(bodyPartScores, exerciseType);\r\n\r\n    // 8. ‡∏™‡∏£‡πâ‡∏≤‡∏á feedback ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥\r\n    const feedback = this.generateExerciseSpecificFeedback(weightedAccuracy, exerciseType, bodyPartScores);\r\n\r\n    return {\r\n      accuracy: Math.round(weightedAccuracy),\r\n      confidence: this.calculateConfidence(trainerAngles, traineeAngles),\r\n      feedback,\r\n      jointComparisons: angleComparisons,\r\n      trainerDirection,\r\n      traineeDirection,\r\n      bodyPartScores,\r\n      recommendations: this.generateRecommendations(angleComparisons),\r\n      exerciseType: exerciseType,\r\n      exerciseActive: true,\r\n      exerciseWeights: this.EXERCISE_WEIGHTS[exerciseType]\r\n    };\r\n  }\r\n\r\n  /**\r\n   * üìê ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏°‡∏∏‡∏°‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏™‡∏≤‡∏°‡∏à‡∏∏‡∏î (P1-P2-P3) ‡πÇ‡∏î‡∏¢ P2 ‡πÄ‡∏õ‡πá‡∏ô‡∏à‡∏∏‡∏î‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á\r\n   */\r\n  calculateAngle(p1, p2, p3) {\r\n    if (!p1 || !p2 || !p3) return null;\r\n    \r\n    // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏ß‡∏Å‡πÄ‡∏ï‡∏≠‡∏£‡πå\r\n    const v1 = { x: p1.x - p2.x, y: p1.y - p2.y };\r\n    const v2 = { x: p3.x - p2.x, y: p3.y - p2.y };\r\n    \r\n    // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏°‡∏∏‡∏°‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ dot product ‡πÅ‡∏•‡∏∞ cross product\r\n    const dot = v1.x * v2.x + v1.y * v2.y;\r\n    const cross = v1.x * v2.y - v1.y * v2.x;\r\n    \r\n    let angle = Math.atan2(cross, dot) * (180 / Math.PI);\r\n    \r\n    // ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô positive angle (0-360)\r\n    if (angle < 0) angle += 360;\r\n    \r\n    return angle;\r\n  }\r\n\r\n  /**\r\n   * üîç ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏°‡∏∏‡∏°‡∏Ç‡πâ‡∏≠‡∏ï‡πà‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î\r\n   */\r\n  calculateAllJointAngles(pose) {\r\n    const angles = {};\r\n    \r\n    Object.entries(this.JOINT_ANGLES).forEach(([jointName, [p1Idx, p2Idx, p3Idx]]) => {\r\n      const p1 = pose[p1Idx];\r\n      const p2 = pose[p2Idx];\r\n      const p3 = pose[p3Idx];\r\n      \r\n      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏à‡∏∏‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≤‡∏°‡∏°‡∏≠‡∏á‡πÄ‡∏´‡πá‡∏ô‡πÑ‡∏î‡πâ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô\r\n      if (this.arePointsVisible([p1, p2, p3])) {\r\n        angles[jointName] = this.calculateAngle(p1, p2, p3);\r\n      } else {\r\n        angles[jointName] = null; // ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÑ‡∏î‡πâ\r\n      }\r\n    });\r\n    \r\n    return angles;\r\n  }\r\n\r\n  /**\r\n   * üß≠ ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏Å (‡πÉ‡∏ä‡πâ‡πÑ‡∏´‡∏•‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏•‡∏±‡∏Å)\r\n   */\r\n  detectBodyDirection(pose) {\r\n    const leftShoulder = pose[this.LANDMARKS.LEFT_SHOULDER];\r\n    const rightShoulder = pose[this.LANDMARKS.RIGHT_SHOULDER];\r\n    const nose = pose[this.LANDMARKS.NOSE];\r\n    \r\n    if (!this.arePointsVisible([leftShoulder, rightShoulder, nose])) {\r\n      return 'UNKNOWN';\r\n    }\r\n    \r\n    // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏°‡∏∏‡∏°‡πÑ‡∏´‡∏•‡πà‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô\r\n    const shoulderAngle = Math.atan2(\r\n      rightShoulder.y - leftShoulder.y,\r\n      rightShoulder.x - leftShoulder.x\r\n    ) * (180 / Math.PI);\r\n    \r\n    // ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô positive angle\r\n    let normalizedAngle = shoulderAngle < 0 ? shoulderAngle + 360 : shoulderAngle;\r\n    \r\n    // ‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏Å‡∏±‡∏ö‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î\r\n    let closestDirection = 'FRONT';\r\n    let minDifference = Infinity;\r\n    \r\n    Object.entries(this.DIRECTIONS).forEach(([direction, angle]) => {\r\n      const difference = Math.min(\r\n        Math.abs(normalizedAngle - angle),\r\n        Math.abs(normalizedAngle - angle + 360),\r\n        Math.abs(normalizedAngle - angle - 360)\r\n      );\r\n      \r\n      if (difference < minDifference) {\r\n        minDifference = difference;\r\n        closestDirection = direction;\r\n      }\r\n    });\r\n    \r\n    return closestDirection;\r\n  }\r\n\r\n  /**\r\n   * ‚öñÔ∏è ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏°‡∏∏‡∏°‡∏Ç‡πâ‡∏≠‡∏ï‡πà‡∏≠‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á trainer ‡πÅ‡∏•‡∏∞ trainee\r\n   */\r\n  compareJointAngles(trainerAngles, traineeAngles) {\r\n    const comparisons = {};\r\n    \r\n    Object.keys(this.JOINT_ANGLES).forEach(jointName => {\r\n      const trainerAngle = trainerAngles[jointName];\r\n      const traineeAngle = traineeAngles[jointName];\r\n      \r\n      if (trainerAngle !== null && traineeAngle !== null) {\r\n        // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πà‡∏≤‡∏á‡∏°‡∏∏‡∏° (‡∏´‡∏≤‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏ô‡πâ‡∏≠‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÉ‡∏ô 360 ‡∏≠‡∏á‡∏®‡∏≤)\r\n        let angleDiff = Math.abs(trainerAngle - traineeAngle);\r\n        angleDiff = Math.min(angleDiff, 360 - angleDiff);\r\n        \r\n        // ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥ (‡∏¢‡∏¥‡πà‡∏á‡∏ï‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ = ‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡∏°‡∏≤‡∏Å)\r\n        const accuracy = Math.max(0, 100 - (angleDiff * 1.2)); // 1.2 ‡πÄ‡∏õ‡πá‡∏ô sensitivity factor\r\n        \r\n        comparisons[jointName] = {\r\n          trainerAngle: Math.round(trainerAngle),\r\n          traineeAngle: Math.round(traineeAngle),\r\n          angleDifference: Math.round(angleDiff),\r\n          accuracy: Math.round(accuracy),\r\n          weight: this.JOINT_WEIGHTS[jointName] || 1.0\r\n        };\r\n      } else {\r\n        comparisons[jointName] = {\r\n          trainerAngle: trainerAngle,\r\n          traineeAngle: traineeAngle,\r\n          angleDifference: null,\r\n          accuracy: 0,\r\n          weight: this.JOINT_WEIGHTS[jointName] || 1.0,\r\n          error: 'Points not visible'\r\n        };\r\n      }\r\n    });\r\n    \r\n    return comparisons;\r\n  }\r\n\r\n  /**\r\n   * üìä ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì accuracy ‡πÇ‡∏î‡∏¢‡∏£‡∏ß‡∏°‡πÅ‡∏ö‡∏ö‡∏°‡∏µ‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å\r\n   */\r\n  calculateWeightedAccuracy(angleComparisons) {\r\n    let totalWeightedScore = 0;\r\n    let totalWeight = 0;\r\n    \r\n    Object.values(angleComparisons).forEach(comparison => {\r\n      if (comparison.accuracy > 0) {\r\n        totalWeightedScore += comparison.accuracy * comparison.weight;\r\n        totalWeight += comparison.weight;\r\n      }\r\n    });\r\n    \r\n    return totalWeight > 0 ? totalWeightedScore / totalWeight : 0;\r\n  }\r\n\r\n  /**\r\n   * üí¨ ‡∏™‡∏£‡πâ‡∏≤‡∏á feedback ‡∏ï‡∏≤‡∏°‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á\r\n   */\r\n  generateDirectionalFeedback(accuracy, angleComparisons, trainerDirection, traineeDirection) {\r\n    if (accuracy >= 90) {\r\n      return \"üéâ ‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°! ‡∏ó‡πà‡∏≤‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡∏°‡∏≤‡∏Å\";\r\n    } else if (accuracy >= 80) {\r\n      return \"üëç ‡∏î‡∏µ‡∏°‡∏≤‡∏Å! ‡πÄ‡∏Å‡∏∑‡∏≠‡∏ö‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡πÅ‡∏•‡πâ‡∏ß\";\r\n    } else if (accuracy >= 70) {\r\n      return \"‚ö° ‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á‡πÅ‡∏•‡πâ‡∏ß ‡∏õ‡∏£‡∏±‡∏ö‡∏ó‡πà‡∏≤‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢\";\r\n    } else if (accuracy >= 60) {\r\n      // ‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏ï‡πà‡∏≠‡∏ó‡∏µ‡πà‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡∏ô‡πâ‡∏≠‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î\r\n      const worstJoint = this.findWorstJoint(angleComparisons);\r\n      return `‚ö†Ô∏è ‡∏õ‡∏£‡∏±‡∏ö${this.getJointNameThai(worstJoint)}‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô`;\r\n    } else if (accuracy >= 40) {\r\n      return `üîÑ ‡∏•‡∏≠‡∏á‡∏´‡∏±‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÑ‡∏õ‡∏ó‡∏≤‡∏á${this.getDirectionThai(trainerDirection)}‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÇ‡∏Ñ‡πâ‡∏ä`;\r\n    } else {\r\n      return \"üéØ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà - ‡∏î‡∏π‡∏ó‡πà‡∏≤‡∏Ç‡∏≠‡∏á‡πÇ‡∏Ñ‡πâ‡∏ä‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î\";\r\n    }\r\n  }\r\n\r\n  /**\r\n   * üîç ‡∏´‡∏≤‡∏Ç‡πâ‡∏≠‡∏ï‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡∏ô‡πâ‡∏≠‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î\r\n   */\r\n  findWorstJoint(angleComparisons) {\r\n    let worstJoint = null;\r\n    let lowestAccuracy = 100;\r\n    \r\n    Object.entries(angleComparisons).forEach(([jointName, comparison]) => {\r\n      if (comparison.accuracy < lowestAccuracy) {\r\n        lowestAccuracy = comparison.accuracy;\r\n        worstJoint = jointName;\r\n      }\r\n    });\r\n    \r\n    return worstJoint;\r\n  }\r\n\r\n  /**\r\n   * üèãÔ∏è ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏¢\r\n   */\r\n  calculateBodyPartScores(angleComparisons) {\r\n    const bodyParts = {\r\n      '‡πÅ‡∏Ç‡∏ô‡∏ã‡πâ‡∏≤‡∏¢': ['LEFT_ARM_ANGLE'],\r\n      '‡πÅ‡∏Ç‡∏ô‡∏Ç‡∏ß‡∏≤': ['RIGHT_ARM_ANGLE'],\r\n      '‡∏Ç‡∏≤‡∏ã‡πâ‡∏≤‡∏¢': ['LEFT_LEG_ANGLE'],\r\n      '‡∏Ç‡∏≤‡∏Ç‡∏ß‡∏≤': ['RIGHT_LEG_ANGLE'],\r\n      '‡∏•‡∏≥‡∏ï‡∏±‡∏ß': ['LEFT_TORSO_ANGLE', 'RIGHT_TORSO_ANGLE'],\r\n      '‡∏ó‡πà‡∏≤‡∏ó‡∏≤‡∏á': ['SHOULDER_ANGLE', 'HIP_ANGLE']\r\n    };\r\n    \r\n    const scores = {};\r\n    \r\n    Object.entries(bodyParts).forEach(([bodyPart, joints]) => {\r\n      let totalScore = 0;\r\n      let count = 0;\r\n      \r\n      joints.forEach(joint => {\r\n        if (angleComparisons[joint] && angleComparisons[joint].accuracy > 0) {\r\n          totalScore += angleComparisons[joint].accuracy;\r\n          count++;\r\n        }\r\n      });\r\n      \r\n      scores[bodyPart] = count > 0 ? totalScore / count : 0;\r\n    });\r\n    \r\n    return scores;\r\n  }\r\n\r\n  /**\r\n   * üí° ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏â‡∏û‡∏≤‡∏∞\r\n   */\r\n  generateRecommendations(angleComparisons) {\r\n    const recommendations = [];\r\n    \r\n    Object.entries(angleComparisons).forEach(([jointName, comparison]) => {\r\n      if (comparison.accuracy < 70 && comparison.accuracy > 0) {\r\n        const suggestion = this.getJointSpecificSuggestion(jointName, comparison);\r\n        if (suggestion) {\r\n          recommendations.push({\r\n            bodyPart: this.getJointNameThai(jointName),\r\n            issue: `${this.getJointNameThai(jointName)}‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏ä`,\r\n            suggestion: suggestion,\r\n            accuracy: comparison.accuracy\r\n          });\r\n        }\r\n      }\r\n    });\r\n    \r\n    // Sort by accuracy (lowest first)\r\n    return recommendations.sort((a, b) => a.accuracy - b.accuracy).slice(0, 3);\r\n  }\r\n\r\n  /**\r\n   * üéØ ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏ï‡πà‡∏≠\r\n   */\r\n  getJointSpecificSuggestion(jointName, comparison) {\r\n    const suggestions = {\r\n      'LEFT_ARM_ANGLE': '‡∏õ‡∏£‡∏±‡∏ö‡∏°‡∏∏‡∏°‡πÅ‡∏Ç‡∏ô‡∏ã‡πâ‡∏≤‡∏¢‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏ä',\r\n      'RIGHT_ARM_ANGLE': '‡∏õ‡∏£‡∏±‡∏ö‡∏°‡∏∏‡∏°‡πÅ‡∏Ç‡∏ô‡∏Ç‡∏ß‡∏≤‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏ä',\r\n      'LEFT_LEG_ANGLE': '‡∏õ‡∏£‡∏±‡∏ö‡∏°‡∏∏‡∏°‡∏Ç‡∏≤‡∏ã‡πâ‡∏≤‡∏¢‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏ä',\r\n      'RIGHT_LEG_ANGLE': '‡∏õ‡∏£‡∏±‡∏ö‡∏°‡∏∏‡∏°‡∏Ç‡∏≤‡∏Ç‡∏ß‡∏≤‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏ä',\r\n      'LEFT_TORSO_ANGLE': '‡∏õ‡∏£‡∏±‡∏ö‡∏ó‡πà‡∏≤‡∏•‡∏≥‡∏ï‡∏±‡∏ß‡∏ã‡πâ‡∏≤‡∏¢‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏ä',\r\n      'RIGHT_TORSO_ANGLE': '‡∏õ‡∏£‡∏±‡∏ö‡∏ó‡πà‡∏≤‡∏•‡∏≥‡∏ï‡∏±‡∏ß‡∏Ç‡∏ß‡∏≤‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏ä',\r\n      'SHOULDER_ANGLE': '‡∏õ‡∏£‡∏±‡∏ö‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÑ‡∏´‡∏•‡πà‡πÉ‡∏´‡πâ‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô',\r\n      'HIP_ANGLE': '‡∏õ‡∏£‡∏±‡∏ö‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏™‡∏∞‡πÇ‡∏û‡∏Å‡πÉ‡∏´‡πâ‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô'\r\n    };\r\n    \r\n    return suggestions[jointName] || '‡∏õ‡∏£‡∏±‡∏ö‡∏ó‡πà‡∏≤‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏ä';\r\n  }\r\n\r\n  /**\r\n   * üáπüá≠ ‡πÅ‡∏õ‡∏•‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡πâ‡∏≠‡∏ï‡πà‡∏≠‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢\r\n   */\r\n  getJointNameThai(jointName) {\r\n    const names = {\r\n      'LEFT_ARM_ANGLE': '‡πÅ‡∏Ç‡∏ô‡∏ã‡πâ‡∏≤‡∏¢',\r\n      'RIGHT_ARM_ANGLE': '‡πÅ‡∏Ç‡∏ô‡∏Ç‡∏ß‡∏≤',\r\n      'LEFT_LEG_ANGLE': '‡∏Ç‡∏≤‡∏ã‡πâ‡∏≤‡∏¢',\r\n      'RIGHT_LEG_ANGLE': '‡∏Ç‡∏≤‡∏Ç‡∏ß‡∏≤',\r\n      'LEFT_TORSO_ANGLE': '‡∏•‡∏≥‡∏ï‡∏±‡∏ß‡∏ã‡πâ‡∏≤‡∏¢',\r\n      'RIGHT_TORSO_ANGLE': '‡∏•‡∏≥‡∏ï‡∏±‡∏ß‡∏Ç‡∏ß‡∏≤',\r\n      'SHOULDER_ANGLE': '‡πÑ‡∏´‡∏•‡πà',\r\n      'HIP_ANGLE': '‡∏™‡∏∞‡πÇ‡∏û‡∏Å'\r\n    };\r\n    \r\n    return names[jointName] || '‡∏ó‡πà‡∏≤‡∏ó‡∏≤‡∏á';\r\n  }\r\n\r\n  /**\r\n   * üß≠ ‡πÅ‡∏õ‡∏•‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢\r\n   */\r\n  getDirectionThai(direction) {\r\n    const directions = {\r\n      'FRONT': '‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏£‡∏á',\r\n      'FRONT_RIGHT': '‡πÄ‡∏â‡∏µ‡∏¢‡∏á‡∏Ç‡∏ß‡∏≤‡∏´‡∏ô‡πâ‡∏≤',\r\n      'RIGHT': '‡∏Ç‡πâ‡∏≤‡∏á‡∏Ç‡∏ß‡∏≤',\r\n      'BACK_RIGHT': '‡πÄ‡∏â‡∏µ‡∏¢‡∏á‡∏Ç‡∏ß‡∏≤‡∏´‡∏•‡∏±‡∏á',\r\n      'BACK': '‡∏´‡∏•‡∏±‡∏á',\r\n      'BACK_LEFT': '‡πÄ‡∏â‡∏µ‡∏¢‡∏á‡∏ã‡πâ‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á',\r\n      'LEFT': '‡∏Ç‡πâ‡∏≤‡∏á‡∏ã‡πâ‡∏≤‡∏¢',\r\n      'FRONT_LEFT': '‡πÄ‡∏â‡∏µ‡∏¢‡∏á‡∏ã‡πâ‡∏≤‡∏¢‡∏´‡∏ô‡πâ‡∏≤'\r\n    };\r\n    \r\n    return directions[direction] || '‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏£‡∏á';\r\n  }\r\n\r\n  /**\r\n   * üìè ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì confidence level\r\n   */\r\n  calculateConfidence(trainerAngles, traineeAngles) {\r\n    let validAngles = 0;\r\n    let totalAngles = 0;\r\n    \r\n    Object.keys(this.JOINT_ANGLES).forEach(jointName => {\r\n      totalAngles++;\r\n      if (trainerAngles[jointName] !== null && traineeAngles[jointName] !== null) {\r\n        validAngles++;\r\n      }\r\n    });\r\n    \r\n    return Math.round((validAngles / totalAngles) * 100);\r\n  }\r\n\r\n  /**\r\n   * ‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á pose data\r\n   */\r\n  isValidPose(pose) {\r\n    return pose && \r\n           Array.isArray(pose) && \r\n           pose.length >= 33 && \r\n           pose.some(point => point?.visibility > this.MIN_VISIBILITY);\r\n  }\r\n\r\n  /**\r\n   * üëÅÔ∏è ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏à‡∏∏‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏°‡∏≠‡∏á‡πÄ‡∏´‡πá‡∏ô‡πÑ‡∏î‡πâ\r\n   */\r\n  arePointsVisible(points) {\r\n    return points.every(point => \r\n      point && \r\n      typeof point.visibility === 'number' && \r\n      point.visibility > this.MIN_VISIBILITY\r\n    );\r\n  }\r\n\r\n  /**\r\n   * ‚ùå ‡∏™‡∏£‡πâ‡∏≤‡∏á error result\r\n   */\r\n  getErrorResult(message) {\r\n    return {\r\n      accuracy: 0,\r\n      confidence: 0,\r\n      feedback: message,\r\n      jointComparisons: {},\r\n      trainerDirection: 'UNKNOWN',\r\n      traineeDirection: 'UNKNOWN',\r\n      bodyPartScores: {},\r\n      recommendations: []\r\n    };\r\n  }\r\n\r\n  /**\r\n   * üé® ‡∏™‡∏µ accuracy ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö UI\r\n   */\r\n  getAccuracyColor(accuracy) {\r\n    if (accuracy >= 85) return '#22c55e'; // Green\r\n    if (accuracy >= 70) return '#eab308'; // Yellow\r\n    if (accuracy >= 50) return '#f97316'; // Orange\r\n    return '#ef4444'; // Red\r\n  }\r\n\r\n  // ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏ß‡πà‡∏≤‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà\r\n  isActiveExercise(trainerPose, traineePose) {\r\n    if (!trainerPose || !traineePose) return false;\r\n\r\n    // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß‡∏Ç‡∏≠‡∏á trainer (‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏ö‡∏≠‡∏Å‡∏ß‡πà‡∏≤‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà)\r\n    const trainerMovement = this.calculateMovementIntensity(trainerPose);\r\n    \r\n    // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß‡∏Ç‡∏≠‡∏á trainee\r\n    const traineeMovement = this.calculateMovementIntensity(traineePose);\r\n\r\n    // ‡∏ñ‡πâ‡∏≤ trainer ‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß‡∏°‡∏≤‡∏Å ‡πÅ‡∏™‡∏î‡∏á‡∏ß‡πà‡∏≤‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢\r\n    const isTrainerActive = trainerMovement > this.MIN_MOVEMENT_THRESHOLD;\r\n    \r\n    // ‡∏ñ‡πâ‡∏≤ trainee ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏ó‡∏≥‡∏ï‡∏≤‡∏° (‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß) \r\n    const isTraineeActive = traineeMovement > this.MIN_MOVEMENT_THRESHOLD * 0.5;\r\n\r\n    return isTrainerActive || isTraineeActive;\r\n  }\r\n\r\n  // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏°‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß\r\n  calculateMovementIntensity(pose) {\r\n    const keyJoints = ['LEFT_SHOULDER', 'RIGHT_SHOULDER', 'LEFT_HIP', 'RIGHT_HIP', 'LEFT_KNEE', 'RIGHT_KNEE'];\r\n    let totalMovement = 0;\r\n    let validJoints = 0;\r\n\r\n    for (const joint of keyJoints) {\r\n      const jointIndex = this.LANDMARKS[joint];\r\n      if (pose[jointIndex] && pose[jointIndex].visibility > this.MIN_VISIBILITY) {\r\n        // ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏õ‡∏£‡∏õ‡∏£‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏ö‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß\r\n        const centerDistance = Math.sqrt(\r\n          Math.pow(pose[jointIndex].x - 0.5, 2) + \r\n          Math.pow(pose[jointIndex].y - 0.5, 2)\r\n        );\r\n        totalMovement += centerDistance;\r\n        validJoints++;\r\n      }\r\n    }\r\n\r\n    return validJoints > 0 ? totalMovement / validJoints : 0;\r\n  }\r\n\r\n  // ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢\r\n  detectExerciseType(trainerPose, traineePose) {\r\n    if (!trainerPose) return 'default';\r\n\r\n    const leftHip = trainerPose[this.LANDMARKS.LEFT_HIP];\r\n    const rightHip = trainerPose[this.LANDMARKS.RIGHT_HIP];\r\n    const leftKnee = trainerPose[this.LANDMARKS.LEFT_KNEE];\r\n    const rightKnee = trainerPose[this.LANDMARKS.RIGHT_KNEE];\r\n    const leftShoulder = trainerPose[this.LANDMARKS.LEFT_SHOULDER];\r\n    const rightShoulder = trainerPose[this.LANDMARKS.RIGHT_SHOULDER];\r\n\r\n    if (!leftHip || !rightHip || !leftKnee || !rightKnee) return 'default';\r\n\r\n    const hipY = (leftHip.y + rightHip.y) / 2;\r\n    const kneeY = (leftKnee.y + rightKnee.y) / 2;\r\n    const shoulderY = leftShoulder && rightShoulder ? (leftShoulder.y + rightShoulder.y) / 2 : 0.3;\r\n\r\n    // ‡∏ñ‡πâ‡∏≤‡∏™‡∏∞‡πÇ‡∏û‡∏Å‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏Ç‡πà‡∏≤‡∏°‡∏≤‡∏Å = squat\r\n    if (hipY > kneeY + 0.1) {\r\n      return 'squat';\r\n    }\r\n    \r\n    // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏´‡∏•‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ï‡πà‡∏≥‡∏°‡∏≤‡∏Å = push_up ‡∏´‡∏£‡∏∑‡∏≠ plank\r\n    if (shoulderY > 0.6) {\r\n      const leftElbow = trainerPose[this.LANDMARKS.LEFT_ELBOW];\r\n      const rightElbow = trainerPose[this.LANDMARKS.RIGHT_ELBOW];\r\n      \r\n      if (leftElbow && rightElbow) {\r\n        const elbowMovement = Math.abs(leftElbow.y - shoulderY) + Math.abs(rightElbow.y - shoulderY);\r\n        return elbowMovement > 0.1 ? 'push_up' : 'plank';\r\n      }\r\n    }\r\n\r\n    return 'default';\r\n  }\r\n\r\n  // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÅ‡∏ö‡∏ö‡∏ñ‡πà‡∏ß‡∏á‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ó‡πà‡∏≤\r\n  calculateWeightedAccuracy(bodyPartScores, exerciseType) {\r\n    const weights = this.EXERCISE_WEIGHTS[exerciseType] || this.EXERCISE_WEIGHTS['default'];\r\n    \r\n    const weightedScore = \r\n      (bodyPartScores.arms * weights.arms) +\r\n      (bodyPartScores.legs * weights.legs) +\r\n      (bodyPartScores.torso * weights.torso);\r\n\r\n    return Math.round(weightedScore);\r\n  }\r\n\r\n  // ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏ó‡πà‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏ï‡πâ‡∏ô (Pre-exercise comparison)\r\n  comparePreExercisePose(trainerPose, traineePose) {\r\n    // ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ó‡πà‡∏≤‡∏à‡∏≤‡∏Å trainer\r\n    const exerciseType = this.detectExerciseType(trainerPose, traineePose);\r\n    \r\n    // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏°‡∏∏‡∏°‡∏Ç‡πâ‡∏≠‡∏ï‡πà‡∏≠\r\n    const trainerAngles = this.calculateAllJointAngles(trainerPose);\r\n    const traineeAngles = this.calculateAllJointAngles(traineePose);\r\n    \r\n    // ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏°‡∏∏‡∏°‡∏Ç‡πâ‡∏≠‡∏ï‡πà‡∏≠\r\n    const angleComparisons = this.compareJointAngles(trainerAngles, traineeAngles);\r\n    \r\n    // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÅ‡∏¢‡∏Å‡∏™‡πà‡∏ß‡∏ô\r\n    const bodyPartScores = this.calculateBodyPartScores(angleComparisons);\r\n    \r\n    // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ñ‡πà‡∏ß‡∏á‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡πÅ‡∏ö‡∏ö Pre-exercise (‡πÄ‡∏ô‡πâ‡∏ô‡∏ó‡πà‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏ï‡πâ‡∏ô)\r\n    const preExerciseAccuracy = this.calculatePreExerciseAccuracy(bodyPartScores, exerciseType, trainerPose, traineePose);\r\n    \r\n    // ‡∏™‡∏£‡πâ‡∏≤‡∏á feedback ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏ó‡πà‡∏≤\r\n    const feedback = this.generatePreExerciseFeedback(preExerciseAccuracy, exerciseType, bodyPartScores);\r\n    \r\n    return {\r\n      accuracy: Math.round(preExerciseAccuracy),\r\n      confidence: 85, // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à‡∏™‡∏π‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏ó‡πà‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏ï‡πâ‡∏ô\r\n      feedback,\r\n      jointComparisons: angleComparisons,\r\n      trainerDirection: this.detectBodyDirection(trainerPose),\r\n      traineeDirection: this.detectBodyDirection(traineePose),\r\n      bodyPartScores,\r\n      recommendations: this.generatePreExerciseRecommendations(bodyPartScores, exerciseType),\r\n      exerciseType,\r\n      exerciseActive: false,\r\n      mode: 'pre-exercise'\r\n    };\r\n  }\r\n\r\n  // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡πà‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏ï‡πâ‡∏ô\r\n  calculatePreExerciseAccuracy(bodyPartScores, exerciseType, trainerPose, traineePose) {\r\n    // ‡πÄ‡∏ô‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á\r\n    const startingPositionWeights = {\r\n      'squat': { legs: 0.4, torso: 0.5, arms: 0.1 }, // ‡πÄ‡∏ô‡πâ‡∏ô‡∏•‡∏≥‡∏ï‡∏±‡∏ß‡∏ï‡∏£‡∏á‡πÅ‡∏•‡∏∞‡∏Ç‡∏≤‡∏û‡∏£‡πâ‡∏≠‡∏°\r\n      'push_up': { arms: 0.6, torso: 0.3, legs: 0.1 }, // ‡πÄ‡∏ô‡πâ‡∏ô‡πÅ‡∏Ç‡∏ô‡πÅ‡∏•‡∏∞‡∏•‡∏≥‡∏ï‡∏±‡∏ß‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏™‡πâ‡∏ô‡∏ï‡∏£‡∏á\r\n      'plank': { torso: 0.7, arms: 0.2, legs: 0.1 }, // ‡πÄ‡∏ô‡πâ‡∏ô‡∏•‡∏≥‡∏ï‡∏±‡∏ß‡∏ï‡∏£‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏•‡∏±‡∏Å\r\n      'default': { arms: 0.33, legs: 0.33, torso: 0.34 }\r\n    };\r\n\r\n    const weights = startingPositionWeights[exerciseType] || startingPositionWeights['default'];\r\n    \r\n    // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ñ‡πà‡∏ß‡∏á‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å\r\n    const weightedScore = \r\n      (bodyPartScores.arms * weights.arms) +\r\n      (bodyPartScores.legs * weights.legs) +\r\n      (bodyPartScores.torso * weights.torso);\r\n\r\n    // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏ö‡∏ô‡∏±‡∏™‡∏ñ‡πâ‡∏≤‡∏ó‡πà‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏ï‡πâ‡∏ô‡∏î‡∏µ (‡πÉ‡∏´‡πâ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏à)\r\n    const bonus = weightedScore > 70 ? 5 : 0;\r\n    \r\n    return Math.min(100, weightedScore + bonus);\r\n  }\r\n\r\n  // ‡∏™‡∏£‡πâ‡∏≤‡∏á feedback ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏ó‡πà‡∏≤\r\n  generatePreExerciseFeedback(accuracy, exerciseType, bodyPartScores) {\r\n    if (accuracy >= 80) {\r\n      return `‡∏ó‡πà‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏ï‡πâ‡∏ô‡∏î‡∏µ‡∏°‡∏≤‡∏Å! ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏°${exerciseType}`;\r\n    } else if (accuracy >= 60) {\r\n      return `‡∏ó‡πà‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏ï‡πâ‡∏ô‡πÉ‡∏Å‡∏•‡πâ‡∏ñ‡∏π‡∏Å‡πÅ‡∏•‡πâ‡∏ß ‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢`;\r\n    } else {\r\n      const feedbackMap = {\r\n        'squat': '‡∏ï‡∏±‡πâ‡∏á‡∏ó‡πà‡∏≤: ‡πÄ‡∏ó‡πâ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏•‡πà ‡∏´‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏á',\r\n        'push_up': '‡∏ï‡∏±‡πâ‡∏á‡∏ó‡πà‡∏≤: ‡πÅ‡∏Ç‡∏ô‡∏ï‡∏±‡πâ‡∏á‡∏â‡∏≤‡∏Å ‡∏•‡∏≥‡∏ï‡∏±‡∏ß‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏™‡πâ‡∏ô‡∏ï‡∏£‡∏á',\r\n        'plank': '‡∏ï‡∏±‡πâ‡∏á‡∏ó‡πà‡∏≤: ‡πÅ‡∏Ç‡∏ô‡∏ï‡∏±‡πâ‡∏á‡∏â‡∏≤‡∏Å ‡∏•‡∏≥‡∏ï‡∏±‡∏ß‡∏ï‡∏£‡∏á‡πÑ‡∏°‡πà‡πÇ‡∏Å‡πà‡∏á',\r\n        'default': '‡∏õ‡∏£‡∏±‡∏ö‡∏ó‡πà‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏ï‡πâ‡∏ô‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Ñ‡∏•‡∏¥‡∏õ'\r\n      };\r\n      return feedbackMap[exerciseType] || feedbackMap['default'];\r\n    }\r\n  }\r\n\r\n  // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏ó‡πà‡∏≤\r\n  generatePreExerciseRecommendations(bodyPartScores, exerciseType) {\r\n    const recommendations = [];\r\n    \r\n    const recommendationMap = {\r\n      'squat': {\r\n        lowTorso: '‡∏¢‡∏∑‡∏ô‡∏ï‡∏£‡∏á ‡πÄ‡∏Å‡πá‡∏ö‡∏≠‡∏Å‡∏≠‡∏≠‡∏Å ‡∏´‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏á',\r\n        lowLegs: '‡πÄ‡∏ó‡πâ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏•‡πà ‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏ó‡∏µ‡πà‡∏™‡πâ‡∏ô‡πÄ‡∏ó‡πâ‡∏≤',\r\n        lowArms: '‡πÅ‡∏Ç‡∏ô‡∏¢‡∏∑‡πà‡∏ô‡πÑ‡∏õ‡∏Ç‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏°‡∏î‡∏∏‡∏•'\r\n      },\r\n      'push_up': {\r\n        lowArms: '‡∏°‡∏∑‡∏≠‡∏ß‡∏≤‡∏á‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏•‡πà ‡πÅ‡∏Ç‡∏ô‡∏ï‡∏±‡πâ‡∏á‡∏â‡∏≤‡∏Å‡∏Å‡∏±‡∏ö‡∏û‡∏∑‡πâ‡∏ô',\r\n        lowTorso: '‡∏•‡∏≥‡∏ï‡∏±‡∏ß‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏™‡πâ‡∏ô‡∏ï‡∏£‡∏á‡∏à‡∏≤‡∏Å‡∏´‡∏±‡∏ß‡∏ñ‡∏∂‡∏á‡πÄ‡∏ó‡πâ‡∏≤',\r\n        lowLegs: '‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡∏≤‡πÉ‡∏´‡πâ‡∏ï‡∏∂‡∏á ‡πÄ‡∏ó‡πâ‡∏≤‡∏ä‡∏¥‡∏î‡∏Å‡∏±‡∏ô'\r\n      },\r\n      'plank': {\r\n        lowTorso: '‡∏•‡∏≥‡∏ï‡∏±‡∏ß‡∏ï‡∏£‡∏á ‡πÑ‡∏°‡πà‡πÇ‡∏Å‡πà‡∏á‡∏´‡∏•‡∏±‡∏á ‡πÑ‡∏°‡πà‡∏¢‡∏Å‡∏Å‡πâ‡∏ô‡∏™‡∏π‡∏á',\r\n        lowArms: '‡∏Ç‡πâ‡∏≠‡∏®‡∏≠‡∏Å‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ï‡πâ‡πÑ‡∏´‡∏•‡πà ‡πÅ‡∏Ç‡∏ô‡πÅ‡∏ô‡πà‡∏ô',\r\n        lowLegs: '‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡∏≤‡∏ï‡∏∂‡∏á ‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏ó‡∏µ‡πà‡∏õ‡∏•‡∏≤‡∏¢‡πÄ‡∏ó‡πâ‡∏≤'\r\n      }\r\n    };\r\n\r\n    const exerciseRecs = recommendationMap[exerciseType];\r\n    if (exerciseRecs) {\r\n      if (bodyPartScores.torso < 70) recommendations.push(exerciseRecs.lowTorso);\r\n      if (bodyPartScores.arms < 70) recommendations.push(exerciseRecs.lowArms);\r\n      if (bodyPartScores.legs < 70) recommendations.push(exerciseRecs.lowLegs);\r\n    }\r\n\r\n    if (recommendations.length === 0) {\r\n      recommendations.push('‡∏ó‡πà‡∏≤‡∏î‡∏µ‡πÅ‡∏•‡πâ‡∏ß ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢!');\r\n    }\r\n\r\n    return recommendations;\r\n  }\r\n\r\n  // ‡∏™‡∏£‡πâ‡∏≤‡∏á feedback ‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢\r\n  generateExerciseSpecificFeedback(accuracy, exerciseType, bodyPartScores) {\r\n    const weights = this.EXERCISE_WEIGHTS[exerciseType] || this.EXERCISE_WEIGHTS['default'];\r\n    \r\n    if (accuracy >= 80) {\r\n      return `‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°! ‡∏ó‡πà‡∏≤${exerciseType}‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á`;\r\n    } else if (accuracy >= 60) {\r\n      // ‡∏´‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î\r\n      let worstPart = 'arms';\r\n      let worstScore = bodyPartScores.arms * weights.arms;\r\n      \r\n      if (bodyPartScores.legs * weights.legs < worstScore) {\r\n        worstPart = 'legs';\r\n        worstScore = bodyPartScores.legs * weights.legs;\r\n      }\r\n      \r\n      if (bodyPartScores.torso * weights.torso < worstScore) {\r\n        worstPart = 'torso';\r\n      }\r\n\r\n      const feedbackMap = {\r\n        'squat': {\r\n          'legs': '‡∏õ‡∏£‡∏±‡∏ö‡∏ó‡πà‡∏≤‡∏Ç‡∏≤: ‡πÄ‡∏Ç‡πà‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏ô‡∏õ‡∏•‡∏≤‡∏¢‡πÄ‡∏ó‡πâ‡∏≤',\r\n          'torso': '‡∏õ‡∏£‡∏±‡∏ö‡∏•‡∏≥‡∏ï‡∏±‡∏ß: ‡πÄ‡∏Å‡πá‡∏ö‡∏´‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏á ‡∏≠‡∏Å‡∏≠‡∏≠‡∏Å',\r\n          'arms': '‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏Ç‡∏ô: ‡∏¢‡∏∑‡πà‡∏ô‡πÅ‡∏Ç‡∏ô‡πÑ‡∏õ‡∏Ç‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ‡∏™‡∏°‡∏î‡∏∏‡∏•'\r\n        },\r\n        'push_up': {\r\n          'arms': '‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏Ç‡∏ô: ‡∏Ç‡πâ‡∏≠‡∏®‡∏≠‡∏Å‡πÉ‡∏Å‡∏•‡πâ‡∏•‡∏≥‡∏ï‡∏±‡∏ß ‡∏•‡∏á‡πÉ‡∏´‡πâ‡∏ï‡πà‡∏≥',\r\n          'torso': '‡∏õ‡∏£‡∏±‡∏ö‡∏•‡∏≥‡∏ï‡∏±‡∏ß: ‡πÄ‡∏Å‡πá‡∏ö‡∏´‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏á ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏™‡πâ‡∏ô‡∏ï‡∏£‡∏á',\r\n          'legs': '‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏≤: ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡∏≤‡πÉ‡∏´‡πâ‡∏ï‡∏∂‡∏á'\r\n        },\r\n        'plank': {\r\n          'torso': '‡∏õ‡∏£‡∏±‡∏ö‡∏•‡∏≥‡∏ï‡∏±‡∏ß: ‡πÄ‡∏Å‡πá‡∏ö‡∏´‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏á ‡∏≠‡∏¢‡πà‡∏≤‡πÇ‡∏Å‡πà‡∏á‡∏´‡∏•‡∏±‡∏á',\r\n          'arms': '‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏Ç‡∏ô: ‡πÅ‡∏Ç‡∏ô‡∏ï‡∏±‡πâ‡∏á‡∏â‡∏≤‡∏Å‡∏Å‡∏±‡∏ö‡∏û‡∏∑‡πâ‡∏ô',\r\n          'legs': '‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏≤: ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡∏≤‡πÅ‡∏•‡∏∞‡∏™‡∏∞‡πÇ‡∏û‡∏Å‡πÉ‡∏ô‡πÅ‡∏ô‡∏ß‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô'\r\n        },\r\n        'default': {\r\n          'arms': '‡∏õ‡∏£‡∏±‡∏ö‡∏ó‡πà‡∏≤‡πÅ‡∏Ç‡∏ô‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Ñ‡∏•‡∏¥‡∏õ',\r\n          'legs': '‡∏õ‡∏£‡∏±‡∏ö‡∏ó‡πà‡∏≤‡∏Ç‡∏≤‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Ñ‡∏•‡∏¥‡∏õ',\r\n          'torso': '‡∏õ‡∏£‡∏±‡∏ö‡∏ó‡πà‡∏≤‡∏•‡∏≥‡∏ï‡∏±‡∏ß‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Ñ‡∏•‡∏¥‡∏õ'\r\n        }\r\n      };\r\n\r\n      return feedbackMap[exerciseType]?.[worstPart] || '‡∏õ‡∏£‡∏±‡∏ö‡∏ó‡πà‡∏≤‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Ñ‡∏•‡∏¥‡∏õ‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô';\r\n    } else {\r\n      return `‡∏ó‡πà‡∏≤${exerciseType}‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á - ‡∏î‡∏π‡∏Ñ‡∏•‡∏¥‡∏õ‡πÅ‡∏•‡∏∞‡∏ó‡∏≥‡∏ï‡∏≤‡∏°`;\r\n    }\r\n  }\r\n}\r\n\r\n// Export singleton instance\r\nexport const multiDirectionalPoseComparator = new MultiDirectionalPoseComparator();\r\nexport default MultiDirectionalPoseComparator;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}