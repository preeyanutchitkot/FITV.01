{"ast":null,"code":"export class MultiDirectionalPoseComparator {\n  constructor() {\n    this.MIN_VISIBILITY = 0.7;\n    this.IMPORTANT_JOINTS = ['nose', 'left_shoulder', 'right_shoulder', 'left_elbow', 'right_elbow', 'left_wrist', 'right_wrist', 'left_hip', 'right_hip', 'left_knee', 'right_knee', 'left_ankle', 'right_ankle'];\n  }\n\n  // คำนวนระยะห่างระหว่าง 2 จุด\n  calculateDistance(point1, point2) {\n    const dx = point1.x - point2.x;\n    const dy = point1.y - point2.y;\n    return Math.sqrt(dx * dx + dy * dy);\n  }\n\n  // คำนวนมุมระหว่าง 3 จุด\n  calculateAngle(point1, point2, point3) {\n    const dx1 = point1.x - point2.x;\n    const dy1 = point1.y - point2.y;\n    const dx2 = point3.x - point2.x;\n    const dy2 = point3.y - point2.y;\n    const angle1 = Math.atan2(dy1, dx1);\n    const angle2 = Math.atan2(dy2, dx2);\n    let angle = Math.abs(angle1 - angle2);\n    if (angle > Math.PI) {\n      angle = 2 * Math.PI - angle;\n    }\n    return angle * (180 / Math.PI); // แปลงเป็นองศา\n  }\n\n  // เปรียบเทียบท่าด้วย Gemini AI (แบบละเอียด)\n  async analyzeWithGemini(trainerKeypoints, traineeKeypoints) {\n    try {\n      // แปลง keypoints เป็นรูปแบบที่ AI เข้าใจง่าย\n      const trainerPositions = this.simplifyKeypoints(trainerKeypoints);\n      const traineePositions = this.simplifyKeypoints(traineeKeypoints);\n      const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${process.env.REACT_APP_GEMINI_API_KEY}`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          contents: [{\n            parts: [{\n              text: `คุณเป็นผู้เชี่ยวชาญด้านการวิเคราะห์ท่าออกกำลังกายและ physiotherapy วิเคราะห์ความถูกต้องของท่าโดยเปรียบเทียบตำแหน่งของข้อต่อ\n\n**ข้อมูลท่าครู (Trainer):**\n- ไหล่ซ้าย: (${trainerPositions.leftShoulder.x.toFixed(3)}, ${trainerPositions.leftShoulder.y.toFixed(3)})\n- ไหล่ขวา: (${trainerPositions.rightShoulder.x.toFixed(3)}, ${trainerPositions.rightShoulder.y.toFixed(3)})\n- ข้อศอกซ้าย: (${trainerPositions.leftElbow.x.toFixed(3)}, ${trainerPositions.leftElbow.y.toFixed(3)})\n- ข้อศอกขวา: (${trainerPositions.rightElbow.x.toFixed(3)}, ${trainerPositions.rightElbow.y.toFixed(3)})\n- ข้อมือซ้าย: (${trainerPositions.leftWrist.x.toFixed(3)}, ${trainerPositions.leftWrist.y.toFixed(3)})\n- ข้อมือขวา: (${trainerPositions.rightWrist.x.toFixed(3)}, ${trainerPositions.rightWrist.y.toFixed(3)})\n- สะโพกซ้าย: (${trainerPositions.leftHip.x.toFixed(3)}, ${trainerPositions.leftHip.y.toFixed(3)})\n- สะโพกขวา: (${trainerPositions.rightHip.x.toFixed(3)}, ${trainerPositions.rightHip.y.toFixed(3)})\n- เข่าซ้าย: (${trainerPositions.leftKnee.x.toFixed(3)}, ${trainerPositions.leftKnee.y.toFixed(3)})\n- เข่าขวา: (${trainerPositions.rightKnee.x.toFixed(3)}, ${trainerPositions.rightKnee.y.toFixed(3)})\n- ข้อเท้าซ้าย: (${trainerPositions.leftAnkle.x.toFixed(3)}, ${trainerPositions.leftAnkle.y.toFixed(3)})\n- ข้อเท้าขวา: (${trainerPositions.rightAnkle.x.toFixed(3)}, ${trainerPositions.rightAnkle.y.toFixed(3)})\n\n**ข้อมูลท่าผู้เรียน (Trainee):**\n- ไหล่ซ้าย: (${traineePositions.leftShoulder.x.toFixed(3)}, ${traineePositions.leftShoulder.y.toFixed(3)})\n- ไหล่ขวา: (${traineePositions.rightShoulder.x.toFixed(3)}, ${traineePositions.rightShoulder.y.toFixed(3)})\n- ข้อศอกซ้าย: (${traineePositions.leftElbow.x.toFixed(3)}, ${traineePositions.leftElbow.y.toFixed(3)})\n- ข้อศอกขวา: (${traineePositions.rightElbow.x.toFixed(3)}, ${traineePositions.rightElbow.y.toFixed(3)})\n- ข้อมือซ้าย: (${traineePositions.leftWrist.x.toFixed(3)}, ${traineePositions.leftWrist.y.toFixed(3)})\n- ข้อมือขวา: (${traineePositions.rightWrist.x.toFixed(3)}, ${traineePositions.rightWrist.y.toFixed(3)})\n- สะโพกซ้าย: (${traineePositions.leftHip.x.toFixed(3)}, ${traineePositions.leftHip.y.toFixed(3)})\n- สะโพกขวา: (${traineePositions.rightHip.x.toFixed(3)}, ${traineePositions.rightHip.y.toFixed(3)})\n- เข่าซ้าย: (${traineePositions.leftKnee.x.toFixed(3)}, ${traineePositions.leftKnee.y.toFixed(3)})\n- เข่าขวา: (${traineePositions.rightKnee.x.toFixed(3)}, ${traineePositions.rightKnee.y.toFixed(3)})\n- ข้อเท้าซ้าย: (${traineePositions.leftAnkle.x.toFixed(3)}, ${traineePositions.leftAnkle.y.toFixed(3)})\n- ข้อเท้าขวา: (${traineePositions.rightAnkle.x.toFixed(3)}, ${traineePositions.rightAnkle.y.toFixed(3)})\n\n**หลักเกณฑ์การให้คะแนน:**\n1. เปรียบเทียบตำแหน่งข้อต่อแต่ละจุด (ระยะห่างไม่เกิน 0.1 = คะแนนเต็ม)\n2. วิเคราะห์การจัดตำแหน่งของลำตัว (ความตรงของกระดูกสันหลัง)\n3. ดูความสมดุลของแขนและขา\n4. ประเมินความสมเหตุสมผลของท่าโดยรวม\n5. คะแนน 0-30 = ท่าไม่ถูกต้อง, 31-60 = ปานกลาง, 61-80 = ดี, 81-100 = ยอดเยี่ยม\n\nให้วิเคราะห์และตอบเป็น JSON format เท่านั้น:\n{\n  \"accuracy\": 0-100,\n  \"detailedAnalysis\": {\n    \"armAccuracy\": 0-100,\n    \"legAccuracy\": 0-100,\n    \"torsoAccuracy\": 0-100,\n    \"overallPosture\": 0-100\n  },\n  \"feedback\": \"คำแนะนำภาษาไทยแบบเฉพาะเจาะจง\",\n  \"recommendations\": [\"คำแนะนำ1\", \"คำแนะนำ2\", \"คำแนะนำ3\"]\n}`\n            }]\n          }],\n          generationConfig: {\n            temperature: 0.1,\n            maxOutputTokens: 800\n          }\n        })\n      });\n      if (response.ok) {\n        const data = await response.json();\n        const content = data.candidates[0].content.parts[0].text;\n\n        // ลองแยก JSON จากข้อความ\n        const jsonMatch = content.match(/\\{[\\s\\S]*\\}/);\n        if (jsonMatch) {\n          const aiResult = JSON.parse(jsonMatch[0]);\n          return aiResult;\n        }\n      }\n    } catch (error) {\n      console.log('Gemini API error:', error);\n    }\n    return null;\n  }\n\n  // แปลง keypoints เป็นรูปแบบที่เข้าใจง่าย\n  simplifyKeypoints(keypoints) {\n    const getPoint = jointName => {\n      const point = keypoints[jointName];\n      return point && point.visibility > this.MIN_VISIBILITY ? {\n        x: point.x,\n        y: point.y\n      } : {\n        x: 0,\n        y: 0\n      };\n    };\n    return {\n      leftShoulder: getPoint('left_shoulder'),\n      rightShoulder: getPoint('right_shoulder'),\n      leftElbow: getPoint('left_elbow'),\n      rightElbow: getPoint('right_elbow'),\n      leftWrist: getPoint('left_wrist'),\n      rightWrist: getPoint('right_wrist'),\n      leftHip: getPoint('left_hip'),\n      rightHip: getPoint('right_hip'),\n      leftKnee: getPoint('left_knee'),\n      rightKnee: getPoint('right_knee'),\n      leftAnkle: getPoint('left_ankle'),\n      rightAnkle: getPoint('right_ankle')\n    };\n  }\n\n  // เปรียบเทียบท่าด้วย OpenAI (backup)\n  async analyzeWithOpenAI(trainerKeypoints, traineeKeypoints) {\n    try {\n      const response = await fetch('https://api.openai.com/v1/chat/completions', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${process.env.REACT_APP_OPENAI_API_KEY}`\n        },\n        body: JSON.stringify({\n          model: \"gpt-3.5-turbo\",\n          messages: [{\n            role: \"system\",\n            content: \"คุณเป็นผู้เชี่ยวชาญด้านการวิเคราะห์ท่าออกกำลังกาย ให้คะแนนความถูกต้องของท่าโดยเปรียบเทียบ keypoints\"\n          }, {\n            role: \"user\",\n            content: `วิเคราะห์ท่าออกกำลังกาย:\n            Trainer keypoints: ${JSON.stringify(trainerKeypoints)}\n            Trainee keypoints: ${JSON.stringify(traineeKeypoints)}\n            \n            ให้คะแนนเป็น JSON format:\n            {\n              \"accuracy\": 0-100,\n              \"feedback\": \"คำแนะนำภาษาไทย\",\n              \"recommendations\": [\"คำแนะนำ1\", \"คำแนะนำ2\"]\n            }`\n          }],\n          max_tokens: 500,\n          temperature: 0.3\n        })\n      });\n      if (response.ok) {\n        const data = await response.json();\n        const aiResult = JSON.parse(data.choices[0].message.content);\n        return aiResult;\n      }\n    } catch (error) {\n      console.log('OpenAI API error:', error);\n    }\n    return null;\n  }\n\n  // เรียกใช้ AI โดยลองใช้ Gemini ก่อน แล้วค่อย fallback เป็น OpenAI\n  async analyzeWithAI(trainerKeypoints, traineeKeypoints) {\n    // ลอง Gemini ก่อน (ฟรี)\n    if (process.env.REACT_APP_GEMINI_API_KEY && process.env.REACT_APP_GEMINI_API_KEY !== 'ใส่_GEMINI_API_KEY_ตรงนี้') {\n      const geminiResult = await this.analyzeWithGemini(trainerKeypoints, traineeKeypoints);\n      if (geminiResult) {\n        return {\n          ...geminiResult,\n          aiProvider: 'Gemini'\n        };\n      }\n    }\n\n    // ถ้า Gemini ไม่ได้ ลอง OpenAI\n    if (process.env.REACT_APP_OPENAI_API_KEY && process.env.REACT_APP_OPENAI_API_KEY !== 'ใส่_OPENAI_API_KEY_ตรงนี้') {\n      const openaiResult = await this.analyzeWithOpenAI(trainerKeypoints, traineeKeypoints);\n      if (openaiResult) {\n        return {\n          ...openaiResult,\n          aiProvider: 'OpenAI'\n        };\n      }\n    }\n\n    // ไม่มี AI ไหนทำงาน\n    return null;\n  }\n\n  // คำนวนความแม่นยำแบบดั้งเดิม\n  calculateTraditionalAccuracy(trainerKeypoints, traineeKeypoints) {\n    let totalScore = 0;\n    let validJoints = 0;\n    const jointComparisons = {};\n    const incorrectJoints = [];\n    for (const joint of this.IMPORTANT_JOINTS) {\n      const trainerJoint = trainerKeypoints[joint];\n      const traineeJoint = traineeKeypoints[joint];\n      if (trainerJoint && traineeJoint && trainerJoint.visibility > this.MIN_VISIBILITY && traineeJoint.visibility > this.MIN_VISIBILITY) {\n        // คำนวนระยะห่างระหว่างจุด\n        const distance = this.calculateDistance(trainerJoint, traineeJoint);\n\n        // แปลงเป็นคะแนน (ยิ่งใกล้ยิ่งคะแนนสูง)\n        const maxDistance = 0.3; // ระยะห่างสูงสุดที่ยอมรับได้\n        const jointScore = Math.max(0, 100 - distance / maxDistance * 100);\n        totalScore += jointScore;\n        validJoints++;\n        jointComparisons[joint] = {\n          distance: distance,\n          score: Math.round(jointScore),\n          trainerPosition: {\n            x: trainerJoint.x,\n            y: trainerJoint.y\n          },\n          traineePosition: {\n            x: traineeJoint.x,\n            y: traineeJoint.y\n          }\n        };\n\n        // เก็บข้อต่อที่ผิดพลาด (คะแนนต่ำกว่า 60)\n        if (jointScore < 60) {\n          incorrectJoints.push({\n            joint: joint,\n            score: Math.round(jointScore),\n            message: this.getJointCorrectionMessage(joint, trainerJoint, traineeJoint)\n          });\n        }\n      }\n    }\n    return {\n      accuracy: validJoints > 0 ? Math.round(totalScore / validJoints) : 0,\n      jointComparisons: jointComparisons,\n      validJoints: validJoints,\n      incorrectJoints: incorrectJoints\n    };\n  }\n\n  // ข้อความแนะนำการแก้ไขสำหรับแต่ละข้อต่อ (แบบ UI ที่ต้องการ)\n  getJointCorrectionMessage(joint, trainerPos, traineePos) {\n    // วิเคราะห์ตำแหน่งเพื่อให้คำแนะนำที่แม่นยำ\n    const dx = traineePos.x - trainerPos.x;\n    const dy = traineePos.y - trainerPos.y;\n    const jointMessages = {\n      'left_shoulder': 'Left Shoulder: Keep shoulder level and aligned',\n      'right_shoulder': 'Right Shoulder: Keep shoulder level and aligned',\n      'left_elbow': 'Left Elbow: Maintain proper elbow angle',\n      'right_elbow': 'Right Elbow: Maintain proper elbow angle',\n      'left_wrist': 'Left Wrist: Keep wrist straight and controlled',\n      'right_wrist': 'Right Wrist: Keep wrist straight and controlled',\n      'left_hip': 'Left Hip: Keep hips square and stable',\n      'right_hip': 'Right Hip: Keep hips square and stable',\n      'left_knee': 'Left Knee: Keep knees aligned with toes',\n      'right_knee': 'Right Knee: Keep knees aligned with toes',\n      'left_ankle': 'Left Ankle: Maintain stable foot position',\n      'right_ankle': 'Right Ankle: Maintain stable foot position',\n      'nose': 'Head: Keep head in neutral position'\n    };\n\n    // เพิ่มคำแนะนำเฉพาะตามทิศทางที่ผิด\n    let baseMessage = jointMessages[joint] || `${joint}: Adjust position to match trainer`;\n\n    // เพิ่มทิศทางเฉพาะถ้าต้องการ\n    if (Math.abs(dx) > 0.1 || Math.abs(dy) > 0.1) {\n      if (joint.includes('knee')) {\n        baseMessage = 'Left Knee: Keep knees aligned with toes';\n      } else if (joint.includes('back') || joint.includes('hip')) {\n        baseMessage = 'Back: Keep chest up and spine neutral';\n      }\n    }\n    return baseMessage;\n  }\n  async compareMultiDirectional(trainerPose, traineePose) {\n    if (!trainerPose || !traineePose) {\n      return {\n        accuracy: 0,\n        confidence: 0,\n        feedback: \"กรุณาเริ่มทำท่าตามคลิป\",\n        jointComparisons: {},\n        trainerDirection: \"unknown\",\n        traineeDirection: \"unknown\",\n        bodyPartScores: {},\n        recommendations: []\n      };\n    }\n\n    // คำนวนแบบดั้งเดิมก่อน\n    const traditionalResult = this.calculateTraditionalAccuracy(trainerPose, traineePose);\n\n    // เรียก AI มาวิเคราะห์เพิ่มเติม\n    const aiResult = await this.analyzeWithAI(trainerPose, traineePose);\n\n    // รวมผลลัพธ์ โดยให้น้ำหนัก AI มากกว่า\n    let finalAccuracy = traditionalResult.accuracy;\n    let feedback = \"ปรับปรุงท่าให้ตรงมากขึ้น\";\n    let recommendations = [\"ปรับท่าให้ตรงกับคลิปมากขึ้น\"];\n    let bodyPartScores = this.calculateBodyPartScores(traditionalResult.jointComparisons);\n    if (aiResult) {\n      // ให้น้ำหนัก AI 70% และ Traditional 30%\n      finalAccuracy = Math.round(aiResult.accuracy * 0.7 + traditionalResult.accuracy * 0.3);\n      feedback = aiResult.feedback || feedback;\n      recommendations = aiResult.recommendations || recommendations;\n\n      // ใช้คะแนนแยกส่วนจาก AI ถ้ามี\n      if (aiResult.detailedAnalysis) {\n        bodyPartScores = {\n          arms: aiResult.detailedAnalysis.armAccuracy || bodyPartScores.arms,\n          legs: aiResult.detailedAnalysis.legAccuracy || bodyPartScores.legs,\n          torso: aiResult.detailedAnalysis.torsoAccuracy || bodyPartScores.torso,\n          overallPosture: aiResult.detailedAnalysis.overallPosture || finalAccuracy\n        };\n      }\n    }\n    return {\n      accuracy: finalAccuracy,\n      confidence: aiResult ? 95 : traditionalResult.validJoints > 8 ? 80 : 60,\n      feedback: feedback,\n      jointComparisons: traditionalResult.jointComparisons,\n      trainerDirection: \"front\",\n      traineeDirection: \"front\",\n      bodyPartScores: bodyPartScores,\n      recommendations: recommendations,\n      aiAnalyzed: !!aiResult,\n      aiProvider: (aiResult === null || aiResult === void 0 ? void 0 : aiResult.aiProvider) || null,\n      traditionalScore: traditionalResult.accuracy,\n      aiScore: (aiResult === null || aiResult === void 0 ? void 0 : aiResult.accuracy) || null,\n      analysisMethod: aiResult ? \"AI-Enhanced (70% AI + 30% Traditional)\" : \"Traditional Only\",\n      detailedAnalysis: (aiResult === null || aiResult === void 0 ? void 0 : aiResult.detailedAnalysis) || null,\n      incorrectJoints: traditionalResult.incorrectJoints || [],\n      correctionMessages: this.generateCorrectionMessages(traditionalResult.incorrectJoints || [], aiResult)\n    };\n  }\n\n  // สร้างข้อความแนะนำที่รวมข้อมูลจาก AI และการคำนวนแบบดั้งเดิม\n  generateCorrectionMessages(incorrectJoints, aiResult) {\n    const messages = [];\n\n    // ข้อความจากการคำนวนแบบดั้งเดิม\n    incorrectJoints.forEach(joint => {\n      messages.push({\n        type: 'joint',\n        severity: joint.score < 30 ? 'high' : joint.score < 60 ? 'medium' : 'low',\n        message: joint.message,\n        score: joint.score\n      });\n    });\n\n    // ข้อความเพิ่มเติมจาก AI\n    if (aiResult && aiResult.recommendations) {\n      aiResult.recommendations.forEach(rec => {\n        messages.push({\n          type: 'ai_recommendation',\n          severity: 'medium',\n          message: rec,\n          score: null\n        });\n      });\n    }\n\n    // เพิ่มข้อความเฉพาะตามคะแนนแยกส่วน (ตรงกับ UI)\n    if (aiResult && aiResult.detailedAnalysis) {\n      const analysis = aiResult.detailedAnalysis;\n      if (analysis.armAccuracy < 60) {\n        messages.push({\n          type: 'body_part',\n          severity: analysis.armAccuracy < 40 ? 'high' : 'medium',\n          message: 'Arms: Keep arms in proper position and maintain control',\n          score: analysis.armAccuracy\n        });\n      }\n      if (analysis.legAccuracy < 60) {\n        messages.push({\n          type: 'body_part',\n          severity: analysis.legAccuracy < 40 ? 'high' : 'medium',\n          message: 'Legs: Keep knees aligned and maintain stable stance',\n          score: analysis.legAccuracy\n        });\n      }\n      if (analysis.torsoAccuracy < 60) {\n        messages.push({\n          type: 'body_part',\n          severity: analysis.torsoAccuracy < 40 ? 'high' : 'medium',\n          message: 'Back: Keep chest up and spine neutral',\n          score: analysis.torsoAccuracy\n        });\n      }\n    }\n\n    // เพิ่มข้อความเฉพาะสำหรับท่าที่ผิดมาก\n    if (incorrectJoints.length > 3) {\n      messages.unshift({\n        type: 'general',\n        severity: 'high',\n        message: 'Posture: Focus on overall body alignment',\n        score: null\n      });\n    }\n    return messages;\n  }\n  calculateBodyPartScores(jointComparisons) {\n    const armJoints = ['left_shoulder', 'right_shoulder', 'left_elbow', 'right_elbow', 'left_wrist', 'right_wrist'];\n    const legJoints = ['left_hip', 'right_hip', 'left_knee', 'right_knee', 'left_ankle', 'right_ankle'];\n    const torsoJoints = ['nose', 'left_shoulder', 'right_shoulder', 'left_hip', 'right_hip'];\n    const calculatePartScore = joints => {\n      let total = 0;\n      let count = 0;\n      joints.forEach(joint => {\n        if (jointComparisons[joint]) {\n          total += jointComparisons[joint].score;\n          count++;\n        }\n      });\n      return count > 0 ? Math.round(total / count) : 0;\n    };\n    return {\n      arms: calculatePartScore(armJoints),\n      legs: calculatePartScore(legJoints),\n      torso: calculatePartScore(torsoJoints)\n    };\n  }\n}\n\n// Export instance สำหรับ import ที่มีอยู่\nexport const multiDirectionalPoseComparator = new MultiDirectionalPoseComparator();","map":{"version":3,"names":["MultiDirectionalPoseComparator","constructor","MIN_VISIBILITY","IMPORTANT_JOINTS","calculateDistance","point1","point2","dx","x","dy","y","Math","sqrt","calculateAngle","point3","dx1","dy1","dx2","dy2","angle1","atan2","angle2","angle","abs","PI","analyzeWithGemini","trainerKeypoints","traineeKeypoints","trainerPositions","simplifyKeypoints","traineePositions","response","fetch","process","env","REACT_APP_GEMINI_API_KEY","method","headers","body","JSON","stringify","contents","parts","text","leftShoulder","toFixed","rightShoulder","leftElbow","rightElbow","leftWrist","rightWrist","leftHip","rightHip","leftKnee","rightKnee","leftAnkle","rightAnkle","generationConfig","temperature","maxOutputTokens","ok","data","json","content","candidates","jsonMatch","match","aiResult","parse","error","console","log","keypoints","getPoint","jointName","point","visibility","analyzeWithOpenAI","REACT_APP_OPENAI_API_KEY","model","messages","role","max_tokens","choices","message","analyzeWithAI","geminiResult","aiProvider","openaiResult","calculateTraditionalAccuracy","totalScore","validJoints","jointComparisons","incorrectJoints","joint","trainerJoint","traineeJoint","distance","maxDistance","jointScore","max","score","round","trainerPosition","traineePosition","push","getJointCorrectionMessage","accuracy","trainerPos","traineePos","jointMessages","baseMessage","includes","compareMultiDirectional","trainerPose","traineePose","confidence","feedback","trainerDirection","traineeDirection","bodyPartScores","recommendations","traditionalResult","finalAccuracy","calculateBodyPartScores","detailedAnalysis","arms","armAccuracy","legs","legAccuracy","torso","torsoAccuracy","overallPosture","aiAnalyzed","traditionalScore","aiScore","analysisMethod","correctionMessages","generateCorrectionMessages","forEach","type","severity","rec","analysis","length","unshift","armJoints","legJoints","torsoJoints","calculatePartScore","joints","total","count","multiDirectionalPoseComparator"],"sources":["E:/BackupFit/frontend/src/utils/MultiDirectionalPoseComparator.js"],"sourcesContent":["export class MultiDirectionalPoseComparator {\r\n  constructor() {\r\n    this.MIN_VISIBILITY = 0.7;\r\n    this.IMPORTANT_JOINTS = [\r\n      'nose', 'left_shoulder', 'right_shoulder', 'left_elbow', 'right_elbow',\r\n      'left_wrist', 'right_wrist', 'left_hip', 'right_hip', 'left_knee', \r\n      'right_knee', 'left_ankle', 'right_ankle'\r\n    ];\r\n  }\r\n\r\n  // คำนวนระยะห่างระหว่าง 2 จุด\r\n  calculateDistance(point1, point2) {\r\n    const dx = point1.x - point2.x;\r\n    const dy = point1.y - point2.y;\r\n    return Math.sqrt(dx * dx + dy * dy);\r\n  }\r\n\r\n  // คำนวนมุมระหว่าง 3 จุด\r\n  calculateAngle(point1, point2, point3) {\r\n    const dx1 = point1.x - point2.x;\r\n    const dy1 = point1.y - point2.y;\r\n    const dx2 = point3.x - point2.x;\r\n    const dy2 = point3.y - point2.y;\r\n    \r\n    const angle1 = Math.atan2(dy1, dx1);\r\n    const angle2 = Math.atan2(dy2, dx2);\r\n    let angle = Math.abs(angle1 - angle2);\r\n    \r\n    if (angle > Math.PI) {\r\n      angle = 2 * Math.PI - angle;\r\n    }\r\n    \r\n    return angle * (180 / Math.PI); // แปลงเป็นองศา\r\n  }\r\n\r\n  // เปรียบเทียบท่าด้วย Gemini AI (แบบละเอียด)\r\n  async analyzeWithGemini(trainerKeypoints, traineeKeypoints) {\r\n    try {\r\n      // แปลง keypoints เป็นรูปแบบที่ AI เข้าใจง่าย\r\n      const trainerPositions = this.simplifyKeypoints(trainerKeypoints);\r\n      const traineePositions = this.simplifyKeypoints(traineeKeypoints);\r\n      \r\n      const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${process.env.REACT_APP_GEMINI_API_KEY}`, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        body: JSON.stringify({\r\n          contents: [{\r\n            parts: [{\r\n              text: `คุณเป็นผู้เชี่ยวชาญด้านการวิเคราะห์ท่าออกกำลังกายและ physiotherapy วิเคราะห์ความถูกต้องของท่าโดยเปรียบเทียบตำแหน่งของข้อต่อ\r\n\r\n**ข้อมูลท่าครู (Trainer):**\r\n- ไหล่ซ้าย: (${trainerPositions.leftShoulder.x.toFixed(3)}, ${trainerPositions.leftShoulder.y.toFixed(3)})\r\n- ไหล่ขวา: (${trainerPositions.rightShoulder.x.toFixed(3)}, ${trainerPositions.rightShoulder.y.toFixed(3)})\r\n- ข้อศอกซ้าย: (${trainerPositions.leftElbow.x.toFixed(3)}, ${trainerPositions.leftElbow.y.toFixed(3)})\r\n- ข้อศอกขวา: (${trainerPositions.rightElbow.x.toFixed(3)}, ${trainerPositions.rightElbow.y.toFixed(3)})\r\n- ข้อมือซ้าย: (${trainerPositions.leftWrist.x.toFixed(3)}, ${trainerPositions.leftWrist.y.toFixed(3)})\r\n- ข้อมือขวา: (${trainerPositions.rightWrist.x.toFixed(3)}, ${trainerPositions.rightWrist.y.toFixed(3)})\r\n- สะโพกซ้าย: (${trainerPositions.leftHip.x.toFixed(3)}, ${trainerPositions.leftHip.y.toFixed(3)})\r\n- สะโพกขวา: (${trainerPositions.rightHip.x.toFixed(3)}, ${trainerPositions.rightHip.y.toFixed(3)})\r\n- เข่าซ้าย: (${trainerPositions.leftKnee.x.toFixed(3)}, ${trainerPositions.leftKnee.y.toFixed(3)})\r\n- เข่าขวา: (${trainerPositions.rightKnee.x.toFixed(3)}, ${trainerPositions.rightKnee.y.toFixed(3)})\r\n- ข้อเท้าซ้าย: (${trainerPositions.leftAnkle.x.toFixed(3)}, ${trainerPositions.leftAnkle.y.toFixed(3)})\r\n- ข้อเท้าขวา: (${trainerPositions.rightAnkle.x.toFixed(3)}, ${trainerPositions.rightAnkle.y.toFixed(3)})\r\n\r\n**ข้อมูลท่าผู้เรียน (Trainee):**\r\n- ไหล่ซ้าย: (${traineePositions.leftShoulder.x.toFixed(3)}, ${traineePositions.leftShoulder.y.toFixed(3)})\r\n- ไหล่ขวา: (${traineePositions.rightShoulder.x.toFixed(3)}, ${traineePositions.rightShoulder.y.toFixed(3)})\r\n- ข้อศอกซ้าย: (${traineePositions.leftElbow.x.toFixed(3)}, ${traineePositions.leftElbow.y.toFixed(3)})\r\n- ข้อศอกขวา: (${traineePositions.rightElbow.x.toFixed(3)}, ${traineePositions.rightElbow.y.toFixed(3)})\r\n- ข้อมือซ้าย: (${traineePositions.leftWrist.x.toFixed(3)}, ${traineePositions.leftWrist.y.toFixed(3)})\r\n- ข้อมือขวา: (${traineePositions.rightWrist.x.toFixed(3)}, ${traineePositions.rightWrist.y.toFixed(3)})\r\n- สะโพกซ้าย: (${traineePositions.leftHip.x.toFixed(3)}, ${traineePositions.leftHip.y.toFixed(3)})\r\n- สะโพกขวา: (${traineePositions.rightHip.x.toFixed(3)}, ${traineePositions.rightHip.y.toFixed(3)})\r\n- เข่าซ้าย: (${traineePositions.leftKnee.x.toFixed(3)}, ${traineePositions.leftKnee.y.toFixed(3)})\r\n- เข่าขวา: (${traineePositions.rightKnee.x.toFixed(3)}, ${traineePositions.rightKnee.y.toFixed(3)})\r\n- ข้อเท้าซ้าย: (${traineePositions.leftAnkle.x.toFixed(3)}, ${traineePositions.leftAnkle.y.toFixed(3)})\r\n- ข้อเท้าขวา: (${traineePositions.rightAnkle.x.toFixed(3)}, ${traineePositions.rightAnkle.y.toFixed(3)})\r\n\r\n**หลักเกณฑ์การให้คะแนน:**\r\n1. เปรียบเทียบตำแหน่งข้อต่อแต่ละจุด (ระยะห่างไม่เกิน 0.1 = คะแนนเต็ม)\r\n2. วิเคราะห์การจัดตำแหน่งของลำตัว (ความตรงของกระดูกสันหลัง)\r\n3. ดูความสมดุลของแขนและขา\r\n4. ประเมินความสมเหตุสมผลของท่าโดยรวม\r\n5. คะแนน 0-30 = ท่าไม่ถูกต้อง, 31-60 = ปานกลาง, 61-80 = ดี, 81-100 = ยอดเยี่ยม\r\n\r\nให้วิเคราะห์และตอบเป็น JSON format เท่านั้น:\r\n{\r\n  \"accuracy\": 0-100,\r\n  \"detailedAnalysis\": {\r\n    \"armAccuracy\": 0-100,\r\n    \"legAccuracy\": 0-100,\r\n    \"torsoAccuracy\": 0-100,\r\n    \"overallPosture\": 0-100\r\n  },\r\n  \"feedback\": \"คำแนะนำภาษาไทยแบบเฉพาะเจาะจง\",\r\n  \"recommendations\": [\"คำแนะนำ1\", \"คำแนะนำ2\", \"คำแนะนำ3\"]\r\n}`\r\n            }]\r\n          }],\r\n          generationConfig: {\r\n            temperature: 0.1,\r\n            maxOutputTokens: 800\r\n          }\r\n        })\r\n      });\r\n\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        const content = data.candidates[0].content.parts[0].text;\r\n        \r\n        // ลองแยก JSON จากข้อความ\r\n        const jsonMatch = content.match(/\\{[\\s\\S]*\\}/);\r\n        if (jsonMatch) {\r\n          const aiResult = JSON.parse(jsonMatch[0]);\r\n          return aiResult;\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.log('Gemini API error:', error);\r\n    }\r\n    \r\n    return null;\r\n  }\r\n\r\n  // แปลง keypoints เป็นรูปแบบที่เข้าใจง่าย\r\n  simplifyKeypoints(keypoints) {\r\n    const getPoint = (jointName) => {\r\n      const point = keypoints[jointName];\r\n      return point && point.visibility > this.MIN_VISIBILITY ? \r\n        { x: point.x, y: point.y } : { x: 0, y: 0 };\r\n    };\r\n\r\n    return {\r\n      leftShoulder: getPoint('left_shoulder'),\r\n      rightShoulder: getPoint('right_shoulder'),\r\n      leftElbow: getPoint('left_elbow'),\r\n      rightElbow: getPoint('right_elbow'),\r\n      leftWrist: getPoint('left_wrist'),\r\n      rightWrist: getPoint('right_wrist'),\r\n      leftHip: getPoint('left_hip'),\r\n      rightHip: getPoint('right_hip'),\r\n      leftKnee: getPoint('left_knee'),\r\n      rightKnee: getPoint('right_knee'),\r\n      leftAnkle: getPoint('left_ankle'),\r\n      rightAnkle: getPoint('right_ankle')\r\n    };\r\n  }\r\n\r\n  // เปรียบเทียบท่าด้วย OpenAI (backup)\r\n  async analyzeWithOpenAI(trainerKeypoints, traineeKeypoints) {\r\n    try {\r\n      const response = await fetch('https://api.openai.com/v1/chat/completions', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Authorization': `Bearer ${process.env.REACT_APP_OPENAI_API_KEY}`\r\n        },\r\n        body: JSON.stringify({\r\n          model: \"gpt-3.5-turbo\",\r\n          messages: [{\r\n            role: \"system\",\r\n            content: \"คุณเป็นผู้เชี่ยวชาญด้านการวิเคราะห์ท่าออกกำลังกาย ให้คะแนนความถูกต้องของท่าโดยเปรียบเทียบ keypoints\"\r\n          }, {\r\n            role: \"user\",\r\n            content: `วิเคราะห์ท่าออกกำลังกาย:\r\n            Trainer keypoints: ${JSON.stringify(trainerKeypoints)}\r\n            Trainee keypoints: ${JSON.stringify(traineeKeypoints)}\r\n            \r\n            ให้คะแนนเป็น JSON format:\r\n            {\r\n              \"accuracy\": 0-100,\r\n              \"feedback\": \"คำแนะนำภาษาไทย\",\r\n              \"recommendations\": [\"คำแนะนำ1\", \"คำแนะนำ2\"]\r\n            }`\r\n          }],\r\n          max_tokens: 500,\r\n          temperature: 0.3\r\n        })\r\n      });\r\n\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        const aiResult = JSON.parse(data.choices[0].message.content);\r\n        return aiResult;\r\n      }\r\n    } catch (error) {\r\n      console.log('OpenAI API error:', error);\r\n    }\r\n    \r\n    return null;\r\n  }\r\n\r\n  // เรียกใช้ AI โดยลองใช้ Gemini ก่อน แล้วค่อย fallback เป็น OpenAI\r\n  async analyzeWithAI(trainerKeypoints, traineeKeypoints) {\r\n    // ลอง Gemini ก่อน (ฟรี)\r\n    if (process.env.REACT_APP_GEMINI_API_KEY && process.env.REACT_APP_GEMINI_API_KEY !== 'ใส่_GEMINI_API_KEY_ตรงนี้') {\r\n      const geminiResult = await this.analyzeWithGemini(trainerKeypoints, traineeKeypoints);\r\n      if (geminiResult) {\r\n        return { ...geminiResult, aiProvider: 'Gemini' };\r\n      }\r\n    }\r\n\r\n    // ถ้า Gemini ไม่ได้ ลอง OpenAI\r\n    if (process.env.REACT_APP_OPENAI_API_KEY && process.env.REACT_APP_OPENAI_API_KEY !== 'ใส่_OPENAI_API_KEY_ตรงนี้') {\r\n      const openaiResult = await this.analyzeWithOpenAI(trainerKeypoints, traineeKeypoints);\r\n      if (openaiResult) {\r\n        return { ...openaiResult, aiProvider: 'OpenAI' };\r\n      }\r\n    }\r\n\r\n    // ไม่มี AI ไหนทำงาน\r\n    return null;\r\n  }\r\n\r\n  // คำนวนความแม่นยำแบบดั้งเดิม\r\n  calculateTraditionalAccuracy(trainerKeypoints, traineeKeypoints) {\r\n    let totalScore = 0;\r\n    let validJoints = 0;\r\n    const jointComparisons = {};\r\n    const incorrectJoints = [];\r\n\r\n    for (const joint of this.IMPORTANT_JOINTS) {\r\n      const trainerJoint = trainerKeypoints[joint];\r\n      const traineeJoint = traineeKeypoints[joint];\r\n\r\n      if (trainerJoint && traineeJoint && \r\n          trainerJoint.visibility > this.MIN_VISIBILITY && \r\n          traineeJoint.visibility > this.MIN_VISIBILITY) {\r\n        \r\n        // คำนวนระยะห่างระหว่างจุด\r\n        const distance = this.calculateDistance(trainerJoint, traineeJoint);\r\n        \r\n        // แปลงเป็นคะแนน (ยิ่งใกล้ยิ่งคะแนนสูง)\r\n        const maxDistance = 0.3; // ระยะห่างสูงสุดที่ยอมรับได้\r\n        const jointScore = Math.max(0, 100 - (distance / maxDistance) * 100);\r\n        \r\n        totalScore += jointScore;\r\n        validJoints++;\r\n        \r\n        jointComparisons[joint] = {\r\n          distance: distance,\r\n          score: Math.round(jointScore),\r\n          trainerPosition: { x: trainerJoint.x, y: trainerJoint.y },\r\n          traineePosition: { x: traineeJoint.x, y: traineeJoint.y }\r\n        };\r\n\r\n        // เก็บข้อต่อที่ผิดพลาด (คะแนนต่ำกว่า 60)\r\n        if (jointScore < 60) {\r\n          incorrectJoints.push({\r\n            joint: joint,\r\n            score: Math.round(jointScore),\r\n            message: this.getJointCorrectionMessage(joint, trainerJoint, traineeJoint)\r\n          });\r\n        }\r\n      }\r\n    }\r\n\r\n    return {\r\n      accuracy: validJoints > 0 ? Math.round(totalScore / validJoints) : 0,\r\n      jointComparisons: jointComparisons,\r\n      validJoints: validJoints,\r\n      incorrectJoints: incorrectJoints\r\n    };\r\n  }\r\n\r\n  // ข้อความแนะนำการแก้ไขสำหรับแต่ละข้อต่อ (แบบ UI ที่ต้องการ)\r\n  getJointCorrectionMessage(joint, trainerPos, traineePos) {\r\n    // วิเคราะห์ตำแหน่งเพื่อให้คำแนะนำที่แม่นยำ\r\n    const dx = traineePos.x - trainerPos.x;\r\n    const dy = traineePos.y - trainerPos.y;\r\n    \r\n    const jointMessages = {\r\n      'left_shoulder': 'Left Shoulder: Keep shoulder level and aligned',\r\n      'right_shoulder': 'Right Shoulder: Keep shoulder level and aligned',\r\n      'left_elbow': 'Left Elbow: Maintain proper elbow angle',\r\n      'right_elbow': 'Right Elbow: Maintain proper elbow angle',\r\n      'left_wrist': 'Left Wrist: Keep wrist straight and controlled',\r\n      'right_wrist': 'Right Wrist: Keep wrist straight and controlled',\r\n      'left_hip': 'Left Hip: Keep hips square and stable',\r\n      'right_hip': 'Right Hip: Keep hips square and stable',\r\n      'left_knee': 'Left Knee: Keep knees aligned with toes',\r\n      'right_knee': 'Right Knee: Keep knees aligned with toes',\r\n      'left_ankle': 'Left Ankle: Maintain stable foot position',\r\n      'right_ankle': 'Right Ankle: Maintain stable foot position',\r\n      'nose': 'Head: Keep head in neutral position'\r\n    };\r\n\r\n    // เพิ่มคำแนะนำเฉพาะตามทิศทางที่ผิด\r\n    let baseMessage = jointMessages[joint] || `${joint}: Adjust position to match trainer`;\r\n    \r\n    // เพิ่มทิศทางเฉพาะถ้าต้องการ\r\n    if (Math.abs(dx) > 0.1 || Math.abs(dy) > 0.1) {\r\n      if (joint.includes('knee')) {\r\n        baseMessage = 'Left Knee: Keep knees aligned with toes';\r\n      } else if (joint.includes('back') || joint.includes('hip')) {\r\n        baseMessage = 'Back: Keep chest up and spine neutral';\r\n      }\r\n    }\r\n\r\n    return baseMessage;\r\n  }\r\n\r\n  async compareMultiDirectional(trainerPose, traineePose) {\r\n    if (!trainerPose || !traineePose) {\r\n      return { \r\n        accuracy: 0,\r\n        confidence: 0,\r\n        feedback: \"กรุณาเริ่มทำท่าตามคลิป\",\r\n        jointComparisons: {},\r\n        trainerDirection: \"unknown\",\r\n        traineeDirection: \"unknown\",\r\n        bodyPartScores: {},\r\n        recommendations: []\r\n      };\r\n    }\r\n\r\n    // คำนวนแบบดั้งเดิมก่อน\r\n    const traditionalResult = this.calculateTraditionalAccuracy(trainerPose, traineePose);\r\n    \r\n    // เรียก AI มาวิเคราะห์เพิ่มเติม\r\n    const aiResult = await this.analyzeWithAI(trainerPose, traineePose);\r\n    \r\n    // รวมผลลัพธ์ โดยให้น้ำหนัก AI มากกว่า\r\n    let finalAccuracy = traditionalResult.accuracy;\r\n    let feedback = \"ปรับปรุงท่าให้ตรงมากขึ้น\";\r\n    let recommendations = [\"ปรับท่าให้ตรงกับคลิปมากขึ้น\"];\r\n    let bodyPartScores = this.calculateBodyPartScores(traditionalResult.jointComparisons);\r\n\r\n    if (aiResult) {\r\n      // ให้น้ำหนัก AI 70% และ Traditional 30%\r\n      finalAccuracy = Math.round((aiResult.accuracy * 0.7) + (traditionalResult.accuracy * 0.3));\r\n      feedback = aiResult.feedback || feedback;\r\n      recommendations = aiResult.recommendations || recommendations;\r\n      \r\n      // ใช้คะแนนแยกส่วนจาก AI ถ้ามี\r\n      if (aiResult.detailedAnalysis) {\r\n        bodyPartScores = {\r\n          arms: aiResult.detailedAnalysis.armAccuracy || bodyPartScores.arms,\r\n          legs: aiResult.detailedAnalysis.legAccuracy || bodyPartScores.legs,\r\n          torso: aiResult.detailedAnalysis.torsoAccuracy || bodyPartScores.torso,\r\n          overallPosture: aiResult.detailedAnalysis.overallPosture || finalAccuracy\r\n        };\r\n      }\r\n    }\r\n\r\n    return { \r\n      accuracy: finalAccuracy,\r\n      confidence: aiResult ? 95 : (traditionalResult.validJoints > 8 ? 80 : 60),\r\n      feedback: feedback,\r\n      jointComparisons: traditionalResult.jointComparisons,\r\n      trainerDirection: \"front\",\r\n      traineeDirection: \"front\",\r\n      bodyPartScores: bodyPartScores,\r\n      recommendations: recommendations,\r\n      aiAnalyzed: !!aiResult,\r\n      aiProvider: aiResult?.aiProvider || null,\r\n      traditionalScore: traditionalResult.accuracy,\r\n      aiScore: aiResult?.accuracy || null,\r\n      analysisMethod: aiResult ? \"AI-Enhanced (70% AI + 30% Traditional)\" : \"Traditional Only\",\r\n      detailedAnalysis: aiResult?.detailedAnalysis || null,\r\n      incorrectJoints: traditionalResult.incorrectJoints || [],\r\n      correctionMessages: this.generateCorrectionMessages(traditionalResult.incorrectJoints || [], aiResult)\r\n    };\r\n  }\r\n\r\n  // สร้างข้อความแนะนำที่รวมข้อมูลจาก AI และการคำนวนแบบดั้งเดิม\r\n  generateCorrectionMessages(incorrectJoints, aiResult) {\r\n    const messages = [];\r\n\r\n    // ข้อความจากการคำนวนแบบดั้งเดิม\r\n    incorrectJoints.forEach(joint => {\r\n      messages.push({\r\n        type: 'joint',\r\n        severity: joint.score < 30 ? 'high' : joint.score < 60 ? 'medium' : 'low',\r\n        message: joint.message,\r\n        score: joint.score\r\n      });\r\n    });\r\n\r\n    // ข้อความเพิ่มเติมจาก AI\r\n    if (aiResult && aiResult.recommendations) {\r\n      aiResult.recommendations.forEach(rec => {\r\n        messages.push({\r\n          type: 'ai_recommendation',\r\n          severity: 'medium',\r\n          message: rec,\r\n          score: null\r\n        });\r\n      });\r\n    }\r\n\r\n    // เพิ่มข้อความเฉพาะตามคะแนนแยกส่วน (ตรงกับ UI)\r\n    if (aiResult && aiResult.detailedAnalysis) {\r\n      const analysis = aiResult.detailedAnalysis;\r\n      \r\n      if (analysis.armAccuracy < 60) {\r\n        messages.push({\r\n          type: 'body_part',\r\n          severity: analysis.armAccuracy < 40 ? 'high' : 'medium',\r\n          message: 'Arms: Keep arms in proper position and maintain control',\r\n          score: analysis.armAccuracy\r\n        });\r\n      }\r\n      \r\n      if (analysis.legAccuracy < 60) {\r\n        messages.push({\r\n          type: 'body_part',\r\n          severity: analysis.legAccuracy < 40 ? 'high' : 'medium',\r\n          message: 'Legs: Keep knees aligned and maintain stable stance',\r\n          score: analysis.legAccuracy\r\n        });\r\n      }\r\n      \r\n      if (analysis.torsoAccuracy < 60) {\r\n        messages.push({\r\n          type: 'body_part',\r\n          severity: analysis.torsoAccuracy < 40 ? 'high' : 'medium',\r\n          message: 'Back: Keep chest up and spine neutral',\r\n          score: analysis.torsoAccuracy\r\n        });\r\n      }\r\n    }\r\n\r\n    // เพิ่มข้อความเฉพาะสำหรับท่าที่ผิดมาก\r\n    if (incorrectJoints.length > 3) {\r\n      messages.unshift({\r\n        type: 'general',\r\n        severity: 'high',\r\n        message: 'Posture: Focus on overall body alignment',\r\n        score: null\r\n      });\r\n    }\r\n\r\n    return messages;\r\n  }\r\n\r\n  calculateBodyPartScores(jointComparisons) {\r\n    const armJoints = ['left_shoulder', 'right_shoulder', 'left_elbow', 'right_elbow', 'left_wrist', 'right_wrist'];\r\n    const legJoints = ['left_hip', 'right_hip', 'left_knee', 'right_knee', 'left_ankle', 'right_ankle'];\r\n    const torsoJoints = ['nose', 'left_shoulder', 'right_shoulder', 'left_hip', 'right_hip'];\r\n\r\n    const calculatePartScore = (joints) => {\r\n      let total = 0;\r\n      let count = 0;\r\n      joints.forEach(joint => {\r\n        if (jointComparisons[joint]) {\r\n          total += jointComparisons[joint].score;\r\n          count++;\r\n        }\r\n      });\r\n      return count > 0 ? Math.round(total / count) : 0;\r\n    };\r\n\r\n    return {\r\n      arms: calculatePartScore(armJoints),\r\n      legs: calculatePartScore(legJoints),\r\n      torso: calculatePartScore(torsoJoints)\r\n    };\r\n  }\r\n}\r\n\r\n// Export instance สำหรับ import ที่มีอยู่\r\nexport const multiDirectionalPoseComparator = new MultiDirectionalPoseComparator();"],"mappings":"AAAA,OAAO,MAAMA,8BAA8B,CAAC;EAC1CC,WAAWA,CAAA,EAAG;IACZ,IAAI,CAACC,cAAc,GAAG,GAAG;IACzB,IAAI,CAACC,gBAAgB,GAAG,CACtB,MAAM,EAAE,eAAe,EAAE,gBAAgB,EAAE,YAAY,EAAE,aAAa,EACtE,YAAY,EAAE,aAAa,EAAE,UAAU,EAAE,WAAW,EAAE,WAAW,EACjE,YAAY,EAAE,YAAY,EAAE,aAAa,CAC1C;EACH;;EAEA;EACAC,iBAAiBA,CAACC,MAAM,EAAEC,MAAM,EAAE;IAChC,MAAMC,EAAE,GAAGF,MAAM,CAACG,CAAC,GAAGF,MAAM,CAACE,CAAC;IAC9B,MAAMC,EAAE,GAAGJ,MAAM,CAACK,CAAC,GAAGJ,MAAM,CAACI,CAAC;IAC9B,OAAOC,IAAI,CAACC,IAAI,CAACL,EAAE,GAAGA,EAAE,GAAGE,EAAE,GAAGA,EAAE,CAAC;EACrC;;EAEA;EACAI,cAAcA,CAACR,MAAM,EAAEC,MAAM,EAAEQ,MAAM,EAAE;IACrC,MAAMC,GAAG,GAAGV,MAAM,CAACG,CAAC,GAAGF,MAAM,CAACE,CAAC;IAC/B,MAAMQ,GAAG,GAAGX,MAAM,CAACK,CAAC,GAAGJ,MAAM,CAACI,CAAC;IAC/B,MAAMO,GAAG,GAAGH,MAAM,CAACN,CAAC,GAAGF,MAAM,CAACE,CAAC;IAC/B,MAAMU,GAAG,GAAGJ,MAAM,CAACJ,CAAC,GAAGJ,MAAM,CAACI,CAAC;IAE/B,MAAMS,MAAM,GAAGR,IAAI,CAACS,KAAK,CAACJ,GAAG,EAAED,GAAG,CAAC;IACnC,MAAMM,MAAM,GAAGV,IAAI,CAACS,KAAK,CAACF,GAAG,EAAED,GAAG,CAAC;IACnC,IAAIK,KAAK,GAAGX,IAAI,CAACY,GAAG,CAACJ,MAAM,GAAGE,MAAM,CAAC;IAErC,IAAIC,KAAK,GAAGX,IAAI,CAACa,EAAE,EAAE;MACnBF,KAAK,GAAG,CAAC,GAAGX,IAAI,CAACa,EAAE,GAAGF,KAAK;IAC7B;IAEA,OAAOA,KAAK,IAAI,GAAG,GAAGX,IAAI,CAACa,EAAE,CAAC,CAAC,CAAC;EAClC;;EAEA;EACA,MAAMC,iBAAiBA,CAACC,gBAAgB,EAAEC,gBAAgB,EAAE;IAC1D,IAAI;MACF;MACA,MAAMC,gBAAgB,GAAG,IAAI,CAACC,iBAAiB,CAACH,gBAAgB,CAAC;MACjE,MAAMI,gBAAgB,GAAG,IAAI,CAACD,iBAAiB,CAACF,gBAAgB,CAAC;MAEjE,MAAMI,QAAQ,GAAG,MAAMC,KAAK,CAAC,0FAA0FC,OAAO,CAACC,GAAG,CAACC,wBAAwB,EAAE,EAAE;QAC7JC,MAAM,EAAE,MAAM;QACdC,OAAO,EAAE;UACP,cAAc,EAAE;QAClB,CAAC;QACDC,IAAI,EAAEC,IAAI,CAACC,SAAS,CAAC;UACnBC,QAAQ,EAAE,CAAC;YACTC,KAAK,EAAE,CAAC;cACNC,IAAI,EAAE;AACpB;AACA;AACA,eAAef,gBAAgB,CAACgB,YAAY,CAACpC,CAAC,CAACqC,OAAO,CAAC,CAAC,CAAC,KAAKjB,gBAAgB,CAACgB,YAAY,CAAClC,CAAC,CAACmC,OAAO,CAAC,CAAC,CAAC;AACxG,cAAcjB,gBAAgB,CAACkB,aAAa,CAACtC,CAAC,CAACqC,OAAO,CAAC,CAAC,CAAC,KAAKjB,gBAAgB,CAACkB,aAAa,CAACpC,CAAC,CAACmC,OAAO,CAAC,CAAC,CAAC;AACzG,iBAAiBjB,gBAAgB,CAACmB,SAAS,CAACvC,CAAC,CAACqC,OAAO,CAAC,CAAC,CAAC,KAAKjB,gBAAgB,CAACmB,SAAS,CAACrC,CAAC,CAACmC,OAAO,CAAC,CAAC,CAAC;AACpG,gBAAgBjB,gBAAgB,CAACoB,UAAU,CAACxC,CAAC,CAACqC,OAAO,CAAC,CAAC,CAAC,KAAKjB,gBAAgB,CAACoB,UAAU,CAACtC,CAAC,CAACmC,OAAO,CAAC,CAAC,CAAC;AACrG,iBAAiBjB,gBAAgB,CAACqB,SAAS,CAACzC,CAAC,CAACqC,OAAO,CAAC,CAAC,CAAC,KAAKjB,gBAAgB,CAACqB,SAAS,CAACvC,CAAC,CAACmC,OAAO,CAAC,CAAC,CAAC;AACpG,gBAAgBjB,gBAAgB,CAACsB,UAAU,CAAC1C,CAAC,CAACqC,OAAO,CAAC,CAAC,CAAC,KAAKjB,gBAAgB,CAACsB,UAAU,CAACxC,CAAC,CAACmC,OAAO,CAAC,CAAC,CAAC;AACrG,gBAAgBjB,gBAAgB,CAACuB,OAAO,CAAC3C,CAAC,CAACqC,OAAO,CAAC,CAAC,CAAC,KAAKjB,gBAAgB,CAACuB,OAAO,CAACzC,CAAC,CAACmC,OAAO,CAAC,CAAC,CAAC;AAC/F,eAAejB,gBAAgB,CAACwB,QAAQ,CAAC5C,CAAC,CAACqC,OAAO,CAAC,CAAC,CAAC,KAAKjB,gBAAgB,CAACwB,QAAQ,CAAC1C,CAAC,CAACmC,OAAO,CAAC,CAAC,CAAC;AAChG,eAAejB,gBAAgB,CAACyB,QAAQ,CAAC7C,CAAC,CAACqC,OAAO,CAAC,CAAC,CAAC,KAAKjB,gBAAgB,CAACyB,QAAQ,CAAC3C,CAAC,CAACmC,OAAO,CAAC,CAAC,CAAC;AAChG,cAAcjB,gBAAgB,CAAC0B,SAAS,CAAC9C,CAAC,CAACqC,OAAO,CAAC,CAAC,CAAC,KAAKjB,gBAAgB,CAAC0B,SAAS,CAAC5C,CAAC,CAACmC,OAAO,CAAC,CAAC,CAAC;AACjG,kBAAkBjB,gBAAgB,CAAC2B,SAAS,CAAC/C,CAAC,CAACqC,OAAO,CAAC,CAAC,CAAC,KAAKjB,gBAAgB,CAAC2B,SAAS,CAAC7C,CAAC,CAACmC,OAAO,CAAC,CAAC,CAAC;AACrG,iBAAiBjB,gBAAgB,CAAC4B,UAAU,CAAChD,CAAC,CAACqC,OAAO,CAAC,CAAC,CAAC,KAAKjB,gBAAgB,CAAC4B,UAAU,CAAC9C,CAAC,CAACmC,OAAO,CAAC,CAAC,CAAC;AACtG;AACA;AACA,eAAef,gBAAgB,CAACc,YAAY,CAACpC,CAAC,CAACqC,OAAO,CAAC,CAAC,CAAC,KAAKf,gBAAgB,CAACc,YAAY,CAAClC,CAAC,CAACmC,OAAO,CAAC,CAAC,CAAC;AACxG,cAAcf,gBAAgB,CAACgB,aAAa,CAACtC,CAAC,CAACqC,OAAO,CAAC,CAAC,CAAC,KAAKf,gBAAgB,CAACgB,aAAa,CAACpC,CAAC,CAACmC,OAAO,CAAC,CAAC,CAAC;AACzG,iBAAiBf,gBAAgB,CAACiB,SAAS,CAACvC,CAAC,CAACqC,OAAO,CAAC,CAAC,CAAC,KAAKf,gBAAgB,CAACiB,SAAS,CAACrC,CAAC,CAACmC,OAAO,CAAC,CAAC,CAAC;AACpG,gBAAgBf,gBAAgB,CAACkB,UAAU,CAACxC,CAAC,CAACqC,OAAO,CAAC,CAAC,CAAC,KAAKf,gBAAgB,CAACkB,UAAU,CAACtC,CAAC,CAACmC,OAAO,CAAC,CAAC,CAAC;AACrG,iBAAiBf,gBAAgB,CAACmB,SAAS,CAACzC,CAAC,CAACqC,OAAO,CAAC,CAAC,CAAC,KAAKf,gBAAgB,CAACmB,SAAS,CAACvC,CAAC,CAACmC,OAAO,CAAC,CAAC,CAAC;AACpG,gBAAgBf,gBAAgB,CAACoB,UAAU,CAAC1C,CAAC,CAACqC,OAAO,CAAC,CAAC,CAAC,KAAKf,gBAAgB,CAACoB,UAAU,CAACxC,CAAC,CAACmC,OAAO,CAAC,CAAC,CAAC;AACrG,gBAAgBf,gBAAgB,CAACqB,OAAO,CAAC3C,CAAC,CAACqC,OAAO,CAAC,CAAC,CAAC,KAAKf,gBAAgB,CAACqB,OAAO,CAACzC,CAAC,CAACmC,OAAO,CAAC,CAAC,CAAC;AAC/F,eAAef,gBAAgB,CAACsB,QAAQ,CAAC5C,CAAC,CAACqC,OAAO,CAAC,CAAC,CAAC,KAAKf,gBAAgB,CAACsB,QAAQ,CAAC1C,CAAC,CAACmC,OAAO,CAAC,CAAC,CAAC;AAChG,eAAef,gBAAgB,CAACuB,QAAQ,CAAC7C,CAAC,CAACqC,OAAO,CAAC,CAAC,CAAC,KAAKf,gBAAgB,CAACuB,QAAQ,CAAC3C,CAAC,CAACmC,OAAO,CAAC,CAAC,CAAC;AAChG,cAAcf,gBAAgB,CAACwB,SAAS,CAAC9C,CAAC,CAACqC,OAAO,CAAC,CAAC,CAAC,KAAKf,gBAAgB,CAACwB,SAAS,CAAC5C,CAAC,CAACmC,OAAO,CAAC,CAAC,CAAC;AACjG,kBAAkBf,gBAAgB,CAACyB,SAAS,CAAC/C,CAAC,CAACqC,OAAO,CAAC,CAAC,CAAC,KAAKf,gBAAgB,CAACyB,SAAS,CAAC7C,CAAC,CAACmC,OAAO,CAAC,CAAC,CAAC;AACrG,iBAAiBf,gBAAgB,CAAC0B,UAAU,CAAChD,CAAC,CAACqC,OAAO,CAAC,CAAC,CAAC,KAAKf,gBAAgB,CAAC0B,UAAU,CAAC9C,CAAC,CAACmC,OAAO,CAAC,CAAC,CAAC;AACtG;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;YACY,CAAC;UACH,CAAC,CAAC;UACFY,gBAAgB,EAAE;YAChBC,WAAW,EAAE,GAAG;YAChBC,eAAe,EAAE;UACnB;QACF,CAAC;MACH,CAAC,CAAC;MAEF,IAAI5B,QAAQ,CAAC6B,EAAE,EAAE;QACf,MAAMC,IAAI,GAAG,MAAM9B,QAAQ,CAAC+B,IAAI,CAAC,CAAC;QAClC,MAAMC,OAAO,GAAGF,IAAI,CAACG,UAAU,CAAC,CAAC,CAAC,CAACD,OAAO,CAACrB,KAAK,CAAC,CAAC,CAAC,CAACC,IAAI;;QAExD;QACA,MAAMsB,SAAS,GAAGF,OAAO,CAACG,KAAK,CAAC,aAAa,CAAC;QAC9C,IAAID,SAAS,EAAE;UACb,MAAME,QAAQ,GAAG5B,IAAI,CAAC6B,KAAK,CAACH,SAAS,CAAC,CAAC,CAAC,CAAC;UACzC,OAAOE,QAAQ;QACjB;MACF;IACF,CAAC,CAAC,OAAOE,KAAK,EAAE;MACdC,OAAO,CAACC,GAAG,CAAC,mBAAmB,EAAEF,KAAK,CAAC;IACzC;IAEA,OAAO,IAAI;EACb;;EAEA;EACAxC,iBAAiBA,CAAC2C,SAAS,EAAE;IAC3B,MAAMC,QAAQ,GAAIC,SAAS,IAAK;MAC9B,MAAMC,KAAK,GAAGH,SAAS,CAACE,SAAS,CAAC;MAClC,OAAOC,KAAK,IAAIA,KAAK,CAACC,UAAU,GAAG,IAAI,CAAC1E,cAAc,GACpD;QAAEM,CAAC,EAAEmE,KAAK,CAACnE,CAAC;QAAEE,CAAC,EAAEiE,KAAK,CAACjE;MAAE,CAAC,GAAG;QAAEF,CAAC,EAAE,CAAC;QAAEE,CAAC,EAAE;MAAE,CAAC;IAC/C,CAAC;IAED,OAAO;MACLkC,YAAY,EAAE6B,QAAQ,CAAC,eAAe,CAAC;MACvC3B,aAAa,EAAE2B,QAAQ,CAAC,gBAAgB,CAAC;MACzC1B,SAAS,EAAE0B,QAAQ,CAAC,YAAY,CAAC;MACjCzB,UAAU,EAAEyB,QAAQ,CAAC,aAAa,CAAC;MACnCxB,SAAS,EAAEwB,QAAQ,CAAC,YAAY,CAAC;MACjCvB,UAAU,EAAEuB,QAAQ,CAAC,aAAa,CAAC;MACnCtB,OAAO,EAAEsB,QAAQ,CAAC,UAAU,CAAC;MAC7BrB,QAAQ,EAAEqB,QAAQ,CAAC,WAAW,CAAC;MAC/BpB,QAAQ,EAAEoB,QAAQ,CAAC,WAAW,CAAC;MAC/BnB,SAAS,EAAEmB,QAAQ,CAAC,YAAY,CAAC;MACjClB,SAAS,EAAEkB,QAAQ,CAAC,YAAY,CAAC;MACjCjB,UAAU,EAAEiB,QAAQ,CAAC,aAAa;IACpC,CAAC;EACH;;EAEA;EACA,MAAMI,iBAAiBA,CAACnD,gBAAgB,EAAEC,gBAAgB,EAAE;IAC1D,IAAI;MACF,MAAMI,QAAQ,GAAG,MAAMC,KAAK,CAAC,4CAA4C,EAAE;QACzEI,MAAM,EAAE,MAAM;QACdC,OAAO,EAAE;UACP,cAAc,EAAE,kBAAkB;UAClC,eAAe,EAAE,UAAUJ,OAAO,CAACC,GAAG,CAAC4C,wBAAwB;QACjE,CAAC;QACDxC,IAAI,EAAEC,IAAI,CAACC,SAAS,CAAC;UACnBuC,KAAK,EAAE,eAAe;UACtBC,QAAQ,EAAE,CAAC;YACTC,IAAI,EAAE,QAAQ;YACdlB,OAAO,EAAE;UACX,CAAC,EAAE;YACDkB,IAAI,EAAE,MAAM;YACZlB,OAAO,EAAE;AACrB,iCAAiCxB,IAAI,CAACC,SAAS,CAACd,gBAAgB,CAAC;AACjE,iCAAiCa,IAAI,CAACC,SAAS,CAACb,gBAAgB,CAAC;AACjE;AACA;AACA;AACA;AACA;AACA;AACA;UACU,CAAC,CAAC;UACFuD,UAAU,EAAE,GAAG;UACfxB,WAAW,EAAE;QACf,CAAC;MACH,CAAC,CAAC;MAEF,IAAI3B,QAAQ,CAAC6B,EAAE,EAAE;QACf,MAAMC,IAAI,GAAG,MAAM9B,QAAQ,CAAC+B,IAAI,CAAC,CAAC;QAClC,MAAMK,QAAQ,GAAG5B,IAAI,CAAC6B,KAAK,CAACP,IAAI,CAACsB,OAAO,CAAC,CAAC,CAAC,CAACC,OAAO,CAACrB,OAAO,CAAC;QAC5D,OAAOI,QAAQ;MACjB;IACF,CAAC,CAAC,OAAOE,KAAK,EAAE;MACdC,OAAO,CAACC,GAAG,CAAC,mBAAmB,EAAEF,KAAK,CAAC;IACzC;IAEA,OAAO,IAAI;EACb;;EAEA;EACA,MAAMgB,aAAaA,CAAC3D,gBAAgB,EAAEC,gBAAgB,EAAE;IACtD;IACA,IAAIM,OAAO,CAACC,GAAG,CAACC,wBAAwB,IAAIF,OAAO,CAACC,GAAG,CAACC,wBAAwB,KAAK,2BAA2B,EAAE;MAChH,MAAMmD,YAAY,GAAG,MAAM,IAAI,CAAC7D,iBAAiB,CAACC,gBAAgB,EAAEC,gBAAgB,CAAC;MACrF,IAAI2D,YAAY,EAAE;QAChB,OAAO;UAAE,GAAGA,YAAY;UAAEC,UAAU,EAAE;QAAS,CAAC;MAClD;IACF;;IAEA;IACA,IAAItD,OAAO,CAACC,GAAG,CAAC4C,wBAAwB,IAAI7C,OAAO,CAACC,GAAG,CAAC4C,wBAAwB,KAAK,2BAA2B,EAAE;MAChH,MAAMU,YAAY,GAAG,MAAM,IAAI,CAACX,iBAAiB,CAACnD,gBAAgB,EAAEC,gBAAgB,CAAC;MACrF,IAAI6D,YAAY,EAAE;QAChB,OAAO;UAAE,GAAGA,YAAY;UAAED,UAAU,EAAE;QAAS,CAAC;MAClD;IACF;;IAEA;IACA,OAAO,IAAI;EACb;;EAEA;EACAE,4BAA4BA,CAAC/D,gBAAgB,EAAEC,gBAAgB,EAAE;IAC/D,IAAI+D,UAAU,GAAG,CAAC;IAClB,IAAIC,WAAW,GAAG,CAAC;IACnB,MAAMC,gBAAgB,GAAG,CAAC,CAAC;IAC3B,MAAMC,eAAe,GAAG,EAAE;IAE1B,KAAK,MAAMC,KAAK,IAAI,IAAI,CAAC3F,gBAAgB,EAAE;MACzC,MAAM4F,YAAY,GAAGrE,gBAAgB,CAACoE,KAAK,CAAC;MAC5C,MAAME,YAAY,GAAGrE,gBAAgB,CAACmE,KAAK,CAAC;MAE5C,IAAIC,YAAY,IAAIC,YAAY,IAC5BD,YAAY,CAACnB,UAAU,GAAG,IAAI,CAAC1E,cAAc,IAC7C8F,YAAY,CAACpB,UAAU,GAAG,IAAI,CAAC1E,cAAc,EAAE;QAEjD;QACA,MAAM+F,QAAQ,GAAG,IAAI,CAAC7F,iBAAiB,CAAC2F,YAAY,EAAEC,YAAY,CAAC;;QAEnE;QACA,MAAME,WAAW,GAAG,GAAG,CAAC,CAAC;QACzB,MAAMC,UAAU,GAAGxF,IAAI,CAACyF,GAAG,CAAC,CAAC,EAAE,GAAG,GAAIH,QAAQ,GAAGC,WAAW,GAAI,GAAG,CAAC;QAEpER,UAAU,IAAIS,UAAU;QACxBR,WAAW,EAAE;QAEbC,gBAAgB,CAACE,KAAK,CAAC,GAAG;UACxBG,QAAQ,EAAEA,QAAQ;UAClBI,KAAK,EAAE1F,IAAI,CAAC2F,KAAK,CAACH,UAAU,CAAC;UAC7BI,eAAe,EAAE;YAAE/F,CAAC,EAAEuF,YAAY,CAACvF,CAAC;YAAEE,CAAC,EAAEqF,YAAY,CAACrF;UAAE,CAAC;UACzD8F,eAAe,EAAE;YAAEhG,CAAC,EAAEwF,YAAY,CAACxF,CAAC;YAAEE,CAAC,EAAEsF,YAAY,CAACtF;UAAE;QAC1D,CAAC;;QAED;QACA,IAAIyF,UAAU,GAAG,EAAE,EAAE;UACnBN,eAAe,CAACY,IAAI,CAAC;YACnBX,KAAK,EAAEA,KAAK;YACZO,KAAK,EAAE1F,IAAI,CAAC2F,KAAK,CAACH,UAAU,CAAC;YAC7Bf,OAAO,EAAE,IAAI,CAACsB,yBAAyB,CAACZ,KAAK,EAAEC,YAAY,EAAEC,YAAY;UAC3E,CAAC,CAAC;QACJ;MACF;IACF;IAEA,OAAO;MACLW,QAAQ,EAAEhB,WAAW,GAAG,CAAC,GAAGhF,IAAI,CAAC2F,KAAK,CAACZ,UAAU,GAAGC,WAAW,CAAC,GAAG,CAAC;MACpEC,gBAAgB,EAAEA,gBAAgB;MAClCD,WAAW,EAAEA,WAAW;MACxBE,eAAe,EAAEA;IACnB,CAAC;EACH;;EAEA;EACAa,yBAAyBA,CAACZ,KAAK,EAAEc,UAAU,EAAEC,UAAU,EAAE;IACvD;IACA,MAAMtG,EAAE,GAAGsG,UAAU,CAACrG,CAAC,GAAGoG,UAAU,CAACpG,CAAC;IACtC,MAAMC,EAAE,GAAGoG,UAAU,CAACnG,CAAC,GAAGkG,UAAU,CAAClG,CAAC;IAEtC,MAAMoG,aAAa,GAAG;MACpB,eAAe,EAAE,gDAAgD;MACjE,gBAAgB,EAAE,iDAAiD;MACnE,YAAY,EAAE,yCAAyC;MACvD,aAAa,EAAE,0CAA0C;MACzD,YAAY,EAAE,gDAAgD;MAC9D,aAAa,EAAE,iDAAiD;MAChE,UAAU,EAAE,uCAAuC;MACnD,WAAW,EAAE,wCAAwC;MACrD,WAAW,EAAE,yCAAyC;MACtD,YAAY,EAAE,0CAA0C;MACxD,YAAY,EAAE,2CAA2C;MACzD,aAAa,EAAE,4CAA4C;MAC3D,MAAM,EAAE;IACV,CAAC;;IAED;IACA,IAAIC,WAAW,GAAGD,aAAa,CAAChB,KAAK,CAAC,IAAI,GAAGA,KAAK,oCAAoC;;IAEtF;IACA,IAAInF,IAAI,CAACY,GAAG,CAAChB,EAAE,CAAC,GAAG,GAAG,IAAII,IAAI,CAACY,GAAG,CAACd,EAAE,CAAC,GAAG,GAAG,EAAE;MAC5C,IAAIqF,KAAK,CAACkB,QAAQ,CAAC,MAAM,CAAC,EAAE;QAC1BD,WAAW,GAAG,yCAAyC;MACzD,CAAC,MAAM,IAAIjB,KAAK,CAACkB,QAAQ,CAAC,MAAM,CAAC,IAAIlB,KAAK,CAACkB,QAAQ,CAAC,KAAK,CAAC,EAAE;QAC1DD,WAAW,GAAG,uCAAuC;MACvD;IACF;IAEA,OAAOA,WAAW;EACpB;EAEA,MAAME,uBAAuBA,CAACC,WAAW,EAAEC,WAAW,EAAE;IACtD,IAAI,CAACD,WAAW,IAAI,CAACC,WAAW,EAAE;MAChC,OAAO;QACLR,QAAQ,EAAE,CAAC;QACXS,UAAU,EAAE,CAAC;QACbC,QAAQ,EAAE,wBAAwB;QAClCzB,gBAAgB,EAAE,CAAC,CAAC;QACpB0B,gBAAgB,EAAE,SAAS;QAC3BC,gBAAgB,EAAE,SAAS;QAC3BC,cAAc,EAAE,CAAC,CAAC;QAClBC,eAAe,EAAE;MACnB,CAAC;IACH;;IAEA;IACA,MAAMC,iBAAiB,GAAG,IAAI,CAACjC,4BAA4B,CAACyB,WAAW,EAAEC,WAAW,CAAC;;IAErF;IACA,MAAMhD,QAAQ,GAAG,MAAM,IAAI,CAACkB,aAAa,CAAC6B,WAAW,EAAEC,WAAW,CAAC;;IAEnE;IACA,IAAIQ,aAAa,GAAGD,iBAAiB,CAACf,QAAQ;IAC9C,IAAIU,QAAQ,GAAG,0BAA0B;IACzC,IAAII,eAAe,GAAG,CAAC,6BAA6B,CAAC;IACrD,IAAID,cAAc,GAAG,IAAI,CAACI,uBAAuB,CAACF,iBAAiB,CAAC9B,gBAAgB,CAAC;IAErF,IAAIzB,QAAQ,EAAE;MACZ;MACAwD,aAAa,GAAGhH,IAAI,CAAC2F,KAAK,CAAEnC,QAAQ,CAACwC,QAAQ,GAAG,GAAG,GAAKe,iBAAiB,CAACf,QAAQ,GAAG,GAAI,CAAC;MAC1FU,QAAQ,GAAGlD,QAAQ,CAACkD,QAAQ,IAAIA,QAAQ;MACxCI,eAAe,GAAGtD,QAAQ,CAACsD,eAAe,IAAIA,eAAe;;MAE7D;MACA,IAAItD,QAAQ,CAAC0D,gBAAgB,EAAE;QAC7BL,cAAc,GAAG;UACfM,IAAI,EAAE3D,QAAQ,CAAC0D,gBAAgB,CAACE,WAAW,IAAIP,cAAc,CAACM,IAAI;UAClEE,IAAI,EAAE7D,QAAQ,CAAC0D,gBAAgB,CAACI,WAAW,IAAIT,cAAc,CAACQ,IAAI;UAClEE,KAAK,EAAE/D,QAAQ,CAAC0D,gBAAgB,CAACM,aAAa,IAAIX,cAAc,CAACU,KAAK;UACtEE,cAAc,EAAEjE,QAAQ,CAAC0D,gBAAgB,CAACO,cAAc,IAAIT;QAC9D,CAAC;MACH;IACF;IAEA,OAAO;MACLhB,QAAQ,EAAEgB,aAAa;MACvBP,UAAU,EAAEjD,QAAQ,GAAG,EAAE,GAAIuD,iBAAiB,CAAC/B,WAAW,GAAG,CAAC,GAAG,EAAE,GAAG,EAAG;MACzE0B,QAAQ,EAAEA,QAAQ;MAClBzB,gBAAgB,EAAE8B,iBAAiB,CAAC9B,gBAAgB;MACpD0B,gBAAgB,EAAE,OAAO;MACzBC,gBAAgB,EAAE,OAAO;MACzBC,cAAc,EAAEA,cAAc;MAC9BC,eAAe,EAAEA,eAAe;MAChCY,UAAU,EAAE,CAAC,CAAClE,QAAQ;MACtBoB,UAAU,EAAE,CAAApB,QAAQ,aAARA,QAAQ,uBAARA,QAAQ,CAAEoB,UAAU,KAAI,IAAI;MACxC+C,gBAAgB,EAAEZ,iBAAiB,CAACf,QAAQ;MAC5C4B,OAAO,EAAE,CAAApE,QAAQ,aAARA,QAAQ,uBAARA,QAAQ,CAAEwC,QAAQ,KAAI,IAAI;MACnC6B,cAAc,EAAErE,QAAQ,GAAG,wCAAwC,GAAG,kBAAkB;MACxF0D,gBAAgB,EAAE,CAAA1D,QAAQ,aAARA,QAAQ,uBAARA,QAAQ,CAAE0D,gBAAgB,KAAI,IAAI;MACpDhC,eAAe,EAAE6B,iBAAiB,CAAC7B,eAAe,IAAI,EAAE;MACxD4C,kBAAkB,EAAE,IAAI,CAACC,0BAA0B,CAAChB,iBAAiB,CAAC7B,eAAe,IAAI,EAAE,EAAE1B,QAAQ;IACvG,CAAC;EACH;;EAEA;EACAuE,0BAA0BA,CAAC7C,eAAe,EAAE1B,QAAQ,EAAE;IACpD,MAAMa,QAAQ,GAAG,EAAE;;IAEnB;IACAa,eAAe,CAAC8C,OAAO,CAAC7C,KAAK,IAAI;MAC/Bd,QAAQ,CAACyB,IAAI,CAAC;QACZmC,IAAI,EAAE,OAAO;QACbC,QAAQ,EAAE/C,KAAK,CAACO,KAAK,GAAG,EAAE,GAAG,MAAM,GAAGP,KAAK,CAACO,KAAK,GAAG,EAAE,GAAG,QAAQ,GAAG,KAAK;QACzEjB,OAAO,EAAEU,KAAK,CAACV,OAAO;QACtBiB,KAAK,EAAEP,KAAK,CAACO;MACf,CAAC,CAAC;IACJ,CAAC,CAAC;;IAEF;IACA,IAAIlC,QAAQ,IAAIA,QAAQ,CAACsD,eAAe,EAAE;MACxCtD,QAAQ,CAACsD,eAAe,CAACkB,OAAO,CAACG,GAAG,IAAI;QACtC9D,QAAQ,CAACyB,IAAI,CAAC;UACZmC,IAAI,EAAE,mBAAmB;UACzBC,QAAQ,EAAE,QAAQ;UAClBzD,OAAO,EAAE0D,GAAG;UACZzC,KAAK,EAAE;QACT,CAAC,CAAC;MACJ,CAAC,CAAC;IACJ;;IAEA;IACA,IAAIlC,QAAQ,IAAIA,QAAQ,CAAC0D,gBAAgB,EAAE;MACzC,MAAMkB,QAAQ,GAAG5E,QAAQ,CAAC0D,gBAAgB;MAE1C,IAAIkB,QAAQ,CAAChB,WAAW,GAAG,EAAE,EAAE;QAC7B/C,QAAQ,CAACyB,IAAI,CAAC;UACZmC,IAAI,EAAE,WAAW;UACjBC,QAAQ,EAAEE,QAAQ,CAAChB,WAAW,GAAG,EAAE,GAAG,MAAM,GAAG,QAAQ;UACvD3C,OAAO,EAAE,yDAAyD;UAClEiB,KAAK,EAAE0C,QAAQ,CAAChB;QAClB,CAAC,CAAC;MACJ;MAEA,IAAIgB,QAAQ,CAACd,WAAW,GAAG,EAAE,EAAE;QAC7BjD,QAAQ,CAACyB,IAAI,CAAC;UACZmC,IAAI,EAAE,WAAW;UACjBC,QAAQ,EAAEE,QAAQ,CAACd,WAAW,GAAG,EAAE,GAAG,MAAM,GAAG,QAAQ;UACvD7C,OAAO,EAAE,qDAAqD;UAC9DiB,KAAK,EAAE0C,QAAQ,CAACd;QAClB,CAAC,CAAC;MACJ;MAEA,IAAIc,QAAQ,CAACZ,aAAa,GAAG,EAAE,EAAE;QAC/BnD,QAAQ,CAACyB,IAAI,CAAC;UACZmC,IAAI,EAAE,WAAW;UACjBC,QAAQ,EAAEE,QAAQ,CAACZ,aAAa,GAAG,EAAE,GAAG,MAAM,GAAG,QAAQ;UACzD/C,OAAO,EAAE,uCAAuC;UAChDiB,KAAK,EAAE0C,QAAQ,CAACZ;QAClB,CAAC,CAAC;MACJ;IACF;;IAEA;IACA,IAAItC,eAAe,CAACmD,MAAM,GAAG,CAAC,EAAE;MAC9BhE,QAAQ,CAACiE,OAAO,CAAC;QACfL,IAAI,EAAE,SAAS;QACfC,QAAQ,EAAE,MAAM;QAChBzD,OAAO,EAAE,0CAA0C;QACnDiB,KAAK,EAAE;MACT,CAAC,CAAC;IACJ;IAEA,OAAOrB,QAAQ;EACjB;EAEA4C,uBAAuBA,CAAChC,gBAAgB,EAAE;IACxC,MAAMsD,SAAS,GAAG,CAAC,eAAe,EAAE,gBAAgB,EAAE,YAAY,EAAE,aAAa,EAAE,YAAY,EAAE,aAAa,CAAC;IAC/G,MAAMC,SAAS,GAAG,CAAC,UAAU,EAAE,WAAW,EAAE,WAAW,EAAE,YAAY,EAAE,YAAY,EAAE,aAAa,CAAC;IACnG,MAAMC,WAAW,GAAG,CAAC,MAAM,EAAE,eAAe,EAAE,gBAAgB,EAAE,UAAU,EAAE,WAAW,CAAC;IAExF,MAAMC,kBAAkB,GAAIC,MAAM,IAAK;MACrC,IAAIC,KAAK,GAAG,CAAC;MACb,IAAIC,KAAK,GAAG,CAAC;MACbF,MAAM,CAACX,OAAO,CAAC7C,KAAK,IAAI;QACtB,IAAIF,gBAAgB,CAACE,KAAK,CAAC,EAAE;UAC3ByD,KAAK,IAAI3D,gBAAgB,CAACE,KAAK,CAAC,CAACO,KAAK;UACtCmD,KAAK,EAAE;QACT;MACF,CAAC,CAAC;MACF,OAAOA,KAAK,GAAG,CAAC,GAAG7I,IAAI,CAAC2F,KAAK,CAACiD,KAAK,GAAGC,KAAK,CAAC,GAAG,CAAC;IAClD,CAAC;IAED,OAAO;MACL1B,IAAI,EAAEuB,kBAAkB,CAACH,SAAS,CAAC;MACnClB,IAAI,EAAEqB,kBAAkB,CAACF,SAAS,CAAC;MACnCjB,KAAK,EAAEmB,kBAAkB,CAACD,WAAW;IACvC,CAAC;EACH;AACF;;AAEA;AACA,OAAO,MAAMK,8BAA8B,GAAG,IAAIzJ,8BAA8B,CAAC,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}